import { AtomFields, DublinCoreFields, Rss2Fields, } from "./../types/fields/mod.ts";
import { copyValueFields, isValidURL } from "./../util.ts";
import { FeedType } from "./../types/mod.ts";
import { SlashFieldArray } from "./../types/slash.ts";
import { copyMedia } from "./media_mapper.ts";
import { DublinCoreFieldArray } from "../types/internal/internal_dublin_core.ts";
export const toFeed = (feedType, feed) => {
    if (!feed) {
        return null;
    }
    switch (feedType) {
        case FeedType.Atom:
            return mapAtomToFeed(feed);
        case FeedType.Rss1:
            return mapRssToFeed(feed);
        case FeedType.Rss2:
            return mapRss2ToFeed(feed);
        default:
            return null;
    }
};
const mapRssToFeed = (rss) => {
    const { title, description, link, ...rest } = rss.channel;
    const result = rest;
    copyValueFields(DublinCoreFieldArray, rss.channel, result);
    result.type = FeedType.Rss1;
    const titleValue = result[DublinCoreFields.Title] || title?.value;
    if (titleValue) {
        result.title = {
            value: titleValue,
            type: undefined,
        };
    }
    result.links = [];
    if (result[DublinCoreFields.URI]) {
        result.links.push(result[DublinCoreFields.URI]);
        result.id = result[DublinCoreFields.URI];
    }
    if (link?.value) {
        result.links.push(link.value);
        result.id = link.value;
    }
    result.description = result[DublinCoreFields.Description] ||
        description?.value;
    result.copyright = result[DublinCoreFields.Rights];
    result.language = result[DublinCoreFields.Language];
    result.created = result[DublinCoreFields.Created] ||
        result[DublinCoreFields.DateSubmitted] || result[DublinCoreFields.Date];
    result.createdRaw = result[DublinCoreFields.CreatedRaw] ||
        result[DublinCoreFields.DateSubmittedRaw] ||
        result[DublinCoreFields.DateRaw];
    result.published = result[DublinCoreFields.DateSubmitted] ||
        result[DublinCoreFields.Date];
    result.publishedRaw = result[DublinCoreFields.DateSubmittedRaw] ||
        result[DublinCoreFields.DateRaw];
    result.updateDate = result[DublinCoreFields.Date];
    result.updateDateRaw = result[DublinCoreFields.DateRaw];
    const creators = result[DublinCoreFields.Creator];
    if (creators && creators.length > 0) {
        result.author = createAuthor(undefined, creators[0]);
    }
    if (rss.image) {
        result.image = {
            link: rss.image.link?.value,
            title: rss.image.title?.value,
            url: rss.image.url?.value,
        };
    }
    result.entries = rss.item?.map((item) => {
        const { link, title, description, ...itemRest } = item;
        const entry = itemRest;
        copyValueFields(DublinCoreFieldArray, entry, entry);
        copyValueFields(SlashFieldArray, entry, entry);
        entry.id = entry[DublinCoreFields.URI] || link?.value;
        entry.published = entry[DublinCoreFields.DateSubmitted] ||
            entry[DublinCoreFields.Date];
        entry.publishedRaw = entry[DublinCoreFields.DateSubmittedRaw] ||
            entry[DublinCoreFields.DateRaw];
        entry.updated = entry[DublinCoreFields.Date] ||
            entry[DublinCoreFields.DateSubmitted];
        entry.updatedRaw = entry[DublinCoreFields.DateRaw] ||
            entry[DublinCoreFields.DateSubmittedRaw];
        const entryCreators = entry[DublinCoreFields.Creator];
        if (entryCreators && entryCreators.length > 0) {
            entry.author = createAuthor(undefined, entryCreators[0]);
        }
        const itemTitle = entry[DublinCoreFields.Title] || title?.value;
        if (itemTitle) {
            entry.title = {
                value: itemTitle,
                type: undefined,
            };
        }
        const itemDescription = entry[DublinCoreFields.Description] ||
            description?.value;
        if (itemDescription) {
            entry.description = {
                value: itemDescription,
                type: undefined,
            };
        }
        entry.links = [];
        if (entry[DublinCoreFields.URI]) {
            entry.links.push({
                href: entry[DublinCoreFields.URI],
            });
        }
        if (link?.value) {
            entry.links.push({
                href: link.value,
            });
        }
        entry.contributors = entry[DublinCoreFields.Contributor]?.map((contributor) => ({
            name: contributor,
        }));
        return entry;
    });
    return result;
};
const mapRss2ToFeed = (rss) => {
    const { items, title, description, generator, pubDate, pubDateRaw, lastBuildDate, lastBuildDateRaw, docs, webMaster, language, copyright, ttl, skipDays, skipHours, link, image, ...rest } = rss.channel;
    const result = rest;
    result.type = FeedType.Rss2;
    copyValueFields(DublinCoreFieldArray, result, result);
    result.id = link?.value || result[DublinCoreFields.URI];
    result.title = {
        value: result[DublinCoreFields.Title] || title?.value,
        type: undefined,
    };
    const commonDate = result[DublinCoreFields.DateSubmitted] ||
        result[DublinCoreFields.Date] || pubDate?.value;
    const commonDateRaw = result[DublinCoreFields.DateSubmittedRaw] ||
        result[DublinCoreFields.DateRaw] || pubDateRaw?.value;
    result.description = description?.value ||
        result[DublinCoreFields.Description];
    result.generator = generator?.value;
    result.published = commonDate;
    result.publishedRaw = commonDateRaw;
    result.created = result[DublinCoreFields.Created] || lastBuildDate?.value ||
        commonDate;
    result.createdRaw = result[DublinCoreFields.CreatedRaw] ||
        lastBuildDateRaw?.value || commonDateRaw;
    result.updateDate = lastBuildDate?.value || result[DublinCoreFields.Date];
    result.updateDateRaw = lastBuildDateRaw?.value ||
        result[DublinCoreFields.DateRaw];
    result.docs = docs?.value;
    result.language = language?.value;
    result.copyright = copyright?.value || result[DublinCoreFields.Rights];
    result.ttl = ttl?.value;
    result.skipDays = skipDays?.day?.map((x) => x.value);
    result.skipHours = skipHours?.hour?.map((x) => x.value);
    result.links = [
        link?.value,
        result[DublinCoreFields.URI],
    ].filter((x) => !!x);
    const creators = result[DublinCoreFields.Creator];
    if (webMaster?.value) {
        result.author = createAuthor(webMaster.value);
    }
    else if (creators && creators?.length > 0) {
        result.author = createAuthor(undefined, creators[0]);
    }
    if (image) {
        result.image = {
            link: image.link?.value,
            title: image.title?.value,
            url: image.url?.value,
            height: image?.height?.value,
            width: image?.width?.value,
        };
    }
    result.entries = items.map((item) => {
        const { author, title, description, guid, link, pubDate, pubDateRaw, enclosure, comments, categories, ...itemRest } = item;
        const entry = itemRest;
        copyValueFields(DublinCoreFieldArray, entry, entry);
        copyMedia(entry, entry);
        entry.id = guid?.value || entry[DublinCoreFields.URI];
        const titleValue = entry[DublinCoreFields.Title] || title?.value;
        if (titleValue) {
            entry.title = {
                value: titleValue,
                type: undefined,
            };
        }
        const descriptionValue = entry[DublinCoreFields.Description] ||
            description?.value;
        if (descriptionValue) {
            entry.description = {
                value: descriptionValue,
                type: undefined,
            };
        }
        entry.comments = comments?.value;
        entry.published = entry[DublinCoreFields.DateSubmitted] || pubDate?.value;
        entry.publishedRaw = entry[DublinCoreFields.DateSubmittedRaw] || pubDateRaw?.value;
        entry.updated = pubDate?.value;
        entry.updatedRaw = item.pubDateRaw?.value;
        if (item[Rss2Fields.ContentEncoded]?.value) {
            entry.content = {
                value: item[Rss2Fields.ContentEncoded]?.value
            };
        }
        const creators = entry[DublinCoreFields.Creator];
        if (author?.value) {
            entry.author = createAuthor(undefined, author.value);
        }
        else if (creators && creators.length > 0) {
            entry.author = createAuthor(undefined, creators[0]);
        }
        entry.links = [];
        if (item[Rss2Fields.FeedburnerOrigLink]?.value) {
            entry.links.push({ href: item[Rss2Fields.FeedburnerOrigLink]?.value });
        }
        if (link?.value) {
            entry.links.push({ href: link?.value });
        }
        if (enclosure) {
            entry.attachments = enclosure.map((x) => ({
                url: x.url,
                mimeType: x.type,
                sizeInBytes: x.length,
            }));
        }
        entry.categories = categories?.map((category) => ({
            term: category.value,
            label: category.value,
        }));
        entry.contributors = result[DublinCoreFields.Contributor]?.map((contributor) => ({
            name: contributor,
        }));
        return entry;
    });
    return result;
};
const mapAtomToFeed = (atom) => {
    const { id, generator, title, subtitle, updated, updatedRaw, icon, links, logo, categories, author, entries, ...rest } = atom;
    const result = rest;
    result.type = FeedType.Atom;
    result.id = id?.value;
    result.generator = generator?.value;
    result.title = {
        value: title?.value,
        type: title?.type,
    };
    result.description = subtitle?.value;
    result.updateDate = updated.value;
    result.updateDateRaw = updatedRaw?.value;
    result.published = updated.value;
    result.publishedRaw = updatedRaw?.value;
    result.created = updated.value;
    result.createdRaw = updatedRaw.value;
    result.icon = icon?.value;
    result.links = links?.map((x) => x.href) ?? [];
    if (logo) {
        result.image = {
            link: logo.value,
            url: logo.value,
        };
    }
    if (categories) {
        result.categories = categories?.map((category) => ({
            term: category.term,
            label: category.label,
        }));
    }
    if (author) {
        result.author = {
            name: author.name?.value,
            email: author.email?.value,
            uri: author.uri?.value,
        };
    }
    result.entries = entries?.map((atomEntry) => {
        const { links, href, id, title, summary, published, publishedRaw, updated, updatedRaw, source, author, content, contributors, categories, ...entryRest } = atomEntry;
        const entry = entryRest;
        entry.id = atomEntry[AtomFields.FeedburnerOrigLink]?.value ||
            id?.value;
        entry.published = published?.value;
        entry.publishedRaw = publishedRaw?.value;
        entry.updated = updated?.value;
        entry.updatedRaw = updatedRaw?.value;
        if (title) {
            entry.title = {
                value: title.value,
                type: title.type,
            };
        }
        if (summary) {
            entry.description = {
                value: summary.value,
                type: summary.type,
            };
        }
        entry.links = [];
        if (atomEntry[AtomFields.FeedburnerOrigLink]?.value) {
            entry.links.push({
                href: atomEntry[AtomFields.FeedburnerOrigLink]?.value,
            });
        }
        if (links && links?.length > 0) {
            for (const link of links) {
                entry.links.push({
                    href: link.href,
                    rel: link.rel,
                    type: link.type,
                });
            }
            entry.attachments = links.filter((x) => x.rel === "enclosure").map((x) => ({
                url: x.href,
                mimeType: x.type,
                sizeInBytes: x.length,
            }));
        }
        if (href) {
            entry.links.push({ href });
        }
        if (id && isValidURL(id.value)) {
            entry.links.push({ href: id.value });
        }
        if (source) {
            entry.source = {
                id: source.id?.value,
                title: source.title?.value,
                updated: source.updated?.value,
                updatedRaw: source.updatedRaw?.value,
            };
        }
        if (author) {
            entry.author = {
                email: author.email?.value,
                name: author.name.value,
                uri: author.uri?.value,
            };
        }
        if (content) {
            entry.content = {
                value: content?.value,
                type: content?.type,
            };
        }
        if (contributors) {
            entry.contributors = contributors?.map((x) => ({
                name: x.name?.value,
                email: x.email?.value,
                uri: x.uri?.value,
            }));
        }
        if (categories) {
            entry.categories = categories?.map((x) => ({
                term: x.term,
                label: x.label,
            }));
        }
        return entry;
    });
    return result;
};
const createAuthor = (email, name, uri) => ({
    email,
    name,
    uri,
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFwcGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiaHR0cHM6Ly9kZW5vLmxhbmQveC9yc3NAMC41LjUvc3JjL21hcHBlcnMvbWFwcGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQU9BLE9BQU8sRUFDTCxVQUFVLEVBQ1YsZ0JBQWdCLEVBQ2hCLFVBQVUsR0FDWCxNQUFNLDBCQUEwQixDQUFDO0FBQ2xDLE9BQU8sRUFBRSxlQUFlLEVBQUUsVUFBVSxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBQzNELE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUM3QyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdEQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQzlDLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLDJDQUEyQyxDQUFDO0FBRWpGLE1BQU0sQ0FBQyxNQUFNLE1BQU0sR0FBRyxDQUNwQixRQUFrQixFQUNsQixJQUEyRCxFQUM5QyxFQUFFO0lBQ2YsSUFBSSxDQUFDLElBQUksRUFBRTtRQUNULE9BQU8sSUFBSSxDQUFDO0tBQ2I7SUFFRCxRQUFRLFFBQVEsRUFBRTtRQUNoQixLQUFLLFFBQVEsQ0FBQyxJQUFJO1lBQ2hCLE9BQU8sYUFBYSxDQUFDLElBQW9CLENBQUMsQ0FBQztRQUM3QyxLQUFLLFFBQVEsQ0FBQyxJQUFJO1lBQ2hCLE9BQU8sWUFBWSxDQUFDLElBQW9CLENBQUMsQ0FBQztRQUM1QyxLQUFLLFFBQVEsQ0FBQyxJQUFJO1lBQ2hCLE9BQU8sYUFBYSxDQUFDLElBQW9CLENBQUMsQ0FBQztRQUM3QztZQUNFLE9BQU8sSUFBSSxDQUFDO0tBQ2Y7QUFDSCxDQUFDLENBQUM7QUFFRixNQUFNLFlBQVksR0FBRyxDQUFDLEdBQWlCLEVBQVEsRUFBRTtJQUMvQyxNQUFNLEVBQ0osS0FBSyxFQUNMLFdBQVcsRUFDWCxJQUFJLEVBQ0osR0FBRyxJQUFJLEVBQ1Is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WUFBWSxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztnQkFDN0MsSUFBSSxFQUFFLENBQUMsQ0FBQyxJQUFJLEVBQUUsS0FBSztnQkFDbkIsS0FBSyxFQUFFLENBQUMsQ0FBQyxLQUFLLEVBQUUsS0FBSztnQkFDckIsR0FBRyxFQUFFLENBQUMsQ0FBQyxHQUFHLEVBQUUsS0FBSzthQUNsQixDQUFDLENBQUMsQ0FBQztTQUNMO1FBRUQsSUFBSSxVQUFVLEVBQUU7WUFDZCxLQUFLLENBQUMsVUFBVSxHQUFHLFVBQVUsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7Z0JBQ3pDLElBQUksRUFBRSxDQUFDLENBQUMsSUFBSTtnQkFDWixLQUFLLEVBQUUsQ0FBQyxDQUFDLEtBQUs7YUFDZixDQUFDLENBQUMsQ0FBQztTQUNMO1FBRUQsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDLENBQUMsQ0FBQztJQUVILE9BQU8sTUFBTSxDQUFDO0FBQ2hCLENBQUMsQ0FBQztBQUVGLE1BQU0sWUFBWSxHQUFHLENBQUMsS0FBYyxFQUFFLElBQWEsRUFBRSxHQUFZLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDckUsS0FBSztJQUNMLElBQUk7SUFDSixHQUFHO0NBQ0osQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUge1xuICBJbnRlcm5hbEF0b20sXG4gIEludGVybmFsTWVkaWFSc3MsXG4gIEludGVybmFsUlNTMSxcbiAgSW50ZXJuYWxSU1MyLFxufSBmcm9tIFwiLi4vdHlwZXMvaW50ZXJuYWwvbW9kLnRzXCI7XG5pbXBvcnQgdHlwZSB7IEZlZWQsIEZlZWRFbnRyeSwgSnNvbkZlZWQgfSBmcm9tIFwiLi8uLi90eXBlcy9tb2QudHNcIjtcbmltcG9ydCB7XG4gIEF0b21GaWVsZHMsXG4gIER1YmxpbkNvcmVGaWVsZHMsXG4gIFJzczJGaWVsZHMsXG59IGZyb20gXCIuLy4uL3R5cGVzL2ZpZWxkcy9tb2QudHNcIjtcbmltcG9ydCB7IGNvcHlWYWx1ZUZpZWxkcywgaXNWYWxpZFVSTCB9IGZyb20gXCIuLy4uL3V0aWwudHNcIjtcbmltcG9ydCB7IEZlZWRUeXBlIH0gZnJvbSBcIi4vLi4vdHlwZXMvbW9kLnRzXCI7XG5pbXBvcnQgeyBTbGFzaEZpZWxkQXJyYXkgfSBmcm9tIFwiLi8uLi90eXBlcy9zbGFzaC50c1wiO1xuaW1wb3J0IHsgY29weU1lZGlhIH0gZnJvbSBcIi4vbWVkaWFfbWFwcGVyLnRzXCI7XG5pbXBvcnQgeyBEdWJsaW5Db3JlRmllbGRBcnJheSB9IGZyb20gXCIuLi90eXBlcy9pbnRlcm5hbC9pbnRlcm5hbF9kdWJsaW5fY29yZS50c1wiO1xuXG5leHBvcnQgY29uc3QgdG9GZWVkID0gKFxuICBmZWVkVHlwZTogRmVlZFR5cGUsXG4gIGZlZWQ6IEludGVybmFsQXRvbSB8IEludGVybmFsUlNTMiB8IEludGVybmFsUlNTMSB8IEpzb25GZWVkLFxuKTogRmVlZCB8IG51bGwgPT4ge1xuICBpZiAoIWZlZWQpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHN3aXRjaCAoZmVlZFR5cGUpIHtcbiAgICBjYXNlIEZlZWRUeXBlLkF0b206XG4gICAgICByZXR1cm4gbWFwQXRvbVRvRmVlZChmZWVkIGFzIEludGVybmFsQXRvbSk7XG4gICAgY2FzZSBGZWVkVHlwZS5Sc3MxOlxuICAgICAgcmV0dXJuIG1hcFJzc1RvRmVlZChmZWVkIGFzIEludGVybmFsUlNTMSk7XG4gICAgY2FzZSBGZWVkVHlwZS5Sc3MyOlxuICAgICAgcmV0dXJuIG1hcFJzczJUb0ZlZWQoZmVlZCBhcyBJbnRlcm5hbFJTUzIpO1xuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gbnVsbDtcbiAgfVxufTtcblxuY29uc3QgbWFwUnNzVG9GZWVkID0gKHJzczogSW50ZXJuYWxSU1MxKTogRmVlZCA9PiB7XG4gIGNvbnN0IHtcbiAgICB0aXRsZSxcbiAgICBkZXNjcmlwdGlvbixcbiAgICBsaW5rLFxuICAgIC4uLnJlc3RcbiAgfSA9IHJzcy5jaGFubmVsO1xuXG4gIGNvbnN0IHJlc3VsdCA9IChyZXN0IGFzIGFueSkgYXMgRmVlZDtcbiAgY29weVZhbHVlRmllbGRzKER1YmxpbkNvcmVGaWVsZEFycmF5LCByc3MuY2hhbm5lbCwgcmVzdWx0KTtcbiAgcmVzdWx0LnR5cGUgPSBGZWVkVHlwZS5Sc3MxO1xuXG4gIGNvbnN0IHRpdGxlVmFsdWUgPSByZXN1bHRbRHVibGluQ29yZUZpZWxkcy5UaXRsZV0gfHwgdGl0bGU/LnZhbHVlO1xuICBpZiAodGl0bGVWYWx1ZSkge1xuICAgIHJlc3VsdC50aXRsZSA9IHtcbiAgICAgIHZhbHVlOiB0aXRsZVZhbHVlLFxuICAgICAgdHlwZTogdW5kZWZpbmVkLFxuICAgIH07XG4gIH1cblxuICByZXN1bHQubGlua3MgPSBbXTtcbiAgaWYgKHJlc3VsdFtEdWJsaW5Db3JlRmllbGRzLlVSSV0pIHtcbiAgICByZXN1bHQubGlua3MucHVzaChyZXN1bHRbRHVibGluQ29yZUZpZWxkcy5VUkldIGFzIHN0cmluZyk7XG4gICAgcmVzdWx0LmlkID0gcmVzdWx0W0R1YmxpbkNvcmVGaWVsZHMuVVJJXSBhcyBzdHJpbmc7XG4gIH1cblxuICBpZiAobGluaz8udmFsdWUpIHtcbiAgICByZXN1bHQubGlua3MucHVzaChsaW5rLnZhbHVlKTtcbiAgICByZXN1bHQuaWQgPSBsaW5rLnZhbHVlO1xuICB9XG5cbiAgcmVzdWx0LmRlc2NyaXB0aW9uID0gcmVzdWx0W0R1YmxpbkNvcmVGaWVsZHMuRGVzY3JpcHRpb25dIHx8XG4gICAgZGVzY3JpcHRpb24/LnZhbHVlO1xuICByZXN1bHQuY29weXJpZ2h0ID0gcmVzdWx0W0R1YmxpbkNvcmVGaWVsZHMuUmlnaHRzXTtcbiAgcmVzdWx0Lmxhbmd1YWdlID0gcmVzdWx0W0R1YmxpbkNvcmVGaWVsZHMuTGFuZ3VhZ2VdO1xuICByZXN1bHQuY3JlYXRlZCA9IHJlc3VsdFtEdWJsaW5Db3JlRmllbGRzLkNyZWF0ZWRdIHx8XG4gICAgcmVzdWx0W0R1YmxpbkNvcmVGaWVsZHMuRGF0ZVN1Ym1pdHRlZF0gfHwgcmVzdWx0W0R1YmxpbkNvcmVGaWVsZHMuRGF0ZV07XG4gIHJlc3VsdC5jcmVhdGVkUmF3ID0gcmVzdWx0W0R1YmxpbkNvcmVGaWVsZHMuQ3JlYXRlZFJhd10gfHxcbiAgICByZXN1bHRbRHVibGluQ29yZUZpZWxkcy5EYXRlU3VibWl0dGVkUmF3XSB8fFxuICAgIHJlc3VsdFtEdWJsaW5Db3JlRmllbGRzLkRhdGVSYXddO1xuICByZXN1bHQucHVibGlzaGVkID0gcmVzdWx0W0R1YmxpbkNvcmVGaWVsZHMuRGF0ZVN1Ym1pdHRlZF0gfHxcbiAgICByZXN1bHRbRHVibGluQ29yZUZpZWxkcy5EYXRlXTtcbiAgcmVzdWx0LnB1Ymxpc2hlZFJhdyA9IHJlc3VsdFtEdWJsaW5Db3JlRmllbGRzLkRhdGVTdWJtaXR0ZWRSYXddIHx8XG4gICAgcmVzdWx0W0R1YmxpbkNvcmVGaWVsZHMuRGF0ZVJhd107XG4gIHJlc3VsdC51cGRhdGVEYXRlID0gcmVzdWx0W0R1YmxpbkNvcmVGaWVsZHMuRGF0ZV07XG4gIHJlc3VsdC51cGRhdGVEYXRlUmF3ID0gcmVzdWx0W0R1YmxpbkNvcmVGaWVsZHMuRGF0ZVJhd107XG5cbiAgY29uc3QgY3JlYXRvcnMgPSByZXN1bHRbRHVibGluQ29yZUZpZWxkcy5DcmVhdG9yXTtcbiAgaWYgKGNyZWF0b3JzICYmIGNyZWF0b3JzLmxlbmd0aCA+IDApIHtcbiAgICByZXN1bHQuYXV0aG9yID0gY3JlYXRlQXV0aG9yKHVuZGVmaW5lZCwgY3JlYXRvcnNbMF0pO1xuICB9XG5cbiAgaWYgKHJzcy5pbWFnZSkge1xuICAgIHJlc3VsdC5pbWFnZSA9IHtcbiAgICAgIGxpbms6IHJzcy5pbWFnZS5saW5rPy52YWx1ZSBhcyBzdHJpbmcsXG4gICAgICB0aXRsZTogcnNzLmltYWdlLnRpdGxlPy52YWx1ZSBhcyBzdHJpbmcsXG4gICAgICB1cmw6IHJzcy5pbWFnZS51cmw/LnZhbHVlIGFzIHN0cmluZyxcbiAgICB9O1xuICB9XG5cbiAgcmVzdWx0LmVudHJpZXMgPSByc3MuaXRlbT8ubWFwKChpdGVtKSA9PiB7XG4gICAgY29uc3Qge1xuICAgICAgbGluayxcbiAgICAgIHRpdGxlLFxuICAgICAgZGVzY3JpcHRpb24sXG4gICAgICAuLi5pdGVtUmVzdFxuICAgIH0gPSBpdGVtO1xuXG4gICAgY29uc3QgZW50cnkgPSAoaXRlbVJlc3QgYXMgYW55KSBhcyBGZWVkRW50cnk7XG4gICAgY29weVZhbHVlRmllbGRzKER1YmxpbkNvcmVGaWVsZEFycmF5LCBlbnRyeSwgZW50cnkpO1xuICAgIGNvcHlWYWx1ZUZpZWxkcyhTbGFzaEZpZWxkQXJyYXksIGVudHJ5LCBlbnRyeSk7XG5cbiAgICBlbnRyeS5pZCA9IGVudHJ5W0R1YmxpbkNvcmVGaWVsZHMuVVJJXSB8fCBsaW5rPy52YWx1ZSBhcyBzdHJpbmc7XG4gICAgZW50cnkucHVibGlzaGVkID0gZW50cnlbRHVibGluQ29yZUZpZWxkcy5EYXRlU3VibWl0dGVkXSB8fFxuICAgICAgZW50cnlbRHVibGluQ29yZUZpZWxkcy5EYXRlXTtcbiAgICBlbnRyeS5wdWJsaXNoZWRSYXcgPSBlbnRyeVtEdWJsaW5Db3JlRmllbGRzLkRhdGVTdWJtaXR0ZWRSYXddIHx8XG4gICAgICBlbnRyeVtEdWJsaW5Db3JlRmllbGRzLkRhdGVSYXddO1xuICAgIGVudHJ5LnVwZGF0ZWQgPSBlbnRyeVtEdWJsaW5Db3JlRmllbGRzLkRhdGVdIHx8XG4gICAgICBlbnRyeVtEdWJsaW5Db3JlRmllbGRzLkRhdGVTdWJtaXR0ZWRdO1xuICAgIGVudHJ5LnVwZGF0ZWRSYXcgPSBlbnRyeVtEdWJsaW5Db3JlRmllbGRzLkRhdGVSYXddIHx8XG4gICAgICBlbnRyeVtEdWJsaW5Db3JlRmllbGRzLkRhdGVTdWJtaXR0ZWRSYXddO1xuXG4gICAgY29uc3QgZW50cnlDcmVhdG9ycyA9IGVudHJ5W0R1YmxpbkNvcmVGaWVsZHMuQ3JlYXRvcl07XG4gICAgaWYgKGVudHJ5Q3JlYXRvcnMgJiYgZW50cnlDcmVhdG9ycy5sZW5ndGggPiAwKSB7XG4gICAgICBlbnRyeS5hdXRob3IgPSBjcmVhdGVBdXRob3IodW5kZWZpbmVkLCBlbnRyeUNyZWF0b3JzWzBdKTtcbiAgICB9XG5cbiAgICBjb25zdCBpdGVtVGl0bGUgPSBlbnRyeVtEdWJsaW5Db3JlRmllbGRzLlRpdGxlXSB8fCB0aXRsZT8udmFsdWU7XG4gICAgaWYgKGl0ZW1UaXRsZSkge1xuICAgICAgZW50cnkudGl0bGUgPSB7XG4gICAgICAgIHZhbHVlOiBpdGVtVGl0bGUsXG4gICAgICAgIHR5cGU6IHVuZGVmaW5lZCxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgY29uc3QgaXRlbURlc2NyaXB0aW9uID0gZW50cnlbRHVibGluQ29yZUZpZWxkcy5EZXNjcmlwdGlvbl0gfHxcbiAgICAgIGRlc2NyaXB0aW9uPy52YWx1ZTtcbiAgICBpZiAoaXRlbURlc2NyaXB0aW9uKSB7XG4gICAgICBlbnRyeS5kZXNjcmlwdGlvbiA9IHtcbiAgICAgICAgdmFsdWU6IGl0ZW1EZXNjcmlwdGlvbixcbiAgICAgICAgdHlwZTogdW5kZWZpbmVkLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBlbnRyeS5saW5rcyA9IFtdO1xuICAgIGlmIChlbnRyeVtEdWJsaW5Db3JlRmllbGRzLlVSSV0pIHtcbiAgICAgIGVudHJ5LmxpbmtzLnB1c2goe1xuICAgICAgICBocmVmOiBlbnRyeVtEdWJsaW5Db3JlRmllbGRzLlVSSV0sXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBpZiAobGluaz8udmFsdWUpIHtcbiAgICAgIGVudHJ5LmxpbmtzLnB1c2goe1xuICAgICAgICBocmVmOiBsaW5rLnZhbHVlLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgZW50cnkuY29udHJpYnV0b3JzID0gZW50cnlbRHVibGluQ29yZUZpZWxkcy5Db250cmlidXRvcl0/Lm1hcCgoXG4gICAgICBjb250cmlidXRvcixcbiAgICApID0+ICh7XG4gICAgICBuYW1lOiBjb250cmlidXRvcixcbiAgICB9KSk7XG5cbiAgICByZXR1cm4gZW50cnk7XG4gIH0pO1xuXG4gIHJldHVybiByZXN1bHQ7XG59O1xuXG5jb25zdCBtYXBSc3MyVG9GZWVkID0gKHJzczogSW50ZXJuYWxSU1MyKTogRmVlZCA9PiB7XG4gIGNvbnN0IHtcbiAgICBpdGVtcyxcbiAgICB0aXRsZSxcbiAgICBkZXNjcmlwdGlvbixcbiAgICBnZW5lcmF0b3IsXG4gICAgcHViRGF0ZSxcbiAgICBwdWJEYXRlUmF3LFxuICAgIGxhc3RCdWlsZERhdGUsXG4gICAgbGFzdEJ1aWxkRGF0ZVJhdyxcbiAgICBkb2NzLFxuICAgIHdlYk1hc3RlcixcbiAgICBsYW5ndWFnZSxcbiAgICBjb3B5cmlnaHQsXG4gICAgdHRsLFxuICAgIHNraXBEYXlzLFxuICAgIHNraXBIb3VycyxcbiAgICBsaW5rLFxuICAgIGltYWdlLFxuICAgIC4uLnJlc3RcbiAgfSA9IHJzcy5jaGFubmVsO1xuXG4gIGNvbnN0IHJlc3VsdCA9IChyZXN0IGFzIGFueSkgYXMgRmVlZDtcbiAgcmVzdWx0LnR5cGUgPSBGZWVkVHlwZS5Sc3MyO1xuICBjb3B5VmFsdWVGaWVsZHMoRHVibGluQ29yZUZpZWxkQXJyYXksIHJlc3VsdCwgcmVzdWx0KTtcblxuICByZXN1bHQuaWQgPSBsaW5rPy52YWx1ZSBhcyBzdHJpbmcgfHwgcmVzdWx0W0R1YmxpbkNvcmVGaWVsZHMuVVJJXSBhcyBzdHJpbmc7XG4gIHJlc3VsdC50aXRsZSA9IHtcbiAgICB2YWx1ZTogcmVzdWx0W0R1YmxpbkNvcmVGaWVsZHMuVGl0bGVdIHx8IHRpdGxlPy52YWx1ZSxcbiAgICB0eXBlOiB1bmRlZmluZWQsXG4gIH07XG5cbiAgY29uc3QgY29tbW9uRGF0ZSA9IHJlc3VsdFtEdWJsaW5Db3JlRmllbGRzLkRhdGVTdWJtaXR0ZWRdIHx8XG4gICAgcmVzdWx0W0R1YmxpbkNvcmVGaWVsZHMuRGF0ZV0gfHwgcHViRGF0ZT8udmFsdWU7XG4gIGNvbnN0IGNvbW1vbkRhdGVSYXcgPSByZXN1bHRbRHVibGluQ29yZUZpZWxkcy5EYXRlU3VibWl0dGVkUmF3XSB8fFxuICAgIHJlc3VsdFtEdWJsaW5Db3JlRmllbGRzLkRhdGVSYXddIHx8IHB1YkRhdGVSYXc/LnZhbHVlO1xuXG4gIHJlc3VsdC5kZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uPy52YWx1ZSB8fFxuICAgIHJlc3VsdFtEdWJsaW5Db3JlRmllbGRzLkRlc2NyaXB0aW9uXTtcbiAgcmVzdWx0LmdlbmVyYXRvciA9IGdlbmVyYXRvcj8udmFsdWU7XG4gIHJlc3VsdC5wdWJsaXNoZWQgPSBjb21tb25EYXRlO1xuICByZXN1bHQucHVibGlzaGVkUmF3ID0gY29tbW9uRGF0ZVJhdztcbiAgcmVzdWx0LmNyZWF0ZWQgPSByZXN1bHRbRHVibGluQ29yZUZpZWxkcy5DcmVhdGVkXSB8fCBsYXN0QnVpbGREYXRlPy52YWx1ZSB8fFxuICAgIGNvbW1vbkRhdGU7XG4gIHJlc3VsdC5jcmVhdGVkUmF3ID0gcmVzdWx0W0R1YmxpbkNvcmVGaWVsZHMuQ3JlYXRlZFJhd10gfHxcbiAgICBsYXN0QnVpbGREYXRlUmF3Py52YWx1ZSB8fCBjb21tb25EYXRlUmF3O1xuICByZXN1bHQudXBkYXRlRGF0ZSA9IGxhc3RCdWlsZERhdGU/LnZhbHVlIHx8IHJlc3VsdFtEdWJsaW5Db3JlRmllbGRzLkRhdGVdO1xuICByZXN1bHQudXBkYXRlRGF0ZVJhdyA9IGxhc3RCdWlsZERhdGVSYXc/LnZhbHVlIHx8XG4gICAgcmVzdWx0W0R1YmxpbkNvcmVGaWVsZHMuRGF0ZVJhd107XG4gIHJlc3VsdC5kb2NzID0gZG9jcz8udmFsdWU7XG4gIHJlc3VsdC5sYW5ndWFnZSA9IGxhbmd1YWdlPy52YWx1ZTtcbiAgcmVzdWx0LmNvcHlyaWdodCA9IGNvcHlyaWdodD8udmFsdWUgfHwgcmVzdWx0W0R1YmxpbkNvcmVGaWVsZHMuUmlnaHRzXTtcbiAgcmVzdWx0LnR0bCA9IHR0bD8udmFsdWU7XG4gIHJlc3VsdC5za2lwRGF5cyA9IHNraXBEYXlzPy5kYXk/Lm1hcCgoeCkgPT4geC52YWx1ZSBhcyBzdHJpbmcpO1xuICByZXN1bHQuc2tpcEhvdXJzID0gc2tpcEhvdXJzPy5ob3VyPy5tYXAoKHgpID0+IHgudmFsdWUgYXMgbnVtYmVyKTtcbiAgcmVzdWx0LmxpbmtzID0gW1xuICAgIGxpbms/LnZhbHVlLFxuICAgIHJlc3VsdFtEdWJsaW5Db3JlRmllbGRzLlVSSV0sXG4gIF0uZmlsdGVyKCh4KSA9PiAhIXgpIGFzIHN0cmluZ1tdO1xuXG4gIGNvbnN0IGNyZWF0b3JzID0gcmVzdWx0W0R1YmxpbkNvcmVGaWVsZHMuQ3JlYXRvcl07XG4gIGlmICh3ZWJNYXN0ZXI/LnZhbHVlKSB7XG4gICAgcmVzdWx0LmF1dGhvciA9IGNyZWF0ZUF1dGhvcih3ZWJNYXN0ZXIudmFsdWUpO1xuICB9IGVsc2UgaWYgKGNyZWF0b3JzICYmIGNyZWF0b3JzPy5sZW5ndGggPiAwKSB7XG4gICAgcmVzdWx0LmF1dGhvciA9IGNyZWF0ZUF1dGhvcih1bmRlZmluZWQsIGNyZWF0b3JzWzBdKTtcbiAgfVxuXG4gIGlmIChpbWFnZSkge1xuICAgIHJlc3VsdC5pbWFnZSA9IHtcbiAgICAgIGxpbms6IGltYWdlLmxpbms/LnZhbHVlIGFzIHN0cmluZyxcbiAgICAgIHRpdGxlOiBpbWFnZS50aXRsZT8udmFsdWUgYXMgc3RyaW5nLFxuICAgICAgdXJsOiBpbWFnZS51cmw/LnZhbHVlIGFzIHN0cmluZyxcbiAgICAgIGhlaWdodDogaW1hZ2U/LmhlaWdodD8udmFsdWUsXG4gICAgICB3aWR0aDogaW1hZ2U/LndpZHRoPy52YWx1ZSxcbiAgICB9O1xuICB9XG5cbiAgcmVzdWx0LmVudHJpZXMgPSBpdGVtcy5tYXAoKGl0ZW0pID0+IHtcbiAgICBjb25zdCB7XG4gICAgICBhdXRob3IsXG4gICAgICB0aXRsZSxcbiAgICAgIGRlc2NyaXB0aW9uLFxuICAgICAgZ3VpZCxcbiAgICAgIGxpbmssXG4gICAgICBwdWJEYXRlLFxuICAgICAgcHViRGF0ZVJhdyxcbiAgICAgIGVuY2xvc3VyZSxcbiAgICAgIGNvbW1lbnRzLFxuICAgICAgY2F0ZWdvcmllcyxcbiAgICAgIC4uLml0ZW1SZXN0XG4gICAgfSA9IGl0ZW07XG5cbiAgICBjb25zdCBlbnRyeSA9IGl0ZW1SZXN0IGFzIEZlZWRFbnRyeTtcbiAgICBjb3B5VmFsdWVGaWVsZHMoRHVibGluQ29yZUZpZWxkQXJyYXksIGVudHJ5LCBlbnRyeSk7XG4gICAgY29weU1lZGlhKGVudHJ5IGFzIEludGVybmFsTWVkaWFSc3MsIGVudHJ5KTtcblxuICAgIGVudHJ5LmlkID0gZ3VpZD8udmFsdWUgYXMgc3RyaW5nIHx8IGVudHJ5W0R1YmxpbkNvcmVGaWVsZHMuVVJJXSBhcyBzdHJpbmc7XG5cbiAgICBjb25zdCB0aXRsZVZhbHVlID0gZW50cnlbRHVibGluQ29yZUZpZWxkcy5UaXRsZV0gfHwgdGl0bGU/LnZhbHVlO1xuICAgIGlmICh0aXRsZVZhbHVlKSB7XG4gICAgICBlbnRyeS50aXRsZSA9IHtcbiAgICAgICAgdmFsdWU6IHRpdGxlVmFsdWUsXG4gICAgICAgIHR5cGU6IHVuZGVmaW5lZCxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgY29uc3QgZGVzY3JpcHRpb25WYWx1ZSA9IGVudHJ5W0R1YmxpbkNvcmVGaWVsZHMuRGVzY3JpcHRpb25dIHx8XG4gICAgICBkZXNjcmlwdGlvbj8udmFsdWU7XG4gICAgaWYgKGRlc2NyaXB0aW9uVmFsdWUpIHtcbiAgICAgIGVudHJ5LmRlc2NyaXB0aW9uID0ge1xuICAgICAgICB2YWx1ZTogZGVzY3JpcHRpb25WYWx1ZSxcbiAgICAgICAgdHlwZTogdW5kZWZpbmVkLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBlbnRyeS5jb21tZW50cyA9IGNvbW1lbnRzPy52YWx1ZTtcbiAgICBlbnRyeS5wdWJsaXNoZWQgPSBlbnRyeVtEdWJsaW5Db3JlRmllbGRzLkRhdGVTdWJtaXR0ZWRdIHx8IHB1YkRhdGU/LnZhbHVlO1xuICAgIGVudHJ5LnB1Ymxpc2hlZFJhdyA9IGVudHJ5W0R1YmxpbkNvcmVGaWVsZHMuRGF0ZVN1Ym1pdHRlZFJhd10gfHwgcHViRGF0ZVJhdz8udmFsdWU7XG4gICAgZW50cnkudXBkYXRlZCA9IHB1YkRhdGU/LnZhbHVlO1xuICAgIGVudHJ5LnVwZGF0ZWRSYXcgPSBpdGVtLnB1YkRhdGVSYXc/LnZhbHVlO1xuXG4gICAgaWYgKGl0ZW1bUnNzMkZpZWxkcy5Db250ZW50RW5jb2RlZF0/LnZhbHVlKSB7XG4gICAgICBlbnRyeS5jb250ZW50ID0ge1xuICAgICAgICB2YWx1ZTogaXRlbVtSc3MyRmllbGRzLkNvbnRlbnRFbmNvZGVkXT8udmFsdWVcbiAgICAgIH07XG4gICAgfVxuXG4gICAgY29uc3QgY3JlYXRvcnMgPSBlbnRyeVtEdWJsaW5Db3JlRmllbGRzLkNyZWF0b3JdO1xuICAgIGlmIChhdXRob3I/LnZhbHVlKSB7XG4gICAgICBlbnRyeS5hdXRob3IgPSBjcmVhdGVBdXRob3IodW5kZWZpbmVkLCBhdXRob3IudmFsdWUpO1xuICAgIH0gZWxzZSBpZiAoY3JlYXRvcnMgJiYgY3JlYXRvcnMubGVuZ3RoID4gMCkge1xuICAgICAgZW50cnkuYXV0aG9yID0gY3JlYXRlQXV0aG9yKHVuZGVmaW5lZCwgY3JlYXRvcnNbMF0pO1xuICAgIH1cblxuICAgIGVudHJ5LmxpbmtzID0gW107XG5cbiAgICBpZiAoaXRlbVtSc3MyRmllbGRzLkZlZWRidXJuZXJPcmlnTGlua10/LnZhbHVlKSB7XG4gICAgICBlbnRyeS5saW5rcy5wdXNoKHsgaHJlZjogaXRlbVtSc3MyRmllbGRzLkZlZWRidXJuZXJPcmlnTGlua10/LnZhbHVlIH0pO1xuICAgIH1cblxuICAgIGlmIChsaW5rPy52YWx1ZSkge1xuICAgICAgZW50cnkubGlua3MucHVzaCh7IGhyZWY6IGxpbms/LnZhbHVlIH0pO1xuICAgIH1cblxuICAgIGlmIChlbmNsb3N1cmUpIHtcbiAgICAgIGVudHJ5LmF0dGFjaG1lbnRzID0gZW5jbG9zdXJlLm1hcCgoeCkgPT4gKHtcbiAgICAgICAgdXJsOiB4LnVybCxcbiAgICAgICAgbWltZVR5cGU6IHgudHlwZSxcbiAgICAgICAgc2l6ZUluQnl0ZXM6IHgubGVuZ3RoLFxuICAgICAgfSkpO1xuICAgIH1cblxuICAgIGVudHJ5LmNhdGVnb3JpZXMgPSBjYXRlZ29yaWVzPy5tYXAoKGNhdGVnb3J5KSA9PiAoe1xuICAgICAgdGVybTogY2F0ZWdvcnkudmFsdWUsXG4gICAgICBsYWJlbDogY2F0ZWdvcnkudmFsdWUsXG4gICAgfSkpO1xuXG4gICAgZW50cnkuY29udHJpYnV0b3JzID0gcmVzdWx0W0R1YmxpbkNvcmVGaWVsZHMuQ29udHJpYnV0b3JdPy5tYXAoKFxuICAgICAgY29udHJpYnV0b3IsXG4gICAgKSA9PiAoe1xuICAgICAgbmFtZTogY29udHJpYnV0b3IsXG4gICAgfSkpO1xuXG4gICAgcmV0dXJuIGVudHJ5O1xuICB9KTtcblxuICByZXR1cm4gKHJlc3VsdCBhcyBhbnkpO1xufTtcblxuY29uc3QgbWFwQXRvbVRvRmVlZCA9IChhdG9tOiBJbnRlcm5hbEF0b20pOiBGZWVkID0+IHtcbiAgY29uc3Qge1xuICAgIGlkLFxuICAgIGdlbmVyYXRvcixcbiAgICB0aXRsZSxcbiAgICBzdWJ0aXRsZSxcbiAgICB1cGRhdGVkLFxuICAgIHVwZGF0ZWRSYXcsXG4gICAgaWNvbixcbiAgICBsaW5rcyxcbiAgICBsb2dvLFxuICAgIGNhdGVnb3JpZXMsXG4gICAgYXV0aG9yLFxuICAgIGVudHJpZXMsXG4gICAgLi4ucmVzdFxuICB9ID0gYXRvbTtcblxuICBjb25zdCByZXN1bHQgPSAocmVzdCBhcyBhbnkpIGFzIEZlZWQ7XG4gIHJlc3VsdC50eXBlID0gRmVlZFR5cGUuQXRvbTtcbiAgcmVzdWx0LmlkID0gaWQ/LnZhbHVlIGFzIHN0cmluZztcbiAgcmVzdWx0LmdlbmVyYXRvciA9IGdlbmVyYXRvcj8udmFsdWU7XG4gIHJlc3VsdC50aXRsZSA9IHtcbiAgICB2YWx1ZTogdGl0bGU/LnZhbHVlLFxuICAgIHR5cGU6IHRpdGxlPy50eXBlLFxuICB9O1xuICByZXN1bHQuZGVzY3JpcHRpb24gPSBzdWJ0aXRsZT8udmFsdWU7XG4gIHJlc3VsdC51cGRhdGVEYXRlID0gdXBkYXRlZC52YWx1ZTtcbiAgcmVzdWx0LnVwZGF0ZURhdGVSYXcgPSB1cGRhdGVkUmF3Py52YWx1ZTtcbiAgcmVzdWx0LnB1Ymxpc2hlZCA9IHVwZGF0ZWQudmFsdWU7XG4gIHJlc3VsdC5wdWJsaXNoZWRSYXcgPSB1cGRhdGVkUmF3Py52YWx1ZTtcbiAgcmVzdWx0LmNyZWF0ZWQgPSB1cGRhdGVkLnZhbHVlO1xuICByZXN1bHQuY3JlYXRlZFJhdyA9IHVwZGF0ZWRSYXcudmFsdWU7XG4gIHJlc3VsdC5pY29uID0gaWNvbj8udmFsdWU7XG4gIHJlc3VsdC5saW5rcyA9IGxpbmtzPy5tYXAoKHgpID0+IHguaHJlZikgPz8gW107XG5cbiAgaWYgKGxvZ28pIHtcbiAgICByZXN1bHQuaW1hZ2UgPSB7XG4gICAgICBsaW5rOiBsb2dvLnZhbHVlIGFzIHN0cmluZyxcbiAgICAgIHVybDogbG9nby52YWx1ZSBhcyBzdHJpbmcsXG4gICAgfTtcbiAgfVxuXG4gIGlmIChjYXRlZ29yaWVzKSB7XG4gICAgcmVzdWx0LmNhdGVnb3JpZXMgPSBjYXRlZ29yaWVzPy5tYXAoKGNhdGVnb3J5KSA9PiAoe1xuICAgICAgdGVybTogY2F0ZWdvcnkudGVybSxcbiAgICAgIGxhYmVsOiBjYXRlZ29yeS5sYWJlbCxcbiAgICB9KSk7XG4gIH1cblxuICBpZiAoYXV0aG9yKSB7XG4gICAgcmVzdWx0LmF1dGhvciA9IHtcbiAgICAgIG5hbWU6IGF1dGhvci5uYW1lPy52YWx1ZSxcbiAgICAgIGVtYWlsOiBhdXRob3IuZW1haWw/LnZhbHVlLFxuICAgICAgdXJpOiBhdXRob3IudXJpPy52YWx1ZSxcbiAgICB9O1xuICB9XG5cbiAgcmVzdWx0LmVudHJpZXMgPSBlbnRyaWVzPy5tYXAoKGF0b21FbnRyeSkgPT4ge1xuICAgIGNvbnN0IHtcbiAgICAgIGxpbmtzLFxuICAgICAgaHJlZixcbiAgICAgIGlkLFxuICAgICAgdGl0bGUsXG4gICAgICBzdW1tYXJ5LFxuICAgICAgcHVibGlzaGVkLFxuICAgICAgcHVibGlzaGVkUmF3LFxuICAgICAgdXBkYXRlZCxcbiAgICAgIHVwZGF0ZWRSYXcsXG4gICAgICBzb3VyY2UsXG4gICAgICBhdXRob3IsXG4gICAgICBjb250ZW50LFxuICAgICAgY29udHJpYnV0b3JzLFxuICAgICAgY2F0ZWdvcmllcyxcbiAgICAgIC4uLmVudHJ5UmVzdFxuICAgIH0gPSBhdG9tRW50cnk7XG5cbiAgICBjb25zdCBlbnRyeSA9IGVudHJ5UmVzdCBhcyBGZWVkRW50cnk7XG4gICAgZW50cnkuaWQgPSBhdG9tRW50cnlbQXRvbUZpZWxkcy5GZWVkYnVybmVyT3JpZ0xpbmtdPy52YWx1ZSB8fFxuICAgICAgaWQ/LnZhbHVlIGFzIHN0cmluZztcbiAgICBlbnRyeS5wdWJsaXNoZWQgPSBwdWJsaXNoZWQ/LnZhbHVlO1xuICAgIGVudHJ5LnB1Ymxpc2hlZFJhdyA9IHB1Ymxpc2hlZFJhdz8udmFsdWU7XG4gICAgZW50cnkudXBkYXRlZCA9IHVwZGF0ZWQ/LnZhbHVlO1xuICAgIGVudHJ5LnVwZGF0ZWRSYXcgPSB1cGRhdGVkUmF3Py52YWx1ZTtcblxuICAgIGlmICh0aXRsZSkge1xuICAgICAgZW50cnkudGl0bGUgPSB7XG4gICAgICAgIHZhbHVlOiB0aXRsZS52YWx1ZSxcbiAgICAgICAgdHlwZTogdGl0bGUudHlwZSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgaWYgKHN1bW1hcnkpIHtcbiAgICAgIGVudHJ5LmRlc2NyaXB0aW9uID0ge1xuICAgICAgICB2YWx1ZTogc3VtbWFyeS52YWx1ZSxcbiAgICAgICAgdHlwZTogc3VtbWFyeS50eXBlLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBlbnRyeS5saW5rcyA9IFtdO1xuICAgIGlmIChhdG9tRW50cnlbQXRvbUZpZWxkcy5GZWVkYnVybmVyT3JpZ0xpbmtdPy52YWx1ZSkge1xuICAgICAgZW50cnkubGlua3MucHVzaCh7XG4gICAgICAgIGhyZWY6IGF0b21FbnRyeVtBdG9tRmllbGRzLkZlZWRidXJuZXJPcmlnTGlua10/LnZhbHVlIGFzIHN0cmluZyxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmIChsaW5rcyAmJiBsaW5rcz8ubGVuZ3RoID4gMCkge1xuICAgICAgZm9yIChjb25zdCBsaW5rIG9mIGxpbmtzKSB7XG4gICAgICAgIGVudHJ5LmxpbmtzLnB1c2goe1xuICAgICAgICAgIGhyZWY6IGxpbmsuaHJlZixcbiAgICAgICAgICByZWw6IGxpbmsucmVsLFxuICAgICAgICAgIHR5cGU6IGxpbmsudHlwZSxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGVudHJ5LmF0dGFjaG1lbnRzID0gbGlua3MuZmlsdGVyKCh4KSA9PiB4LnJlbCA9PT0gXCJlbmNsb3N1cmVcIikubWFwKChcbiAgICAgICAgeCxcbiAgICAgICkgPT4gKHtcbiAgICAgICAgdXJsOiB4LmhyZWYsXG4gICAgICAgIG1pbWVUeXBlOiB4LnR5cGUsXG4gICAgICAgIHNpemVJbkJ5dGVzOiB4Lmxlbmd0aCxcbiAgICAgIH0pKTtcbiAgICB9XG5cbiAgICBpZiAoaHJlZikge1xuICAgICAgZW50cnkubGlua3MucHVzaCh7IGhyZWYgfSk7XG4gICAgfVxuXG4gICAgaWYgKGlkICYmIGlzVmFsaWRVUkwoaWQudmFsdWUgYXMgc3RyaW5nKSkge1xuICAgICAgZW50cnkubGlua3MucHVzaCh7IGhyZWY6IGlkLnZhbHVlIH0pO1xuICAgIH1cblxuICAgIGlmIChzb3VyY2UpIHtcbiAgICAgIGVudHJ5LnNvdXJjZSA9IHtcbiAgICAgICAgaWQ6IHNvdXJjZS5pZD8udmFsdWUsXG4gICAgICAgIHRpdGxlOiBzb3VyY2UudGl0bGU/LnZhbHVlLFxuICAgICAgICB1cGRhdGVkOiBzb3VyY2UudXBkYXRlZD8udmFsdWUsXG4gICAgICAgIHVwZGF0ZWRSYXc6IHNvdXJjZS51cGRhdGVkUmF3Py52YWx1ZSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgaWYgKGF1dGhvcikge1xuICAgICAgZW50cnkuYXV0aG9yID0ge1xuICAgICAgICBlbWFpbDogYXV0aG9yLmVtYWlsPy52YWx1ZSxcbiAgICAgICAgbmFtZTogYXV0aG9yLm5hbWUudmFsdWUsXG4gICAgICAgIHVyaTogYXV0aG9yLnVyaT8udmFsdWUsXG4gICAgICB9O1xuICAgIH1cblxuICAgIGlmIChjb250ZW50KSB7XG4gICAgICBlbnRyeS5jb250ZW50ID0ge1xuICAgICAgICB2YWx1ZTogY29udGVudD8udmFsdWUsXG4gICAgICAgIHR5cGU6IGNvbnRlbnQ/LnR5cGUsXG4gICAgICB9O1xuICAgIH1cblxuICAgIGlmIChjb250cmlidXRvcnMpIHtcbiAgICAgIGVudHJ5LmNvbnRyaWJ1dG9ycyA9IGNvbnRyaWJ1dG9ycz8ubWFwKCh4KSA9PiAoe1xuICAgICAgICBuYW1lOiB4Lm5hbWU/LnZhbHVlLFxuICAgICAgICBlbWFpbDogeC5lbWFpbD8udmFsdWUsXG4gICAgICAgIHVyaTogeC51cmk/LnZhbHVlLFxuICAgICAgfSkpO1xuICAgIH1cblxuICAgIGlmIChjYXRlZ29yaWVzKSB7XG4gICAgICBlbnRyeS5jYXRlZ29yaWVzID0gY2F0ZWdvcmllcz8ubWFwKCh4KSA9PiAoe1xuICAgICAgICB0ZXJtOiB4LnRlcm0sXG4gICAgICAgIGxhYmVsOiB4LmxhYmVsLFxuICAgICAgfSkpO1xuICAgIH1cblxuICAgIHJldHVybiBlbnRyeTtcbiAgfSk7XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn07XG5cbmNvbnN0IGNyZWF0ZUF1dGhvciA9IChlbWFpbD86IHN0cmluZywgbmFtZT86IHN0cmluZywgdXJpPzogc3RyaW5nKSA9PiAoe1xuICBlbWFpbCxcbiAgbmFtZSxcbiAgdXJpLFxufSk7XG4iXX0=