import * as hex from "../encoding/hex.ts";
import * as base64 from "../encoding/base64.ts";
import { normalizeEncoding, notImplemented } from "./_utils.ts";
const notImplementedEncodings = [
    "ascii",
    "binary",
    "latin1",
    "ucs2",
    "utf16le",
];
function checkEncoding(encoding = "utf8", strict = true) {
    if (typeof encoding !== "string" || (strict && encoding === "")) {
        if (!strict)
            return "utf8";
        throw new TypeError(`Unkown encoding: ${encoding}`);
    }
    const normalized = normalizeEncoding(encoding);
    if (normalized === undefined) {
        throw new TypeError(`Unkown encoding: ${encoding}`);
    }
    if (notImplementedEncodings.includes(encoding)) {
        notImplemented(`"${encoding}" encoding`);
    }
    return normalized;
}
const encodingOps = {
    utf8: {
        byteLength: (string) => new TextEncoder().encode(string).byteLength,
    },
    ucs2: {
        byteLength: (string) => string.length * 2,
    },
    utf16le: {
        byteLength: (string) => string.length * 2,
    },
    latin1: {
        byteLength: (string) => string.length,
    },
    ascii: {
        byteLength: (string) => string.length,
    },
    base64: {
        byteLength: (string) => base64ByteLength(string, string.length),
    },
    hex: {
        byteLength: (string) => string.length >>> 1,
    },
};
function base64ByteLength(str, bytes) {
    if (str.charCodeAt(bytes - 1) === 0x3d)
        bytes--;
    if (bytes > 1 && str.charCodeAt(bytes - 1) === 0x3d)
        bytes--;
    return (bytes * 3) >>> 2;
}
export class Buffer extends Uint8Array {
    static alloc(size, fill, encoding = "utf8") {
        if (typeof size !== "number") {
            throw new TypeError(`The "size" argument must be of type number. Received type ${typeof size}`);
        }
        const buf = new Buffer(size);
        if (size === 0)
            return buf;
        let bufFill;
        if (typeof fill === "string") {
            const clearEncoding = checkEncoding(encoding);
            if (typeof fill === "string" &&
                fill.length === 1 &&
                clearEncoding === "utf8") {
                buf.fill(fill.charCodeAt(0));
            }
            else
                bufFill = Buffer.from(fill, clearEncoding);
        }
        else if (typeof fill === "number") {
            buf.fill(fill);
        }
        else if (fill instanceof Uint8Array) {
            if (fill.length === 0) {
                throw new TypeError(`The argument "value" is invalid. Received ${fill.constructor.name} []`);
            }
            bufFill = fill;
        }
        if (bufFill) {
            if (bufFill.length > buf.length) {
                bufFill = bufFill.subarray(0, buf.length);
            }
            let offset = 0;
            while (offset < size) {
                buf.set(bufFill, offset);
                offset += bufFill.length;
                if (offset + bufFill.length >= size)
                    break;
            }
            if (offset !== size) {
                buf.set(bufFill.subarray(0, size - offset), offset);
            }
        }
        return buf;
    }
    static allocUnsafe(size) {
        return new Buffer(size);
    }
    static byteLength(string, encoding = "utf8") {
        if (typeof string != "string")
            return string.byteLength;
        encoding = normalizeEncoding(encoding) || "utf8";
        return encodingOps[encoding].byteLength(string);
    }
    static concat(list, totalLength) {
        if (totalLength == undefined) {
            totalLength = 0;
            for (const buf of list) {
                totalLength += buf.length;
            }
        }
        const buffer = Buffer.allocUnsafe(totalLength);
        let pos = 0;
        for (const item of list) {
            let buf;
            if (!(item instanceof Buffer)) {
                buf = Buffer.from(item);
            }
            else {
                buf = item;
            }
            buf.copy(buffer, pos);
            pos += buf.length;
        }
        return buffer;
    }
    static from(value, offsetOrEncoding, length) {
        const offset = typeof offsetOrEncoding === "string"
            ? undefined
            : offsetOrEncoding;
        let encoding = typeof offsetOrEncoding === "string"
            ? offsetOrEncoding
            : undefined;
        if (typeof value == "string") {
            encoding = checkEncoding(encoding, false);
            if (encoding === "hex")
                return new Buffer(hex.decodeString(value).buffer);
            if (encoding === "base64")
                return new Buffer(base64.decode(value).buffer);
            return new Buffer(new TextEncoder().encode(value).buffer);
        }
        return new Buffer(value, offset, length);
    }
    static isBuffer(obj) {
        return obj instanceof Buffer;
    }
    static isEncoding(encoding) {
        return (typeof encoding === "string" &&
            encoding.length !== 0 &&
            normalizeEncoding(encoding) !== undefined);
    }
    copy(targetBuffer, targetStart = 0, sourceStart = 0, sourceEnd = this.length) {
        const sourceBuffer = this
            .subarray(sourceStart, sourceEnd)
            .subarray(0, Math.max(0, targetBuffer.length - targetStart));
        if (sourceBuffer.length === 0)
            return 0;
        targetBuffer.set(sourceBuffer, targetStart);
        return sourceBuffer.length;
    }
    equals(otherBuffer) {
        if (!(otherBuffer instanceof Uint8Array)) {
            throw new TypeError(`The "otherBuffer" argument must be an instance of Buffer or Uint8Array. Received type ${typeof otherBuffer}`);
        }
        if (this === otherBuffer)
            return true;
        if (this.byteLength !== otherBuffer.byteLength)
            return false;
        for (let i = 0; i < this.length; i++) {
            if (this[i] !== otherBuffer[i])
                return false;
        }
        return true;
    }
    readBigInt64BE(offset = 0) {
        return new DataView(this.buffer, this.byteOffset, this.byteLength).getBigInt64(offset);
    }
    readBigInt64LE(offset = 0) {
        return new DataView(this.buffer, this.byteOffset, this.byteLength).getBigInt64(offset, true);
    }
    readBigUInt64BE(offset = 0) {
        return new DataView(this.buffer, this.byteOffset, this.byteLength).getBigUint64(offset);
    }
    readBigUInt64LE(offset = 0) {
        return new DataView(this.buffer, this.byteOffset, this.byteLength).getBigUint64(offset, true);
    }
    readDoubleBE(offset = 0) {
        return new DataView(this.buffer, this.byteOffset, this.byteLength).getFloat64(offset);
    }
    readDoubleLE(offset = 0) {
        return new DataView(this.buffer, this.byteOffset, this.byteLength).getFloat64(offset, true);
    }
    readFloatBE(offset = 0) {
        return new DataView(this.buffer, this.byteOffset, this.byteLength).getFloat32(offset);
    }
    readFloatLE(offset = 0) {
        return new DataView(this.buffer, this.byteOffset, this.byteLength).getFloat32(offset, true);
    }
    readInt8(offset = 0) {
        return new DataView(this.buffer, this.byteOffset, this.byteLength).getInt8(offset);
    }
    readInt16BE(offset = 0) {
        return new DataView(this.buffer, this.byteOffset, this.byteLength).getInt16(offset);
    }
    readInt16LE(offset = 0) {
        return new DataView(this.buffer, this.byteOffset, this.byteLength).getInt16(offset, true);
    }
    readInt32BE(offset = 0) {
        return new DataView(this.buffer, this.byteOffset, this.byteLength).getInt32(offset);
    }
    readInt32LE(offset = 0) {
        return new DataView(this.buffer, this.byteOffset, this.byteLength).getInt32(offset, true);
    }
    readUInt8(offset = 0) {
        return new DataView(this.buffer, this.byteOffset, this.byteLength).getUint8(offset);
    }
    readUInt16BE(offset = 0) {
        return new DataView(this.buffer, this.byteOffset, this.byteLength).getUint16(offset);
    }
    readUInt16LE(offset = 0) {
        return new DataView(this.buffer, this.byteOffset, this.byteLength).getUint16(offset, true);
    }
    readUInt32BE(offset = 0) {
        return new DataView(this.buffer, this.byteOffset, this.byteLength).getUint32(offset);
    }
    readUInt32LE(offset = 0) {
        return new DataView(this.buffer, this.byteOffset, this.byteLength).getUint32(offset, true);
    }
    slice(begin = 0, end = this.length) {
        return this.subarray(begin, end);
    }
    toJSON() {
        return { type: "Buffer", data: Array.from(this) };
    }
    toString(encoding = "utf8", start = 0, end = this.length) {
        encoding = checkEncoding(encoding);
        const b = this.subarray(start, end);
        if (encoding === "hex")
            return hex.encodeToString(b);
        if (encoding === "base64")
            return base64.encode(b.buffer);
        return new TextDecoder(encoding).decode(b);
    }
    write(string, offset = 0, length = this.length) {
        return new TextEncoder().encodeInto(string, this.subarray(offset, offset + length)).written;
    }
    writeBigInt64BE(value, offset = 0) {
        new DataView(this.buffer, this.byteOffset, this.byteLength).setBigInt64(offset, value);
        return offset + 4;
    }
    writeBigInt64LE(value, offset = 0) {
        new DataView(this.buffer, this.byteOffset, this.byteLength).setBigInt64(offset, value, true);
        return offset + 4;
    }
    writeBigUInt64BE(value, offset = 0) {
        new DataView(this.buffer, this.byteOffset, this.byteLength).setBigUint64(offset, value);
        return offset + 4;
    }
    writeBigUInt64LE(value, offset = 0) {
        new DataView(this.buffer, this.byteOffset, this.byteLength).setBigUint64(offset, value, true);
        return offset + 4;
    }
    writeDoubleBE(value, offset = 0) {
        new DataView(this.buffer, this.byteOffset, this.byteLength).setFloat64(offset, value);
        return offset + 8;
    }
    writeDoubleLE(value, offset = 0) {
        new DataView(this.buffer, this.byteOffset, this.byteLength).setFloat64(offset, value, true);
        return offset + 8;
    }
    writeFloatBE(value, offset = 0) {
        new DataView(this.buffer, this.byteOffset, this.byteLength).setFloat32(offset, value);
        return offset + 4;
    }
    writeFloatLE(value, offset = 0) {
        new DataView(this.buffer, this.byteOffset, this.byteLength).setFloat32(offset, value, true);
        return offset + 4;
    }
    writeInt8(value, offset = 0) {
        new DataView(this.buffer, this.byteOffset, this.byteLength).setInt8(offset, value);
        return offset + 1;
    }
    writeInt16BE(value, offset = 0) {
        new DataView(this.buffer, this.byteOffset, this.byteLength).setInt16(offset, value);
        return offset + 2;
    }
    writeInt16LE(value, offset = 0) {
        new DataView(this.buffer, this.byteOffset, this.byteLength).setInt16(offset, value, true);
        return offset + 2;
    }
    writeInt32BE(value, offset = 0) {
        new DataView(this.buffer, this.byteOffset, this.byteLength).setUint32(offset, value);
        return offset + 4;
    }
    writeInt32LE(value, offset = 0) {
        new DataView(this.buffer, this.byteOffset, this.byteLength).setInt32(offset, value, true);
        return offset + 4;
    }
    writeUInt8(value, offset = 0) {
        new DataView(this.buffer, this.byteOffset, this.byteLength).setUint8(offset, value);
        return offset + 1;
    }
    writeUInt16BE(value, offset = 0) {
        new DataView(this.buffer, this.byteOffset, this.byteLength).setUint16(offset, value);
        return offset + 2;
    }
    writeUInt16LE(value, offset = 0) {
        new DataView(this.buffer, this.byteOffset, this.byteLength).setUint16(offset, value, true);
        return offset + 2;
    }
    writeUInt32BE(value, offset = 0) {
        new DataView(this.buffer, this.byteOffset, this.byteLength).setUint32(offset, value);
        return offset + 4;
    }
    writeUInt32LE(value, offset = 0) {
        new DataView(this.buffer, this.byteOffset, this.byteLength).setUint32(offset, value, true);
        return offset + 4;
    }
}
export default { Buffer };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVmZmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYnVmZmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sS0FBSyxHQUFHLE1BQU0sb0JBQW9CLENBQUM7QUFDMUMsT0FBTyxLQUFLLE1BQU0sTUFBTSx1QkFBdUIsQ0FBQztBQUNoRCxPQUFPLEVBQWEsaUJBQWlCLEVBQUUsY0FBYyxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBRTNFLE1BQU0sdUJBQXVCLEdBQUc7SUFDOUIsT0FBTztJQUNQLFFBQVE7SUFDUixRQUFRO0lBQ1IsTUFBTTtJQUNOLFNBQVM7Q0FDVixDQUFDO0FBRUYsU0FBUyxhQUFhLENBQUMsUUFBUSxHQUFHLE1BQU0sRUFBRSxNQUFNLEdBQUcsSUFBSTtJQUNyRCxJQUFJLE9BQU8sUUFBUSxLQUFLLFFBQVEsSUFBSSxDQUFDLE1BQU0sSUFBSSxRQUFRLEtBQUssRUFBRSxDQUFDLEVBQUU7UUFDL0QsSUFBSSxDQUFDLE1BQU07WUFBRSxPQUFPLE1BQU0sQ0FBQztRQUMzQixNQUFNLElBQUksU0FBUyxDQUFDLG9CQUFvQixRQUFRLEVBQUUsQ0FBQyxDQUFDO0tBQ3JEO0lBRUQsTUFBTSxVQUFVLEdBQUcsaUJBQWlCLENBQUMsUUFBUSxDQUFDLENBQUM7SUFFL0MsSUFBSSxVQUFVLEtBQUssU0FBUyxFQUFFO1FBQzVCLE1BQU0sSUFBSSxTQUFTLENBQUMsb0JBQW9CLFFBQVEsRUFBRSxDQUFDLENBQUM7S0FDckQ7SUFFRCxJQUFJLHVCQUF1QixDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsRUFBRTtRQUM5QyxjQUFjLENBQUMsSUFBSSxRQUFRLFlBQVksQ0FBQyxDQUFDO0tBQzFDO0lBRUQsT0FBTyxVQUFVLENBQUM7QUFDcEIsQ0FBQztBQU9ELE1BQU0sV0FBVyxHQUFrQztJQUNqRCxJQUFJLEVBQUU7UUFDSixVQUFVLEVBQUUsQ0FBQyxNQUFjLEVBQVUsRUFBRSxDQUNyQyxJQUFJLFdBQVcsRUFBRSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxVQUFVO0tBQzlDO0lBQ0QsSUFBSSxFQUFFO1FBQ0osVUFBVSxFQUFFLENBQUMsTUFBYyxFQUFVLEVBQUUsQ0FBQyxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUM7S0FDMUQ7SUFDRCxPQUFPLEVBQUU7UUFDUCxVQUFVLEVBQUUsQ0FBQyxNQUFjLEVBQVUsRUFBRSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQztLQUMxRDtJQUNELE1BQU0sRUFBRTtRQUNOLFVBQVUsRUFBRSxDQUFDLE1BQWMsRUFBVSxFQUFFLENBQUMsTUFBTSxDQUFDLE1BQU07S0FDdEQ7SUFDRCxLQUFLLEVBQUU7UUFDTCxVQUFVLEVBQUUsQ0FBQyxNQUFjLEVBQVUsRUFBRSxDQUFDLE1BQU0sQ0FBQyxNQUFNO0tBQ3REO0lBQ0QsTUFBTSxFQUFFO1FBQ04sVUFBVSxFQUFFLENBQUMsTUFBYyxFQUFVLEVBQUUsQ0FDckMsZ0JBQWdCLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxNQUFNLENBQUM7S0FDMUM7SUFDRCxHQUFHLEVBQUU7UUFDSCxVQUFVLEVBQUUsQ0FBQyxNQUFjLEVBQVUsRUFBRSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEtBQUssQ0FBQztLQUM1RDtDQUNGLENBQUM7QUFFRixTQUFTLGdCQUFnQixDQUFDLEdBQVcsRUFBRSxLQUFhO0lBRWxELElBQUksR0FBRyxDQUFDLFVBQVUsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLEtBQUssSUFBSTtRQUFFLEtBQUssRUFBRSxDQUFDO0lBQ2hELElBQUksS0FBSyxHQUFHLENBQUMsSUFBSSxHQUFHLENBQUMsVUFBVSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsS0FBSyxJQUFJO1FBQUUsS0FBSyxFQUFFLENBQUM7SUFHN0QsT0FBTyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDM0IsQ0FBQztBQUtELE1BQU0sT0FBTyxNQUFPLFNBQVEsVUFBVTtJQUlwQyxNQUFNLENBQUMsS0FBSyxDQUNWLElBQVksRUFDWixJQUE0QyxFQUM1QyxRQUFRLEdBQUcsTUFBTTtRQUVqQixJQUFJLE9BQU8sSUFBSSxLQUFLLFFBQVEsRUFBRTtZQUM1QixNQUFNLElBQUksU0FBUyxDQUNqQiw2REFBNkQsT0FBTyxJQUFJLEVBQUUsQ0FDM0UsQ0FBQztTQUNIO1FBRUQsTUFBTSxHQUFHLEdBQUcsSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDN0IsSUFBSSxJQUFJLEtBQUssQ0FBQztZQUFFLE9BQU8sR0FBRyxDQUFDO1FBRTNCLElBQUksT0FBTyxDQUFDO1FBQ1osSUFBSSxPQUFPLElBQUksS0FBSyxRQUFRLEVBQUU7WUFDNUIsTUFBTSxhQUFhLEdBQUcsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQzlDLElBQ0UsT0FBTyxJQUFJLEtBQUssUUFBUTtnQkFDeEIsSUFBSSxDQUFDLE1BQU0sS0FBSyxDQUFDO2dCQUNqQixhQUFhLEtBQUssTUFBTSxFQUN4QjtnQkFDQSxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUM5Qjs7Z0JBQU0sT0FBTyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLGFBQWEsQ0FBQyxDQUFDO1NBQ25EO2FBQU0sSUFBSSxPQUFPLElBQUksS0FBSyxRQUFRLEVBQUU7WUFDbkMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUNoQjthQUFNLElBQUksSUFBSSxZQUFZLFVBQVUsRUFBRTtZQUNyQyxJQUFJLElBQUksQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO2dCQUNyQixNQUFNLElBQUksU0FBUyxDQUNqQiw2Q0FBNkMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLEtBQUssQ0FDeEUsQ0FBQzthQUNIO1lBRUQsT0FBTyxHQUFHLElBQUksQ0FBQztTQUNoQjtRQUVELElBQUksT0FBTyxFQUFFO1lBQ1gsSUFBSSxPQUFPLENBQUMsTUFBTSxHQUFHLEdBQUcsQ0FBQyxNQUFNLEVBQUU7Z0JBQy9CLE9BQU8sR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7YUFDM0M7WUFFRCxJQUFJLE1BQU0sR0FBRyxDQUFDLENBQUM7WUFDZixPQUFPLE1BQU0sR0FBRyxJQUFJLEVBQUU7Z0JBQ3BCLEdBQUcsQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLE1BQU0sQ0FBQyxDQUFDO2dCQUN6QixNQUFNLElBQUksT0FBTyxDQUFDLE1BQU0sQ0FBQztnQkFDekIsSUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLE1BQU0sSUFBSSxJQUFJO29CQUFFLE1BQU07YUFDNUM7WUFDRCxJQUFJLE1BQU0sS0FBSyxJQUFJLEVBQUU7Z0JBQ25CLEdBQUcsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsSUFBSSxHQUFHLE1BQU0sQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO2FBQ3JEO1NBQ0Y7UUFFRCxPQUFPLEdBQUcsQ0FBQztJQUNiLENBQUM7SUFFRCxNQUFNLENBQUMsV0FBVyxDQUFDLElBQVk7UUFDN0IsT0FBTyxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUMxQixDQUFDO0lBT0QsTUFBTSxDQUFDLFVBQVUsQ0FDZixNQUEyRSxFQUMzRSxRQUFRLEdBQUcsTUFBTTtRQUVqQixJQUFJLE9BQU8sTUFBTSxJQUFJLFFBQVE7WUFBRSxPQUFPLE1BQU0sQ0FBQyxVQUFVLENBQUM7UUFFeEQsUUFBUSxHQUFHLGlCQUFpQixDQUFDLFFBQVEsQ0FBQyxJQUFJLE1BQU0sQ0FBQztRQUNqRCxPQUFPLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDbEQsQ0FBQztJQU1ELE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBNkIsRUFBRSxXQUFvQjtRQUMvRCxJQUFJLFdBQVcsSUFBSSxTQUFTLEVBQUU7WUFDNUIsV0FBVyxHQUFHLENBQUMsQ0FBQztZQUNoQixLQUFLLE1BQU0sR0FBRyxJQUFJLElBQUksRUFBRTtnQkFDdEIsV0FBVyxJQUFJLEdBQUcsQ0FBQyxNQUFNLENBQUM7YUFDM0I7U0FDRjtRQUVELE1BQU0sTUFBTSxHQUFHLE1BQU0sQ0FBQyxXQUFXLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDL0MsSUFBSSxHQUFHLEdBQUcsQ0FBQyxDQUFDO1FBQ1osS0FBSyxNQUFNLElBQUksSUFBSSxJQUFJLEVBQUU7WUFDdkIsSUFBSSxHQUFXLENBQUM7WUFDaEIsSUFBSSxDQUFDLENBQUMsSUFBSSxZQUFZLE1BQU0sQ0FBQyxFQUFFO2dCQUM3QixHQUFHLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQzthQUN6QjtpQkFBTTtnQkFDTCxHQUFHLEdBQUcsSUFBSSxDQUFDO2FBQ1o7WUFDRCxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsQ0FBQztZQUN0QixHQUFHLElBQUksR0FBRyxDQUFDLE1BQU0sQ0FBQztTQUNuQjtRQUVELE9BQU8sTUFBTSxDQUFDO0lBQ2hCLENBQUM7SUEwQkQsTUFBTSxDQUFDLElBQUksQ0FFVCxLQUFVLEVBQ1YsZ0JBQWtDLEVBQ2xDLE1BQWU7UUFFZixNQUFNLE1BQU0sR0FBRyxPQUFPLGdCQUFnQixLQUFLLFFBQVE7WUFDakQsQ0FBQyxDQUFDLFNBQVM7WUFDWCxDQUFDLENBQUMsZ0JBQWdCLENBQUM7UUFDckIsSUFBSSxRQUFRLEdBQUcsT0FBTyxnQkFBZ0IsS0FBSyxRQUFRO1lBQ2pELENBQUMsQ0FBQyxnQkFBZ0I7WUFDbEIsQ0FBQyxDQUFDLFNBQVMsQ0FBQztRQUVkLElBQUksT0FBTyxLQUFLLElBQUksUUFBUSxFQUFFO1lBQzVCLFFBQVEsR0FBRyxhQUFhLENBQUMsUUFBUSxFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQzFDLElBQUksUUFBUSxLQUFLLEtBQUs7Z0JBQUUsT0FBTyxJQUFJLE1BQU0sQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLEtBQUssQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzFFLElBQUksUUFBUSxLQUFLLFFBQVE7Z0JBQUUsT0FBTyxJQUFJLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzFFLE9BQU8sSUFBSSxNQUFNLENBQUMsSUFBSSxXQUFXLEVBQUUsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUM7U0FDM0Q7UUFHRCxPQUFPLElBQUksTUFBTSxDQUFDLEtBQUssRUFBRSxNQUFPLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDNUMsQ0FBQztJQUtELE1BQU0sQ0FBQyxRQUFRLENBQUMsR0FBWTtRQUMxQixPQUFPLEdBQUcsWUFBWSxNQUFNLENBQUM7SUFDL0IsQ0FBQztJQUdELE1BQU0sQ0FBQyxVQUFVLENBQUMsUUFBYTtRQUM3QixPQUFPLENBQ0wsT0FBTyxRQUFRLEtBQUssUUFBUTtZQUM1QixRQUFRLENBQUMsTUFBTSxLQUFLLENBQUM7WUFDckIsaUJBQWlCLENBQUMsUUFBUSxDQUFDLEtBQUssU0FBUyxDQUMxQyxDQUFDO0lBQ0osQ0FBQztJQU1ELElBQUksQ0FDRixZQUFpQyxFQUNqQyxXQUFXLEdBQUcsQ0FBQyxFQUNmLFdBQVcsR0FBRyxDQUFDLEVBQ2YsU0FBUyxHQUFHLElBQUksQ0FBQyxNQUFNO1FBRXZCLE1BQU0sWUFBWSxHQUFHLElBQUk7YUFDdEIsUUFBUSxDQUFDLFdBQVcsRUFBRSxTQUFTLENBQUM7YUFDaEMsUUFBUSxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxZQUFZLENBQUMsTUFBTSxHQUFHLFdBQVcsQ0FBQyxDQUFDLENBQUM7UUFFL0QsSUFBSSxZQUFZLENBQUMsTUFBTSxLQUFLLENBQUM7WUFBRSxPQUFPLENBQUMsQ0FBQztRQUV4QyxZQUFZLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxXQUFXLENBQUMsQ0FBQztRQUM1QyxPQUFPLFlBQVksQ0FBQyxNQUFNLENBQUM7SUFDN0IsQ0FBQztJQUtELE1BQU0sQ0FBQyxXQUFnQztRQUNyQyxJQUFJLENBQUMsQ0FBQyxXQUFXLFlBQVksVUFBVSxDQUFDLEVBQUU7WUFDeEMsTUFBTSxJQUFJLFNBQVMsQ0FDakIseUZBQXlGLE9BQU8sV0FBVyxFQUFFLENBQzlHLENBQUM7U0FDSDtRQUVELElBQUksSUFBSSxLQUFLLFdBQVc7WUFBRSxPQUFPLElBQUksQ0FBQztRQUN0QyxJQUFJLElBQUksQ0FBQyxVQUFVLEtBQUssV0FBVyxDQUFDLFVBQVU7WUFBRSxPQUFPLEtBQUssQ0FBQztRQUU3RCxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUNwQyxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsS0FBSyxXQUFXLENBQUMsQ0FBQyxDQUFDO2dCQUFFLE9BQU8sS0FBSyxDQUFDO1NBQzlDO1FBRUQsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRUQsY0FBYyxDQUFDLE1BQU0sR0FBRyxDQUFDO1FBQ3ZCLE9BQU8sSUFBSSxRQUFRLENBQ2pCLElBQUksQ0FBQyxNQUFNLEVBQ1gsSUFBSSxDQUFDLFVBQVUsRUFDZixJQUFJLENBQUMsVUFBVSxDQUNoQixDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUN4QixDQUFDO0lBQ0QsY0FBYyxDQUFDLE1BQU0sR0FBRyxDQUFDO1FBQ3ZCLE9BQU8sSUFBSSxRQUFRLENBQ2pCLElBQUksQ0FBQyxNQUFNLEVBQ1gsSUFBSSxDQUFDLFVBQVUsRUFDZixJQUFJLENBQUMsVUFBVSxDQUNoQixDQUFDLFdBQVcsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDOUIsQ0FBQztJQUVELGVBQWUsQ0FBQyxNQUFNLEdBQUcsQ0FBQztRQUN4QixPQUFPLElBQUksUUFBUSxDQUNqQixJQUFJLENBQUMsTUFBTSxFQUNYLElBQUksQ0FBQyxVQUFVLEVBQ2YsSUFBSSxDQUFDLFVBQVUsQ0FDaEIsQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDekIsQ0FBQztJQUNELGVBQWUsQ0FBQyxNQUFNLEdBQUcsQ0FBQztRQUN4QixPQUFPLElBQUksUUFBUSxDQUNqQixJQUFJLENBQUMsTUFBTSxFQUNYLElBQUksQ0FBQyxVQUFVLEVBQ2YsSUFBSSxDQUFDLFVBQVUsQ0FDaEIsQ0FBQyxZQUFZLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQy9CLENBQUM7SUFFRCxZQUFZLENBQUMsTUFBTSxHQUFHLENBQUM7UUFDckIsT0FBTyxJQUFJLFFBQVEsQ0FDakIsSUFBSSxDQUFDLE1BQU0sRUFDWCxJQUFJLENBQUMsVUFBVSxFQUNmLElBQUksQ0FBQyxVQUFVLENBQ2hCLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3ZCLENBQUM7SUFDRCxZQUFZLENBQUMsTUFBTSxHQUFHLENBQUM7UUFDckIsT0FBTyxJQUFJLFFBQVEsQ0FDakIsSUFBSSxDQUFDLE1BQU0sRUFDWCxJQUFJLENBQUMsVUFBVSxFQUNmLElBQUksQ0FBQyxVQUFVLENBQ2hCLENBQUMsVUFBVSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FBQztJQUM3QixDQUFDO0lBRUQsV0FBVyxDQUFDLE1BQU0sR0FBRyxDQUFDO1FBQ3BCLE9BQU8sSUFBSSxRQUFRLENBQ2pCLElBQUksQ0FBQyxNQUFNLEVBQ1gsSUFBSSxDQUFDLFVBQVUsRUFDZixJQUFJLENBQUMsVUFBVSxDQUNoQixDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUN2QixDQUFDO0lBQ0QsV0FBVyxDQUFDLE1BQU0sR0FBRyxDQUFDO1FBQ3BCLE9BQU8sSUFBSSxRQUFRLENBQ2pCLElBQUksQ0FBQyxNQUFNLEVBQ1gsSUFBSSxDQUFDLFVBQVUsRUFDZixJQUFJLENBQUMsVUFBVSxDQUNoQixDQUFDLFVBQVUsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDN0IsQ0FBQztJQUVELFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQztRQUNqQixPQUFPLElBQUksUUFBUSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsT0FBTyxDQUN4RSxNQUFNLENBQ1AsQ0FBQztJQUNKLENBQUM7SUFFRCxXQUFXLENBQUMsTUFBTSxHQUFHLENBQUM7UUFDcEIsT0FBTyxJQUFJLFFBQVEsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLFFBQVEsQ0FDekUsTUFBTSxDQUNQLENBQUM7SUFDSixDQUFDO0lBQ0QsV0FBVyxDQUFDLE1BQU0sR0FBRyxDQUFDO1FBQ3BCLE9BQU8sSUFBSSxRQUFRLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxRQUFRLENBQ3pFLE1BQU0sRUFDTixJQUFJLENBQ0wsQ0FBQztJQUNKLENBQUM7SUFFRCxXQUFXLENBQUMsTUFBTSxHQUFHLENBQUM7UUFDcEIsT0FBTyxJQUFJLFFBQVEsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLFFBQVEsQ0FDekUsTUFBTSxDQUNQLENBQUM7SUFDSixDQUFDO0lBQ0QsV0FBVyxDQUFDLE1BQU0sR0FBRyxDQUFDO1FBQ3BCLE9BQU8sSUFBSSxRQUFRLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxRQUFRLENBQ3pFLE1BQU0sRUFDTixJQUFJLENBQ0wsQ0FBQztJQUNKLENBQUM7SUFFRCxTQUFTLENBQUMsTUFBTSxHQUFHLENBQUM7UUFDbEIsT0FBTyxJQUFJLFFBQVEsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLFFBQVEsQ0FDekUsTUFBTSxDQUNQLENBQUM7SUFDSixDQUFDO0lBRUQsWUFBWSxDQUFDLE1BQU0sR0FBRyxDQUFDO1FBQ3JCLE9BQU8sSUFBSSxRQUFRLENBQ2pCLElBQUksQ0FBQyxNQUFNLEVBQ1gsSUFBSSxDQUFDLFVBQVUsRUFDZixJQUFJLENBQUMsVUFBVSxDQUNoQixDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUN0QixDQUFDO0lBQ0QsWUFBWSxDQUFDLE1BQU0sR0FBRyxDQUFDO1FBQ3JCLE9BQU8sSUFBSSxRQUFRLENBQ2pCLElBQUksQ0FBQyxNQUFNLEVBQ1gsSUFBSSxDQUFDLFVBQVUsRUFDZixJQUFJLENBQUMsVUFBVSxDQUNoQixDQUFDLFNBQVMsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDNUIsQ0FBQztJQUVELFlBQVksQ0FBQyxNQUFNLEdBQUcsQ0FBQztRQUNyQixPQUFPLElBQUksUUFBUSxDQUNqQixJQUFJLENBQUMsTUFBTSxFQUNYLElBQUksQ0FBQyxVQUFVLEVBQ2YsSUFBSSxDQUFDLFVBQVUsQ0FDaEIsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDdEIsQ0FBQztJQUNELFlBQVksQ0FBQyxNQUFNLEdBQUcsQ0FBQztRQUNyQixPQUFPLElBQUksUUFBUSxDQUNqQixJQUFJLENBQUMsTUFBTSxFQUNYLElBQUksQ0FBQyxVQUFVLEVBQ2YsSUFBSSxDQUFDLFVBQVUsQ0FDaEIsQ0FBQyxTQUFTLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQzVCLENBQUM7SUFNRCxLQUFLLENBQUMsS0FBSyxHQUFHLENBQUMsRUFBRSxHQUFHLEdBQUcsSUFBSSxDQUFDLE1BQU07UUFFaEMsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssRUFBRSxHQUFHLENBQVcsQ0FBQztJQUM3QyxDQUFDO0lBTUQsTUFBTTtRQUNKLE9BQU8sRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7SUFDcEQsQ0FBQztJQU1ELFFBQVEsQ0FBQyxRQUFRLEdBQUcsTUFBTSxFQUFFLEtBQUssR0FBRyxDQUFDLEVBQUUsR0FBRyxHQUFHLElBQUksQ0FBQyxNQUFNO1FBQ3RELFFBQVEsR0FBRyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUM7UUFFbkMsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDcEMsSUFBSSxRQUFRLEtBQUssS0FBSztZQUFFLE9BQU8sR0FBRyxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNyRCxJQUFJLFFBQVEsS0FBSyxRQUFRO1lBQUUsT0FBTyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUUxRCxPQUFPLElBQUksV0FBVyxDQUFDLFFBQVEsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUM3QyxDQUFDO0lBUUQsS0FBSyxDQUFDLE1BQWMsRUFBRSxNQUFNLEdBQUcsQ0FBQyxFQUFFLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTTtRQUNwRCxPQUFPLElBQUksV0FBVyxFQUFFLENBQUMsVUFBVSxDQUNqQyxNQUFNLEVBQ04sSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUUsTUFBTSxHQUFHLE1BQU0sQ0FBQyxDQUN2QyxDQUFDLE9BQU8sQ0FBQztJQUNaLENBQUM7SUFFRCxlQUFlLENBQUMsS0FBYSxFQUFFLE1BQU0sR0FBRyxDQUFDO1FBQ3ZDLElBQUksUUFBUSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsV0FBVyxDQUNyRSxNQUFNLEVBQ04sS0FBSyxDQUNOLENBQUM7UUFDRixPQUFPLE1BQU0sR0FBRyxDQUFDLENBQUM7SUFDcEIsQ0FBQztJQUNELGVBQWUsQ0FBQyxLQUFhLEVBQUUsTUFBTSxHQUFHLENBQUM7UUFDdkMsSUFBSSxRQUFRLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxXQUFXLENBQ3JFLE1BQU0sRUFDTixLQUFLLEVBQ0wsSUFBSSxDQUNMLENBQUM7UUFDRixPQUFPLE1BQU0sR0FBRyxDQUFDLENBQUM7SUFDcEIsQ0FBQztJQUVELGdCQUFnQixDQUFDLEtBQWEsRUFBRSxNQUFNLEdBQUcsQ0FBQztRQUN4QyxJQUFJLFFBQVEsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLFlBQVksQ0FDdEUsTUFBTSxFQUNOLEtBQUssQ0FDTixDQUFDO1FBQ0YsT0FBTyxNQUFNLEdBQUcsQ0FBQyxDQUFDO0lBQ3BCLENBQUM7SUFDRCxnQkFBZ0IsQ0FBQyxLQUFhLEVBQUUsTUFBTSxHQUFHLENBQUM7UUFDeEMsSUFBSSxRQUFRLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxZQUFZLENBQ3RFLE1BQU0sRUFDTixLQUFLLEVBQ0wsSUFBSSxDQUNMLENBQUM7UUFDRixPQUFPLE1BQU0sR0FBRyxDQUFDLENBQUM7SUFDcEIsQ0FBQztJQUVELGFBQWEsQ0FBQyxLQUFhLEVBQUUsTUFBTSxHQUFHLENBQUM7UUFDckMsSUFBSSxRQUFRLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxVQUFVLENBQ3BFLE1BQU0sRUFDTixLQUFLLENBQ04sQ0FBQztRQUNGLE9BQU8sTUFBTSxHQUFHLENBQUMsQ0FBQztJQUNwQixDQUFDO0lBQ0QsYUFBYSxDQUFDLEtBQWEsRUFBRSxNQUFNLEdBQUcsQ0FBQztRQUNyQyxJQUFJLFFBQVEsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLFVBQVUsQ0FDcEUsTUFBTSxFQUNOLEtBQUssRUFDTCxJQUFJLENBQ0wsQ0FBQztRQUNGLE9BQU8sTUFBTSxHQUFHLENBQUMsQ0FBQztJQUNwQixDQUFDO0lBRUQsWUFBWSxDQUFDLEtBQWEsRUFBRSxNQUFNLEdBQUcsQ0FBQztRQUNwQyxJQUFJLFFBQVEsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLFVBQVUsQ0FDcEUsTUFBTSxFQUNOLEtBQUssQ0FDTixDQUFDO1FBQ0YsT0FBTyxNQUFNLEdBQUcsQ0FBQyxDQUFDO0lBQ3BCLENBQUM7SUFDRCxZQUFZLENBQUMsS0FBYSxFQUFFLE1BQU0sR0FBRyxDQUFDO1FBQ3BDLElBQUksUUFBUSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsVUFBVSxDQUNwRSxNQUFNLEVBQ04sS0FBSyxFQUNMLElBQUksQ0FDTCxDQUFDO1FBQ0YsT0FBTyxNQUFNLEdBQUcsQ0FBQyxDQUFDO0lBQ3BCLENBQUM7SUFFRCxTQUFTLENBQUMsS0FBYSxFQUFFLE1BQU0sR0FBRyxDQUFDO1FBQ2pDLElBQUksUUFBUSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsT0FBTyxDQUNqRSxNQUFNLEVBQ04sS0FBSyxDQUNOLENBQUM7UUFDRixPQUFPLE1BQU0sR0FBRyxDQUFDLENBQUM7SUFDcEIsQ0FBQztJQUVELFlBQVksQ0FBQyxLQUFhLEVBQUUsTUFBTSxHQUFHLENBQUM7UUFDcEMsSUFBSSxRQUFRLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxRQUFRLENBQ2xFLE1BQU0sRUFDTixLQUFLLENBQ04sQ0FBQztRQUNGLE9BQU8sTUFBTSxHQUFHLENBQUMsQ0FBQztJQUNwQixDQUFDO0lBQ0QsWUFBWSxDQUFDLEtBQWEsRUFBRSxNQUFNLEdBQUcsQ0FBQztRQUNwQyxJQUFJLFFBQVEsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLFFBQVEsQ0FDbEUsTUFBTSxFQUNOLEtBQUssRUFDTCxJQUFJLENBQ0wsQ0FBQztRQUNGLE9BQU8sTUFBTSxHQUFHLENBQUMsQ0FBQztJQUNwQixDQUFDO0lBRUQsWUFBWSxDQUFDLEtBQWEsRUFBRSxNQUFNLEdBQUcsQ0FBQztRQUNwQyxJQUFJLFFBQVEsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLFNBQVMsQ0FDbkUsTUFBTSxFQUNOLEtBQUssQ0FDTixDQUFDO1FBQ0YsT0FBTyxNQUFNLEdBQUcsQ0FBQyxDQUFDO0lBQ3BCLENBQUM7SUFDRCxZQUFZLENBQUMsS0FBYSxFQUFFLE1BQU0sR0FBRyxDQUFDO1FBQ3BDLElBQUksUUFBUSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsUUFBUSxDQUNsRSxNQUFNLEVBQ04sS0FBSyxFQUNMLElBQUksQ0FDTCxDQUFDO1FBQ0YsT0FBTyxNQUFNLEdBQUcsQ0FBQyxDQUFDO0lBQ3BCLENBQUM7SUFFRCxVQUFVLENBQUMsS0FBYSxFQUFFLE1BQU0sR0FBRyxDQUFDO1FBQ2xDLElBQUksUUFBUSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsUUFBUSxDQUNsRSxNQUFNLEVBQ04sS0FBSyxDQUNOLENBQUM7UUFDRixPQUFPLE1BQU0sR0FBRyxDQUFDLENBQUM7SUFDcEIsQ0FBQztJQUVELGFBQWEsQ0FBQyxLQUFhLEVBQUUsTUFBTSxHQUFHLENBQUM7UUFDckMsSUFBSSxRQUFRLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxTQUFTLENBQ25FLE1BQU0sRUFDTixLQUFLLENBQ04sQ0FBQztRQUNGLE9BQU8sTUFBTSxHQUFHLENBQUMsQ0FBQztJQUNwQixDQUFDO0lBQ0QsYUFBYSxDQUFDLEtBQWEsRUFBRSxNQUFNLEdBQUcsQ0FBQztRQUNyQyxJQUFJLFFBQVEsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLFNBQVMsQ0FDbkUsTUFBTSxFQUNOLEtBQUssRUFDTCxJQUFJLENBQ0wsQ0FBQztRQUNGLE9BQU8sTUFBTSxHQUFHLENBQUMsQ0FBQztJQUNwQixDQUFDO0lBRUQsYUFBYSxDQUFDLEtBQWEsRUFBRSxNQUFNLEdBQUcsQ0FBQztRQUNyQyxJQUFJLFFBQVEsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLFNBQVMsQ0FDbkUsTUFBTSxFQUNOLEtBQUssQ0FDTixDQUFDO1FBQ0YsT0FBTyxNQUFNLEdBQUcsQ0FBQyxDQUFDO0lBQ3BCLENBQUM7SUFDRCxhQUFhLENBQUMsS0FBYSxFQUFFLE1BQU0sR0FBRyxDQUFDO1FBQ3JDLElBQUksUUFBUSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsU0FBUyxDQUNuRSxNQUFNLEVBQ04sS0FBSyxFQUNMLElBQUksQ0FDTCxDQUFDO1FBQ0YsT0FBTyxNQUFNLEdBQUcsQ0FBQyxDQUFDO0lBQ3BCLENBQUM7Q0FDRjtBQUVELGVBQWUsRUFBRSxNQUFNLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAyMDE4LTIwMjEgdGhlIERlbm8gYXV0aG9ycy4gQWxsIHJpZ2h0cyByZXNlcnZlZC4gTUlUIGxpY2Vuc2UuXG5pbXBvcnQgKiBhcyBoZXggZnJvbSBcIi4uL2VuY29kaW5nL2hleC50c1wiO1xuaW1wb3J0ICogYXMgYmFzZTY0IGZyb20gXCIuLi9lbmNvZGluZy9iYXNlNjQudHNcIjtcbmltcG9ydCB7IEVuY29kaW5ncywgbm9ybWFsaXplRW5jb2RpbmcsIG5vdEltcGxlbWVudGVkIH0gZnJvbSBcIi4vX3V0aWxzLnRzXCI7XG5cbmNvbnN0IG5vdEltcGxlbWVudGVkRW5jb2RpbmdzID0gW1xuICBcImFzY2lpXCIsXG4gIFwiYmluYXJ5XCIsXG4gIFwibGF0aW4xXCIsXG4gIFwidWNzMlwiLFxuICBcInV0ZjE2bGVcIixcbl07XG5cbmZ1bmN0aW9uIGNoZWNrRW5jb2RpbmcoZW5jb2RpbmcgPSBcInV0ZjhcIiwgc3RyaWN0ID0gdHJ1ZSk6IEVuY29kaW5ncyB7XG4gIGlmICh0eXBlb2YgZW5jb2RpbmcgIT09IFwic3RyaW5nXCIgfHwgKHN0cmljdCAmJiBlbmNvZGluZyA9PT0gXCJcIikpIHtcbiAgICBpZiAoIXN0cmljdCkgcmV0dXJuIFwidXRmOFwiO1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoYFVua293biBlbmNvZGluZzogJHtlbmNvZGluZ31gKTtcbiAgfVxuXG4gIGNvbnN0IG5vcm1hbGl6ZWQgPSBub3JtYWxpemVFbmNvZGluZyhlbmNvZGluZyk7XG5cbiAgaWYgKG5vcm1hbGl6ZWQgPT09IHVuZGVmaW5lZCkge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoYFVua293biBlbmNvZGluZzogJHtlbmNvZGluZ31gKTtcbiAgfVxuXG4gIGlmIChub3RJbXBsZW1lbnRlZEVuY29kaW5ncy5pbmNsdWRlcyhlbmNvZGluZykpIHtcbiAgICBub3RJbXBsZW1lbnRlZChgXCIke2VuY29kaW5nfVwiIGVuY29kaW5nYCk7XG4gIH1cblxuICByZXR1cm4gbm9ybWFsaXplZDtcbn1cblxuaW50ZXJmYWNlIEVuY29kaW5nT3Age1xuICBieXRlTGVuZ3RoKHN0cmluZzogc3RyaW5nKTogbnVtYmVyO1xufVxuXG4vLyBodHRwczovL2dpdGh1Yi5jb20vbm9kZWpzL25vZGUvYmxvYi81NmRiZTQ2NmZkYmM1OThiYWVhM2JmY2UyODliZjUyYjk3YjhiOGY3L2xpYi9idWZmZXIuanMjTDU5OFxuY29uc3QgZW5jb2RpbmdPcHM6IHsgW2tleTogc3RyaW5nXTogRW5jb2RpbmdPcCB9ID0ge1xuICB1dGY4OiB7XG4gICAgYnl0ZUxlbmd0aDogKHN0cmluZzogc3RyaW5nKTogbnVtYmVyID0+XG4gICAgICBuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUoc3RyaW5nKS5ieXRlTGVuZ3RoLFxuICB9LFxuICB1Y3MyOiB7XG4gICAgYnl0ZUxlbmd0aDogKHN0cmluZzogc3RyaW5nKTogbnVtYmVyID0+IHN0cmluZy5sZW5ndGggKiAyLFxuICB9LFxuICB1dGYxNmxlOiB7XG4gICAgYnl0ZUxlbmd0aDogKHN0cmluZzogc3RyaW5nKTogbnVtYmVyID0+IHN0cmluZy5sZW5ndGggKiAyLFxuICB9LFxuICBsYXRpbjE6IHtcbiAgICBieXRlTGVuZ3RoOiAoc3RyaW5nOiBzdHJpbmcpOiBudW1iZXIgPT4gc3RyaW5nLmxlbmd0aCxcbiAgfSxcbiAgYXNjaWk6IHtcbiAgICBieXRlTGVuZ3RoOiAoc3RyaW5nOiBzdHJpbmcpOiBudW1iZXIgPT4gc3RyaW5nLmxlbmd0aCxcbiAgfSxcbiAgYmFzZTY0OiB7XG4gICAgYnl0ZUxlbmd0aDogKHN0cmluZzogc3RyaW5nKTogbnVtYmVyID0+XG4gICAgICBiYXNlNjRCeXRlTGVuZ3RoKHN0cmluZywgc3RyaW5nLmxlbmd0aCksXG4gIH0sXG4gIGhleDoge1xuICAgIGJ5dGVMZW5ndGg6IChzdHJpbmc6IHN0cmluZyk6IG51bWJlciA9PiBzdHJpbmcubGVuZ3RoID4+PiAxLFxuICB9LFxufTtcblxuZnVuY3Rpb24gYmFzZTY0Qnl0ZUxlbmd0aChzdHI6IHN0cmluZywgYnl0ZXM6IG51bWJlcik6IG51bWJlciB7XG4gIC8vIEhhbmRsZSBwYWRkaW5nXG4gIGlmIChzdHIuY2hhckNvZGVBdChieXRlcyAtIDEpID09PSAweDNkKSBieXRlcy0tO1xuICBpZiAoYnl0ZXMgPiAxICYmIHN0ci5jaGFyQ29kZUF0KGJ5dGVzIC0gMSkgPT09IDB4M2QpIGJ5dGVzLS07XG5cbiAgLy8gQmFzZTY0IHJhdGlvOiAzLzRcbiAgcmV0dXJuIChieXRlcyAqIDMpID4+PiAyO1xufVxuXG4vKipcbiAqIFNlZSBhbHNvIGh0dHBzOi8vbm9kZWpzLm9yZy9hcGkvYnVmZmVyLmh0bWxcbiAqL1xuZXhwb3J0IGNsYXNzIEJ1ZmZlciBleHRlbmRzIFVpbnQ4QXJyYXkge1xuICAvKipcbiAgICogQWxsb2NhdGVzIGEgbmV3IEJ1ZmZlciBvZiBzaXplIGJ5dGVzLlxuICAgKi9cbiAgc3RhdGljIGFsbG9jKFxuICAgIHNpemU6IG51bWJlcixcbiAgICBmaWxsPzogbnVtYmVyIHwgc3RyaW5nIHwgVWludDhBcnJheSB8IEJ1ZmZlcixcbiAgICBlbmNvZGluZyA9IFwidXRmOFwiLFxuICApOiBCdWZmZXIge1xuICAgIGlmICh0eXBlb2Ygc2l6ZSAhPT0gXCJudW1iZXJcIikge1xuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcbiAgICAgICAgYFRoZSBcInNpemVcIiBhcmd1bWVudCBtdXN0IGJlIG9mIHR5cGUgbnVtYmVyLiBSZWNlaXZlZCB0eXBlICR7dHlwZW9mIHNpemV9YCxcbiAgICAgICk7XG4gICAgfVxuXG4gICAgY29uc3QgYnVmID0gbmV3IEJ1ZmZlcihzaXplKTtcbiAgICBpZiAoc2l6ZSA9PT0gMCkgcmV0dXJuIGJ1ZjtcblxuICAgIGxldCBidWZGaWxsO1xuICAgIGlmICh0eXBlb2YgZmlsbCA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgY29uc3QgY2xlYXJFbmNvZGluZyA9IGNoZWNrRW5jb2RpbmcoZW5jb2RpbmcpO1xuICAgICAgaWYgKFxuICAgICAgICB0eXBlb2YgZmlsbCA9PT0gXCJzdHJpbmdcIiAmJlxuICAgICAgICBmaWxsLmxlbmd0aCA9PT0gMSAmJlxuICAgICAgICBjbGVhckVuY29kaW5nID09PSBcInV0ZjhcIlxuICAgICAgKSB7XG4gICAgICAgIGJ1Zi5maWxsKGZpbGwuY2hhckNvZGVBdCgwKSk7XG4gICAgICB9IGVsc2UgYnVmRmlsbCA9IEJ1ZmZlci5mcm9tKGZpbGwsIGNsZWFyRW5jb2RpbmcpO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIGZpbGwgPT09IFwibnVtYmVyXCIpIHtcbiAgICAgIGJ1Zi5maWxsKGZpbGwpO1xuICAgIH0gZWxzZSBpZiAoZmlsbCBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkpIHtcbiAgICAgIGlmIChmaWxsLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFxuICAgICAgICAgIGBUaGUgYXJndW1lbnQgXCJ2YWx1ZVwiIGlzIGludmFsaWQuIFJlY2VpdmVkICR7ZmlsbC5jb25zdHJ1Y3Rvci5uYW1lfSBbXWAsXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGJ1ZkZpbGwgPSBmaWxsO1xuICAgIH1cblxuICAgIGlmIChidWZGaWxsKSB7XG4gICAgICBpZiAoYnVmRmlsbC5sZW5ndGggPiBidWYubGVuZ3RoKSB7XG4gICAgICAgIGJ1ZkZpbGwgPSBidWZGaWxsLnN1YmFycmF5KDAsIGJ1Zi5sZW5ndGgpO1xuICAgICAgfVxuXG4gICAgICBsZXQgb2Zmc2V0ID0gMDtcbiAgICAgIHdoaWxlIChvZmZzZXQgPCBzaXplKSB7XG4gICAgICAgIGJ1Zi5zZXQoYnVmRmlsbCwgb2Zmc2V0KTtcbiAgICAgICAgb2Zmc2V0ICs9IGJ1ZkZpbGwubGVuZ3RoO1xuICAgICAgICBpZiAob2Zmc2V0ICsgYnVmRmlsbC5sZW5ndGggPj0gc2l6ZSkgYnJlYWs7XG4gICAgICB9XG4gICAgICBpZiAob2Zmc2V0ICE9PSBzaXplKSB7XG4gICAgICAgIGJ1Zi5zZXQoYnVmRmlsbC5zdWJhcnJheSgwLCBzaXplIC0gb2Zmc2V0KSwgb2Zmc2V0KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gYnVmO1xuICB9XG5cbiAgc3RhdGljIGFsbG9jVW5zYWZlKHNpemU6IG51bWJlcik6IEJ1ZmZlciB7XG4gICAgcmV0dXJuIG5ldyBCdWZmZXIoc2l6ZSk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgYnl0ZSBsZW5ndGggb2YgYSBzdHJpbmcgd2hlbiBlbmNvZGVkLiBUaGlzIGlzIG5vdCB0aGUgc2FtZSBhc1xuICAgKiBTdHJpbmcucHJvdG90eXBlLmxlbmd0aCwgd2hpY2ggZG9lcyBub3QgYWNjb3VudCBmb3IgdGhlIGVuY29kaW5nIHRoYXQgaXNcbiAgICogdXNlZCB0byBjb252ZXJ0IHRoZSBzdHJpbmcgaW50byBieXRlcy5cbiAgICovXG4gIHN0YXRpYyBieXRlTGVuZ3RoKFxuICAgIHN0cmluZzogc3RyaW5nIHwgQnVmZmVyIHwgQXJyYXlCdWZmZXJWaWV3IHwgQXJyYXlCdWZmZXIgfCBTaGFyZWRBcnJheUJ1ZmZlcixcbiAgICBlbmNvZGluZyA9IFwidXRmOFwiLFxuICApOiBudW1iZXIge1xuICAgIGlmICh0eXBlb2Ygc3RyaW5nICE9IFwic3RyaW5nXCIpIHJldHVybiBzdHJpbmcuYnl0ZUxlbmd0aDtcblxuICAgIGVuY29kaW5nID0gbm9ybWFsaXplRW5jb2RpbmcoZW5jb2RpbmcpIHx8IFwidXRmOFwiO1xuICAgIHJldHVybiBlbmNvZGluZ09wc1tlbmNvZGluZ10uYnl0ZUxlbmd0aChzdHJpbmcpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYSBuZXcgQnVmZmVyIHdoaWNoIGlzIHRoZSByZXN1bHQgb2YgY29uY2F0ZW5hdGluZyBhbGwgdGhlIEJ1ZmZlclxuICAgKiBpbnN0YW5jZXMgaW4gdGhlIGxpc3QgdG9nZXRoZXIuXG4gICAqL1xuICBzdGF0aWMgY29uY2F0KGxpc3Q6IEJ1ZmZlcltdIHwgVWludDhBcnJheVtdLCB0b3RhbExlbmd0aD86IG51bWJlcik6IEJ1ZmZlciB7XG4gICAgaWYgKHRvdGFsTGVuZ3RoID09IHVuZGVmaW5lZCkge1xuICAgICAgdG90YWxMZW5ndGggPSAwO1xuICAgICAgZm9yIChjb25zdCBidWYgb2YgbGlzdCkge1xuICAgICAgICB0b3RhbExlbmd0aCArPSBidWYubGVuZ3RoO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IGJ1ZmZlciA9IEJ1ZmZlci5hbGxvY1Vuc2FmZSh0b3RhbExlbmd0aCk7XG4gICAgbGV0IHBvcyA9IDA7XG4gICAgZm9yIChjb25zdCBpdGVtIG9mIGxpc3QpIHtcbiAgICAgIGxldCBidWY6IEJ1ZmZlcjtcbiAgICAgIGlmICghKGl0ZW0gaW5zdGFuY2VvZiBCdWZmZXIpKSB7XG4gICAgICAgIGJ1ZiA9IEJ1ZmZlci5mcm9tKGl0ZW0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYnVmID0gaXRlbTtcbiAgICAgIH1cbiAgICAgIGJ1Zi5jb3B5KGJ1ZmZlciwgcG9zKTtcbiAgICAgIHBvcyArPSBidWYubGVuZ3RoO1xuICAgIH1cblxuICAgIHJldHVybiBidWZmZXI7XG4gIH1cblxuICAvKipcbiAgICogQWxsb2NhdGVzIGEgbmV3IEJ1ZmZlciB1c2luZyBhbiBhcnJheSBvZiBieXRlcyBpbiB0aGUgcmFuZ2UgMCDigJMgMjU1LiBBcnJheVxuICAgKiBlbnRyaWVzIG91dHNpZGUgdGhhdCByYW5nZSB3aWxsIGJlIHRydW5jYXRlZCB0byBmaXQgaW50byBpdC5cbiAgICovXG4gIHN0YXRpYyBmcm9tKGFycmF5OiBudW1iZXJbXSk6IEJ1ZmZlcjtcbiAgLyoqXG4gICAqIFRoaXMgY3JlYXRlcyBhIHZpZXcgb2YgdGhlIEFycmF5QnVmZmVyIHdpdGhvdXQgY29weWluZyB0aGUgdW5kZXJseWluZ1xuICAgKiBtZW1vcnkuIEZvciBleGFtcGxlLCB3aGVuIHBhc3NlZCBhIHJlZmVyZW5jZSB0byB0aGUgLmJ1ZmZlciBwcm9wZXJ0eSBvZiBhXG4gICAqIFR5cGVkQXJyYXkgaW5zdGFuY2UsIHRoZSBuZXdseSBjcmVhdGVkIEJ1ZmZlciB3aWxsIHNoYXJlIHRoZSBzYW1lIGFsbG9jYXRlZFxuICAgKiBtZW1vcnkgYXMgdGhlIFR5cGVkQXJyYXkuXG4gICAqL1xuICBzdGF0aWMgZnJvbShcbiAgICBhcnJheUJ1ZmZlcjogQXJyYXlCdWZmZXIgfCBTaGFyZWRBcnJheUJ1ZmZlcixcbiAgICBieXRlT2Zmc2V0PzogbnVtYmVyLFxuICAgIGxlbmd0aD86IG51bWJlcixcbiAgKTogQnVmZmVyO1xuICAvKipcbiAgICogQ29waWVzIHRoZSBwYXNzZWQgYnVmZmVyIGRhdGEgb250byBhIG5ldyBCdWZmZXIgaW5zdGFuY2UuXG4gICAqL1xuICBzdGF0aWMgZnJvbShidWZmZXI6IEJ1ZmZlciB8IFVpbnQ4QXJyYXkpOiBCdWZmZXI7XG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgbmV3IEJ1ZmZlciBjb250YWluaW5nIHN0cmluZy5cbiAgICovXG4gIHN0YXRpYyBmcm9tKHN0cmluZzogc3RyaW5nLCBlbmNvZGluZz86IHN0cmluZyk6IEJ1ZmZlcjtcbiAgc3RhdGljIGZyb20oXG4gICAgLy8gZGVuby1saW50LWlnbm9yZSBuby1leHBsaWNpdC1hbnlcbiAgICB2YWx1ZTogYW55LFxuICAgIG9mZnNldE9yRW5jb2Rpbmc/OiBudW1iZXIgfCBzdHJpbmcsXG4gICAgbGVuZ3RoPzogbnVtYmVyLFxuICApOiBCdWZmZXIge1xuICAgIGNvbnN0IG9mZnNldCA9IHR5cGVvZiBvZmZzZXRPckVuY29kaW5nID09PSBcInN0cmluZ1wiXG4gICAgICA/IHVuZGVmaW5lZFxuICAgICAgOiBvZmZzZXRPckVuY29kaW5nO1xuICAgIGxldCBlbmNvZGluZyA9IHR5cGVvZiBvZmZzZXRPckVuY29kaW5nID09PSBcInN0cmluZ1wiXG4gICAgICA/IG9mZnNldE9yRW5jb2RpbmdcbiAgICAgIDogdW5kZWZpbmVkO1xuXG4gICAgaWYgKHR5cGVvZiB2YWx1ZSA9PSBcInN0cmluZ1wiKSB7XG4gICAgICBlbmNvZGluZyA9IGNoZWNrRW5jb2RpbmcoZW5jb2RpbmcsIGZhbHNlKTtcbiAgICAgIGlmIChlbmNvZGluZyA9PT0gXCJoZXhcIikgcmV0dXJuIG5ldyBCdWZmZXIoaGV4LmRlY29kZVN0cmluZyh2YWx1ZSkuYnVmZmVyKTtcbiAgICAgIGlmIChlbmNvZGluZyA9PT0gXCJiYXNlNjRcIikgcmV0dXJuIG5ldyBCdWZmZXIoYmFzZTY0LmRlY29kZSh2YWx1ZSkuYnVmZmVyKTtcbiAgICAgIHJldHVybiBuZXcgQnVmZmVyKG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZSh2YWx1ZSkuYnVmZmVyKTtcbiAgICB9XG5cbiAgICAvLyB3b3JrYXJvdW5kIGZvciBodHRwczovL2dpdGh1Yi5jb20vbWljcm9zb2Z0L1R5cGVTY3JpcHQvaXNzdWVzLzM4NDQ2XG4gICAgcmV0dXJuIG5ldyBCdWZmZXIodmFsdWUsIG9mZnNldCEsIGxlbmd0aCk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0cnVlIGlmIG9iaiBpcyBhIEJ1ZmZlciwgZmFsc2Ugb3RoZXJ3aXNlLlxuICAgKi9cbiAgc3RhdGljIGlzQnVmZmVyKG9iajogdW5rbm93bik6IG9iaiBpcyBCdWZmZXIge1xuICAgIHJldHVybiBvYmogaW5zdGFuY2VvZiBCdWZmZXI7XG4gIH1cblxuICAvLyBkZW5vLWxpbnQtaWdub3JlIG5vLWV4cGxpY2l0LWFueVxuICBzdGF0aWMgaXNFbmNvZGluZyhlbmNvZGluZzogYW55KTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIChcbiAgICAgIHR5cGVvZiBlbmNvZGluZyA9PT0gXCJzdHJpbmdcIiAmJlxuICAgICAgZW5jb2RpbmcubGVuZ3RoICE9PSAwICYmXG4gICAgICBub3JtYWxpemVFbmNvZGluZyhlbmNvZGluZykgIT09IHVuZGVmaW5lZFxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogQ29waWVzIGRhdGEgZnJvbSBhIHJlZ2lvbiBvZiBidWYgdG8gYSByZWdpb24gaW4gdGFyZ2V0LCBldmVuIGlmIHRoZSB0YXJnZXRcbiAgICogbWVtb3J5IHJlZ2lvbiBvdmVybGFwcyB3aXRoIGJ1Zi5cbiAgICovXG4gIGNvcHkoXG4gICAgdGFyZ2V0QnVmZmVyOiBCdWZmZXIgfCBVaW50OEFycmF5LFxuICAgIHRhcmdldFN0YXJ0ID0gMCxcbiAgICBzb3VyY2VTdGFydCA9IDAsXG4gICAgc291cmNlRW5kID0gdGhpcy5sZW5ndGgsXG4gICk6IG51bWJlciB7XG4gICAgY29uc3Qgc291cmNlQnVmZmVyID0gdGhpc1xuICAgICAgLnN1YmFycmF5KHNvdXJjZVN0YXJ0LCBzb3VyY2VFbmQpXG4gICAgICAuc3ViYXJyYXkoMCwgTWF0aC5tYXgoMCwgdGFyZ2V0QnVmZmVyLmxlbmd0aCAtIHRhcmdldFN0YXJ0KSk7XG5cbiAgICBpZiAoc291cmNlQnVmZmVyLmxlbmd0aCA9PT0gMCkgcmV0dXJuIDA7XG5cbiAgICB0YXJnZXRCdWZmZXIuc2V0KHNvdXJjZUJ1ZmZlciwgdGFyZ2V0U3RhcnQpO1xuICAgIHJldHVybiBzb3VyY2VCdWZmZXIubGVuZ3RoO1xuICB9XG5cbiAgLypcbiAgICogUmV0dXJucyB0cnVlIGlmIGJvdGggYnVmIGFuZCBvdGhlckJ1ZmZlciBoYXZlIGV4YWN0bHkgdGhlIHNhbWUgYnl0ZXMsIGZhbHNlIG90aGVyd2lzZS5cbiAgICovXG4gIGVxdWFscyhvdGhlckJ1ZmZlcjogVWludDhBcnJheSB8IEJ1ZmZlcik6IGJvb2xlYW4ge1xuICAgIGlmICghKG90aGVyQnVmZmVyIGluc3RhbmNlb2YgVWludDhBcnJheSkpIHtcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXG4gICAgICAgIGBUaGUgXCJvdGhlckJ1ZmZlclwiIGFyZ3VtZW50IG11c3QgYmUgYW4gaW5zdGFuY2Ugb2YgQnVmZmVyIG9yIFVpbnQ4QXJyYXkuIFJlY2VpdmVkIHR5cGUgJHt0eXBlb2Ygb3RoZXJCdWZmZXJ9YCxcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMgPT09IG90aGVyQnVmZmVyKSByZXR1cm4gdHJ1ZTtcbiAgICBpZiAodGhpcy5ieXRlTGVuZ3RoICE9PSBvdGhlckJ1ZmZlci5ieXRlTGVuZ3RoKSByZXR1cm4gZmFsc2U7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmICh0aGlzW2ldICE9PSBvdGhlckJ1ZmZlcltpXSkgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgcmVhZEJpZ0ludDY0QkUob2Zmc2V0ID0gMCk6IGJpZ2ludCB7XG4gICAgcmV0dXJuIG5ldyBEYXRhVmlldyhcbiAgICAgIHRoaXMuYnVmZmVyLFxuICAgICAgdGhpcy5ieXRlT2Zmc2V0LFxuICAgICAgdGhpcy5ieXRlTGVuZ3RoLFxuICAgICkuZ2V0QmlnSW50NjQob2Zmc2V0KTtcbiAgfVxuICByZWFkQmlnSW50NjRMRShvZmZzZXQgPSAwKTogYmlnaW50IHtcbiAgICByZXR1cm4gbmV3IERhdGFWaWV3KFxuICAgICAgdGhpcy5idWZmZXIsXG4gICAgICB0aGlzLmJ5dGVPZmZzZXQsXG4gICAgICB0aGlzLmJ5dGVMZW5ndGgsXG4gICAgKS5nZXRCaWdJbnQ2NChvZmZzZXQsIHRydWUpO1xuICB9XG5cbiAgcmVhZEJpZ1VJbnQ2NEJFKG9mZnNldCA9IDApOiBiaWdpbnQge1xuICAgIHJldHVybiBuZXcgRGF0YVZpZXcoXG4gICAgICB0aGlzLmJ1ZmZlcixcbiAgICAgIHRoaXMuYnl0ZU9mZnNldCxcbiAgICAgIHRoaXMuYnl0ZUxlbmd0aCxcbiAgICApLmdldEJpZ1VpbnQ2NChvZmZzZXQpO1xuICB9XG4gIHJlYWRCaWdVSW50NjRMRShvZmZzZXQgPSAwKTogYmlnaW50IHtcbiAgICByZXR1cm4gbmV3IERhdGFWaWV3KFxuICAgICAgdGhpcy5idWZmZXIsXG4gICAgICB0aGlzLmJ5dGVPZmZzZXQsXG4gICAgICB0aGlzLmJ5dGVMZW5ndGgsXG4gICAgKS5nZXRCaWdVaW50NjQob2Zmc2V0LCB0cnVlKTtcbiAgfVxuXG4gIHJlYWREb3VibGVCRShvZmZzZXQgPSAwKTogbnVtYmVyIHtcbiAgICByZXR1cm4gbmV3IERhdGFWaWV3KFxuICAgICAgdGhpcy5idWZmZXIsXG4gICAgICB0aGlzLmJ5dGVPZmZzZXQsXG4gICAgICB0aGlzLmJ5dGVMZW5ndGgsXG4gICAgKS5nZXRGbG9hdDY0KG9mZnNldCk7XG4gIH1cbiAgcmVhZERvdWJsZUxFKG9mZnNldCA9IDApOiBudW1iZXIge1xuICAgIHJldHVybiBuZXcgRGF0YVZpZXcoXG4gICAgICB0aGlzLmJ1ZmZlcixcbiAgICAgIHRoaXMuYnl0ZU9mZnNldCxcbiAgICAgIHRoaXMuYnl0ZUxlbmd0aCxcbiAgICApLmdldEZsb2F0NjQob2Zmc2V0LCB0cnVlKTtcbiAgfVxuXG4gIHJlYWRGbG9hdEJFKG9mZnNldCA9IDApOiBudW1iZXIge1xuICAgIHJldHVybiBuZXcgRGF0YVZpZXcoXG4gICAgICB0aGlzLmJ1ZmZlcixcbiAgICAgIHRoaXMuYnl0ZU9mZnNldCxcbiAgICAgIHRoaXMuYnl0ZUxlbmd0aCxcbiAgICApLmdldEZsb2F0MzIob2Zmc2V0KTtcbiAgfVxuICByZWFkRmxvYXRMRShvZmZzZXQgPSAwKTogbnVtYmVyIHtcbiAgICByZXR1cm4gbmV3IERhdGFWaWV3KFxuICAgICAgdGhpcy5idWZmZXIsXG4gICAgICB0aGlzLmJ5dGVPZmZzZXQsXG4gICAgICB0aGlzLmJ5dGVMZW5ndGgsXG4gICAgKS5nZXRGbG9hdDMyKG9mZnNldCwgdHJ1ZSk7XG4gIH1cblxuICByZWFkSW50OChvZmZzZXQgPSAwKTogbnVtYmVyIHtcbiAgICByZXR1cm4gbmV3IERhdGFWaWV3KHRoaXMuYnVmZmVyLCB0aGlzLmJ5dGVPZmZzZXQsIHRoaXMuYnl0ZUxlbmd0aCkuZ2V0SW50OChcbiAgICAgIG9mZnNldCxcbiAgICApO1xuICB9XG5cbiAgcmVhZEludDE2QkUob2Zmc2V0ID0gMCk6IG51bWJlciB7XG4gICAgcmV0dXJuIG5ldyBEYXRhVmlldyh0aGlzLmJ1ZmZlciwgdGhpcy5ieXRlT2Zmc2V0LCB0aGlzLmJ5dGVMZW5ndGgpLmdldEludDE2KFxuICAgICAgb2Zmc2V0LFxuICAgICk7XG4gIH1cbiAgcmVhZEludDE2TEUob2Zmc2V0ID0gMCk6IG51bWJlciB7XG4gICAgcmV0dXJuIG5ldyBEYXRhVmlldyh0aGlzLmJ1ZmZlciwgdGhpcy5ieXRlT2Zmc2V0LCB0aGlzLmJ5dGVMZW5ndGgpLmdldEludDE2KFxuICAgICAgb2Zmc2V0LFxuICAgICAgdHJ1ZSxcbiAgICApO1xuICB9XG5cbiAgcmVhZEludDMyQkUob2Zmc2V0ID0gMCk6IG51bWJlciB7XG4gICAgcmV0dXJuIG5ldyBEYXRhVmlldyh0aGlzLmJ1ZmZlciwgdGhpcy5ieXRlT2Zmc2V0LCB0aGlzLmJ5dGVMZW5ndGgpLmdldEludDMyKFxuICAgICAgb2Zmc2V0LFxuICAgICk7XG4gIH1cbiAgcmVhZEludDMyTEUob2Zmc2V0ID0gMCk6IG51bWJlciB7XG4gICAgcmV0dXJuIG5ldyBEYXRhVmlldyh0aGlzLmJ1ZmZlciwgdGhpcy5ieXRlT2Zmc2V0LCB0aGlzLmJ5dGVMZW5ndGgpLmdldEludDMyKFxuICAgICAgb2Zmc2V0LFxuICAgICAgdHJ1ZSxcbiAgICApO1xuICB9XG5cbiAgcmVhZFVJbnQ4KG9mZnNldCA9IDApOiBudW1iZXIge1xuICAgIHJldHVybiBuZXcgRGF0YVZpZXcodGhpcy5idWZmZXIsIHRoaXMuYnl0ZU9mZnNldCwgdGhpcy5ieXRlTGVuZ3RoKS5nZXRVaW50OChcbiAgICAgIG9mZnNldCxcbiAgICApO1xuICB9XG5cbiAgcmVhZFVJbnQxNkJFKG9mZnNldCA9IDApOiBudW1iZXIge1xuICAgIHJldHVybiBuZXcgRGF0YVZpZXcoXG4gICAgICB0aGlzLmJ1ZmZlcixcbiAgICAgIHRoaXMuYnl0ZU9mZnNldCxcbiAgICAgIHRoaXMuYnl0ZUxlbmd0aCxcbiAgICApLmdldFVpbnQxNihvZmZzZXQpO1xuICB9XG4gIHJlYWRVSW50MTZMRShvZmZzZXQgPSAwKTogbnVtYmVyIHtcbiAgICByZXR1cm4gbmV3IERhdGFWaWV3KFxuICAgICAgdGhpcy5idWZmZXIsXG4gICAgICB0aGlzLmJ5dGVPZmZzZXQsXG4gICAgICB0aGlzLmJ5dGVMZW5ndGgsXG4gICAgKS5nZXRVaW50MTYob2Zmc2V0LCB0cnVlKTtcbiAgfVxuXG4gIHJlYWRVSW50MzJCRShvZmZzZXQgPSAwKTogbnVtYmVyIHtcbiAgICByZXR1cm4gbmV3IERhdGFWaWV3KFxuICAgICAgdGhpcy5idWZmZXIsXG4gICAgICB0aGlzLmJ5dGVPZmZzZXQsXG4gICAgICB0aGlzLmJ5dGVMZW5ndGgsXG4gICAgKS5nZXRVaW50MzIob2Zmc2V0KTtcbiAgfVxuICByZWFkVUludDMyTEUob2Zmc2V0ID0gMCk6IG51bWJlciB7XG4gICAgcmV0dXJuIG5ldyBEYXRhVmlldyhcbiAgICAgIHRoaXMuYnVmZmVyLFxuICAgICAgdGhpcy5ieXRlT2Zmc2V0LFxuICAgICAgdGhpcy5ieXRlTGVuZ3RoLFxuICAgICkuZ2V0VWludDMyKG9mZnNldCwgdHJ1ZSk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBhIG5ldyBCdWZmZXIgdGhhdCByZWZlcmVuY2VzIHRoZSBzYW1lIG1lbW9yeSBhcyB0aGUgb3JpZ2luYWwsIGJ1dFxuICAgKiBvZmZzZXQgYW5kIGNyb3BwZWQgYnkgdGhlIHN0YXJ0IGFuZCBlbmQgaW5kaWNlcy5cbiAgICovXG4gIHNsaWNlKGJlZ2luID0gMCwgZW5kID0gdGhpcy5sZW5ndGgpOiBCdWZmZXIge1xuICAgIC8vIHdvcmthcm91bmQgZm9yIGh0dHBzOi8vZ2l0aHViLmNvbS9taWNyb3NvZnQvVHlwZVNjcmlwdC9pc3N1ZXMvMzg2NjVcbiAgICByZXR1cm4gdGhpcy5zdWJhcnJheShiZWdpbiwgZW5kKSBhcyBCdWZmZXI7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBhIEpTT04gcmVwcmVzZW50YXRpb24gb2YgYnVmLiBKU09OLnN0cmluZ2lmeSgpIGltcGxpY2l0bHkgY2FsbHNcbiAgICogdGhpcyBmdW5jdGlvbiB3aGVuIHN0cmluZ2lmeWluZyBhIEJ1ZmZlciBpbnN0YW5jZS5cbiAgICovXG4gIHRvSlNPTigpOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiB7XG4gICAgcmV0dXJuIHsgdHlwZTogXCJCdWZmZXJcIiwgZGF0YTogQXJyYXkuZnJvbSh0aGlzKSB9O1xuICB9XG5cbiAgLyoqXG4gICAqIERlY29kZXMgYnVmIHRvIGEgc3RyaW5nIGFjY29yZGluZyB0byB0aGUgc3BlY2lmaWVkIGNoYXJhY3RlciBlbmNvZGluZyBpblxuICAgKiBlbmNvZGluZy4gc3RhcnQgYW5kIGVuZCBtYXkgYmUgcGFzc2VkIHRvIGRlY29kZSBvbmx5IGEgc3Vic2V0IG9mIGJ1Zi5cbiAgICovXG4gIHRvU3RyaW5nKGVuY29kaW5nID0gXCJ1dGY4XCIsIHN0YXJ0ID0gMCwgZW5kID0gdGhpcy5sZW5ndGgpOiBzdHJpbmcge1xuICAgIGVuY29kaW5nID0gY2hlY2tFbmNvZGluZyhlbmNvZGluZyk7XG5cbiAgICBjb25zdCBiID0gdGhpcy5zdWJhcnJheShzdGFydCwgZW5kKTtcbiAgICBpZiAoZW5jb2RpbmcgPT09IFwiaGV4XCIpIHJldHVybiBoZXguZW5jb2RlVG9TdHJpbmcoYik7XG4gICAgaWYgKGVuY29kaW5nID09PSBcImJhc2U2NFwiKSByZXR1cm4gYmFzZTY0LmVuY29kZShiLmJ1ZmZlcik7XG5cbiAgICByZXR1cm4gbmV3IFRleHREZWNvZGVyKGVuY29kaW5nKS5kZWNvZGUoYik7XG4gIH1cblxuICAvKipcbiAgICogV3JpdGVzIHN0cmluZyB0byBidWYgYXQgb2Zmc2V0IGFjY29yZGluZyB0byB0aGUgY2hhcmFjdGVyIGVuY29kaW5nIGluXG4gICAqIGVuY29kaW5nLiBUaGUgbGVuZ3RoIHBhcmFtZXRlciBpcyB0aGUgbnVtYmVyIG9mIGJ5dGVzIHRvIHdyaXRlLiBJZiBidWYgZGlkXG4gICAqIG5vdCBjb250YWluIGVub3VnaCBzcGFjZSB0byBmaXQgdGhlIGVudGlyZSBzdHJpbmcsIG9ubHkgcGFydCBvZiBzdHJpbmcgd2lsbFxuICAgKiBiZSB3cml0dGVuLiBIb3dldmVyLCBwYXJ0aWFsbHkgZW5jb2RlZCBjaGFyYWN0ZXJzIHdpbGwgbm90IGJlIHdyaXR0ZW4uXG4gICAqL1xuICB3cml0ZShzdHJpbmc6IHN0cmluZywgb2Zmc2V0ID0gMCwgbGVuZ3RoID0gdGhpcy5sZW5ndGgpOiBudW1iZXIge1xuICAgIHJldHVybiBuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGVJbnRvKFxuICAgICAgc3RyaW5nLFxuICAgICAgdGhpcy5zdWJhcnJheShvZmZzZXQsIG9mZnNldCArIGxlbmd0aCksXG4gICAgKS53cml0dGVuO1xuICB9XG5cbiAgd3JpdGVCaWdJbnQ2NEJFKHZhbHVlOiBiaWdpbnQsIG9mZnNldCA9IDApOiBudW1iZXIge1xuICAgIG5ldyBEYXRhVmlldyh0aGlzLmJ1ZmZlciwgdGhpcy5ieXRlT2Zmc2V0LCB0aGlzLmJ5dGVMZW5ndGgpLnNldEJpZ0ludDY0KFxuICAgICAgb2Zmc2V0LFxuICAgICAgdmFsdWUsXG4gICAgKTtcbiAgICByZXR1cm4gb2Zmc2V0ICsgNDtcbiAgfVxuICB3cml0ZUJpZ0ludDY0TEUodmFsdWU6IGJpZ2ludCwgb2Zmc2V0ID0gMCk6IG51bWJlciB7XG4gICAgbmV3IERhdGFWaWV3KHRoaXMuYnVmZmVyLCB0aGlzLmJ5dGVPZmZzZXQsIHRoaXMuYnl0ZUxlbmd0aCkuc2V0QmlnSW50NjQoXG4gICAgICBvZmZzZXQsXG4gICAgICB2YWx1ZSxcbiAgICAgIHRydWUsXG4gICAgKTtcbiAgICByZXR1cm4gb2Zmc2V0ICsgNDtcbiAgfVxuXG4gIHdyaXRlQmlnVUludDY0QkUodmFsdWU6IGJpZ2ludCwgb2Zmc2V0ID0gMCk6IG51bWJlciB7XG4gICAgbmV3IERhdGFWaWV3KHRoaXMuYnVmZmVyLCB0aGlzLmJ5dGVPZmZzZXQsIHRoaXMuYnl0ZUxlbmd0aCkuc2V0QmlnVWludDY0KFxuICAgICAgb2Zmc2V0LFxuICAgICAgdmFsdWUsXG4gICAgKTtcbiAgICByZXR1cm4gb2Zmc2V0ICsgNDtcbiAgfVxuICB3cml0ZUJpZ1VJbnQ2NExFKHZhbHVlOiBiaWdpbnQsIG9mZnNldCA9IDApOiBudW1iZXIge1xuICAgIG5ldyBEYXRhVmlldyh0aGlzLmJ1ZmZlciwgdGhpcy5ieXRlT2Zmc2V0LCB0aGlzLmJ5dGVMZW5ndGgpLnNldEJpZ1VpbnQ2NChcbiAgICAgIG9mZnNldCxcbiAgICAgIHZhbHVlLFxuICAgICAgdHJ1ZSxcbiAgICApO1xuICAgIHJldHVybiBvZmZzZXQgKyA0O1xuICB9XG5cbiAgd3JpdGVEb3VibGVCRSh2YWx1ZTogbnVtYmVyLCBvZmZzZXQgPSAwKTogbnVtYmVyIHtcbiAgICBuZXcgRGF0YVZpZXcodGhpcy5idWZmZXIsIHRoaXMuYnl0ZU9mZnNldCwgdGhpcy5ieXRlTGVuZ3RoKS5zZXRGbG9hdDY0KFxuICAgICAgb2Zmc2V0LFxuICAgICAgdmFsdWUsXG4gICAgKTtcbiAgICByZXR1cm4gb2Zmc2V0ICsgODtcbiAgfVxuICB3cml0ZURvdWJsZUxFKHZhbHVlOiBudW1iZXIsIG9mZnNldCA9IDApOiBudW1iZXIge1xuICAgIG5ldyBEYXRhVmlldyh0aGlzLmJ1ZmZlciwgdGhpcy5ieXRlT2Zmc2V0LCB0aGlzLmJ5dGVMZW5ndGgpLnNldEZsb2F0NjQoXG4gICAgICBvZmZzZXQsXG4gICAgICB2YWx1ZSxcbiAgICAgIHRydWUsXG4gICAgKTtcbiAgICByZXR1cm4gb2Zmc2V0ICsgODtcbiAgfVxuXG4gIHdyaXRlRmxvYXRCRSh2YWx1ZTogbnVtYmVyLCBvZmZzZXQgPSAwKTogbnVtYmVyIHtcbiAgICBuZXcgRGF0YVZpZXcodGhpcy5idWZmZXIsIHRoaXMuYnl0ZU9mZnNldCwgdGhpcy5ieXRlTGVuZ3RoKS5zZXRGbG9hdDMyKFxuICAgICAgb2Zmc2V0LFxuICAgICAgdmFsdWUsXG4gICAgKTtcbiAgICByZXR1cm4gb2Zmc2V0ICsgNDtcbiAgfVxuICB3cml0ZUZsb2F0TEUodmFsdWU6IG51bWJlciwgb2Zmc2V0ID0gMCk6IG51bWJlciB7XG4gICAgbmV3IERhdGFWaWV3KHRoaXMuYnVmZmVyLCB0aGlzLmJ5dGVPZmZzZXQsIHRoaXMuYnl0ZUxlbmd0aCkuc2V0RmxvYXQzMihcbiAgICAgIG9mZnNldCxcbiAgICAgIHZhbHVlLFxuICAgICAgdHJ1ZSxcbiAgICApO1xuICAgIHJldHVybiBvZmZzZXQgKyA0O1xuICB9XG5cbiAgd3JpdGVJbnQ4KHZhbHVlOiBudW1iZXIsIG9mZnNldCA9IDApOiBudW1iZXIge1xuICAgIG5ldyBEYXRhVmlldyh0aGlzLmJ1ZmZlciwgdGhpcy5ieXRlT2Zmc2V0LCB0aGlzLmJ5dGVMZW5ndGgpLnNldEludDgoXG4gICAgICBvZmZzZXQsXG4gICAgICB2YWx1ZSxcbiAgICApO1xuICAgIHJldHVybiBvZmZzZXQgKyAxO1xuICB9XG5cbiAgd3JpdGVJbnQxNkJFKHZhbHVlOiBudW1iZXIsIG9mZnNldCA9IDApOiBudW1iZXIge1xuICAgIG5ldyBEYXRhVmlldyh0aGlzLmJ1ZmZlciwgdGhpcy5ieXRlT2Zmc2V0LCB0aGlzLmJ5dGVMZW5ndGgpLnNldEludDE2KFxuICAgICAgb2Zmc2V0LFxuICAgICAgdmFsdWUsXG4gICAgKTtcbiAgICByZXR1cm4gb2Zmc2V0ICsgMjtcbiAgfVxuICB3cml0ZUludDE2TEUodmFsdWU6IG51bWJlciwgb2Zmc2V0ID0gMCk6IG51bWJlciB7XG4gICAgbmV3IERhdGFWaWV3KHRoaXMuYnVmZmVyLCB0aGlzLmJ5dGVPZmZzZXQsIHRoaXMuYnl0ZUxlbmd0aCkuc2V0SW50MTYoXG4gICAgICBvZmZzZXQsXG4gICAgICB2YWx1ZSxcbiAgICAgIHRydWUsXG4gICAgKTtcbiAgICByZXR1cm4gb2Zmc2V0ICsgMjtcbiAgfVxuXG4gIHdyaXRlSW50MzJCRSh2YWx1ZTogbnVtYmVyLCBvZmZzZXQgPSAwKTogbnVtYmVyIHtcbiAgICBuZXcgRGF0YVZpZXcodGhpcy5idWZmZXIsIHRoaXMuYnl0ZU9mZnNldCwgdGhpcy5ieXRlTGVuZ3RoKS5zZXRVaW50MzIoXG4gICAgICBvZmZzZXQsXG4gICAgICB2YWx1ZSxcbiAgICApO1xuICAgIHJldHVybiBvZmZzZXQgKyA0O1xuICB9XG4gIHdyaXRlSW50MzJMRSh2YWx1ZTogbnVtYmVyLCBvZmZzZXQgPSAwKTogbnVtYmVyIHtcbiAgICBuZXcgRGF0YVZpZXcodGhpcy5idWZmZXIsIHRoaXMuYnl0ZU9mZnNldCwgdGhpcy5ieXRlTGVuZ3RoKS5zZXRJbnQzMihcbiAgICAgIG9mZnNldCxcbiAgICAgIHZhbHVlLFxuICAgICAgdHJ1ZSxcbiAgICApO1xuICAgIHJldHVybiBvZmZzZXQgKyA0O1xuICB9XG5cbiAgd3JpdGVVSW50OCh2YWx1ZTogbnVtYmVyLCBvZmZzZXQgPSAwKTogbnVtYmVyIHtcbiAgICBuZXcgRGF0YVZpZXcodGhpcy5idWZmZXIsIHRoaXMuYnl0ZU9mZnNldCwgdGhpcy5ieXRlTGVuZ3RoKS5zZXRVaW50OChcbiAgICAgIG9mZnNldCxcbiAgICAgIHZhbHVlLFxuICAgICk7XG4gICAgcmV0dXJuIG9mZnNldCArIDE7XG4gIH1cblxuICB3cml0ZVVJbnQxNkJFKHZhbHVlOiBudW1iZXIsIG9mZnNldCA9IDApOiBudW1iZXIge1xuICAgIG5ldyBEYXRhVmlldyh0aGlzLmJ1ZmZlciwgdGhpcy5ieXRlT2Zmc2V0LCB0aGlzLmJ5dGVMZW5ndGgpLnNldFVpbnQxNihcbiAgICAgIG9mZnNldCxcbiAgICAgIHZhbHVlLFxuICAgICk7XG4gICAgcmV0dXJuIG9mZnNldCArIDI7XG4gIH1cbiAgd3JpdGVVSW50MTZMRSh2YWx1ZTogbnVtYmVyLCBvZmZzZXQgPSAwKTogbnVtYmVyIHtcbiAgICBuZXcgRGF0YVZpZXcodGhpcy5idWZmZXIsIHRoaXMuYnl0ZU9mZnNldCwgdGhpcy5ieXRlTGVuZ3RoKS5zZXRVaW50MTYoXG4gICAgICBvZmZzZXQsXG4gICAgICB2YWx1ZSxcbiAgICAgIHRydWUsXG4gICAgKTtcbiAgICByZXR1cm4gb2Zmc2V0ICsgMjtcbiAgfVxuXG4gIHdyaXRlVUludDMyQkUodmFsdWU6IG51bWJlciwgb2Zmc2V0ID0gMCk6IG51bWJlciB7XG4gICAgbmV3IERhdGFWaWV3KHRoaXMuYnVmZmVyLCB0aGlzLmJ5dGVPZmZzZXQsIHRoaXMuYnl0ZUxlbmd0aCkuc2V0VWludDMyKFxuICAgICAgb2Zmc2V0LFxuICAgICAgdmFsdWUsXG4gICAgKTtcbiAgICByZXR1cm4gb2Zmc2V0ICsgNDtcbiAgfVxuICB3cml0ZVVJbnQzMkxFKHZhbHVlOiBudW1iZXIsIG9mZnNldCA9IDApOiBudW1iZXIge1xuICAgIG5ldyBEYXRhVmlldyh0aGlzLmJ1ZmZlciwgdGhpcy5ieXRlT2Zmc2V0LCB0aGlzLmJ5dGVMZW5ndGgpLnNldFVpbnQzMihcbiAgICAgIG9mZnNldCxcbiAgICAgIHZhbHVlLFxuICAgICAgdHJ1ZSxcbiAgICApO1xuICAgIHJldHVybiBvZmZzZXQgKyA0O1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IHsgQnVmZmVyIH07XG4iXX0=