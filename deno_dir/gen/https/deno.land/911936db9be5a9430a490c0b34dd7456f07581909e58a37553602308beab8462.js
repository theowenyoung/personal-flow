import { promisify } from "./_util/_util_promisify.ts";
import { callbackify } from "./_util/_util_callbackify.ts";
import { ERR_INVALID_ARG_TYPE, ERR_OUT_OF_RANGE, errorMap } from "./_errors.ts";
import * as types from "./_util/_util_types.ts";
export { callbackify, promisify, types };
const NumberIsSafeInteger = Number.isSafeInteger;
const DEFAULT_INSPECT_OPTIONS = {
    showHidden: false,
    depth: 2,
    colors: false,
    customInspect: true,
    showProxy: false,
    maxArrayLength: 100,
    maxStringLength: Infinity,
    breakLength: 80,
    compact: 3,
    sorted: false,
    getters: false,
};
inspect.defaultOptions = DEFAULT_INSPECT_OPTIONS;
inspect.custom = Symbol.for("nodejs.util.inspect.custom");
export function inspect(object, ...opts) {
    if (typeof object === "string" && !object.includes("'")) {
        return `'${object}'`;
    }
    opts = { ...DEFAULT_INSPECT_OPTIONS, ...opts };
    return Deno.inspect(object, {
        depth: opts.depth,
        iterableLimit: opts.maxArrayLength,
        compact: !!opts.compact,
        sorted: !!opts.sorted,
        showProxy: !!opts.showProxy,
    });
}
export function isArray(value) {
    return Array.isArray(value);
}
export function isBoolean(value) {
    return typeof value === "boolean" || value instanceof Boolean;
}
export function isNull(value) {
    return value === null;
}
export function isNullOrUndefined(value) {
    return value === null || value === undefined;
}
export function isNumber(value) {
    return typeof value === "number" || value instanceof Number;
}
export function isString(value) {
    return typeof value === "string" || value instanceof String;
}
export function isSymbol(value) {
    return typeof value === "symbol";
}
export function isUndefined(value) {
    return value === undefined;
}
export function isObject(value) {
    return value !== null && typeof value === "object";
}
export function isError(e) {
    return e instanceof Error;
}
export function isFunction(value) {
    return typeof value === "function";
}
export function isRegExp(value) {
    return value instanceof RegExp;
}
export function isPrimitive(value) {
    return (value === null || (typeof value !== "object" && typeof value !== "function"));
}
export function getSystemErrorName(code) {
    if (typeof code !== "number") {
        throw new ERR_INVALID_ARG_TYPE("err", "number", code);
    }
    if (code >= 0 || !NumberIsSafeInteger(code)) {
        throw new ERR_OUT_OF_RANGE("err", "a negative integer", code);
    }
    return errorMap.get(code)?.[0];
}
export function deprecate(fn, msg, _code) {
    return function (...args) {
        console.warn(msg);
        return fn.apply(undefined, args);
    };
}
function toReplace(specifier, value) {
    if (specifier === "%s") {
        if (typeof value === "string" || value instanceof String) {
            return value;
        }
        else
            return Deno.inspect(value, { depth: 1 });
    }
    if (specifier === "%d") {
        if (typeof value === "bigint") {
            return value + "n";
        }
        return Number(value).toString();
    }
    if (specifier === "%i") {
        if (typeof value === "bigint") {
            return value + "n";
        }
        return parseInt(value).toString();
    }
    if (specifier === "%f") {
        return parseFloat(value).toString();
    }
    if (specifier === "%j") {
        try {
            return JSON.stringify(value);
        }
        catch (e) {
            if (e instanceof TypeError && e.message.match(/cyclic|circular/)) {
                return "[Circular]";
            }
            else
                throw e;
        }
    }
    if (specifier === "%o") {
        return Deno.inspect(value, { showHidden: true, showProxy: true });
    }
    if (specifier === "%O") {
        return Deno.inspect(value);
    }
    if (specifier === "%c") {
        return "";
    }
    return "";
}
export function format(...args) {
    const replacement = [];
    const formatSpecifierRx = /%(s|d|i|f|j|o|O|c|%)/g;
    const hasFormatTemplate = args.length > 0 &&
        (typeof args[0] === "string" || args[0] instanceof String);
    const formatTemplate = hasFormatTemplate ? args[0] : "";
    let i = hasFormatTemplate ? 1 : 0;
    let arr = null;
    let done = false;
    while ((arr = formatSpecifierRx.exec(formatTemplate)) !== null && !done) {
        if (arr[0] === "%%") {
            replacement.push([arr["index"], "%"]);
        }
        else if (i < args.length) {
            replacement.push([arr["index"], toReplace(arr[0], args[i])]);
            i++;
        }
        else
            done = true;
    }
    const lastArgUsed = i;
    let result = "";
    let last = 0;
    for (let i = 0; i < replacement.length; i++) {
        const item = replacement[i];
        result += formatTemplate.slice(last, item[0]);
        result += item[1];
        last = item[0] + 2;
    }
    result += formatTemplate.slice(last);
    for (let i = lastArgUsed; i < args.length; i++) {
        if (i > 0)
            result += " ";
        if (typeof args[i] === "string") {
            result += args[i];
        }
        else
            result += Deno.inspect(args[i], { colors: true });
    }
    return result;
}
export function inherits(ctor, superCtor) {
    if (ctor === undefined || ctor === null) {
        throw new ERR_INVALID_ARG_TYPE("ctor", "Function", ctor);
    }
    if (superCtor === undefined || superCtor === null) {
        throw new ERR_INVALID_ARG_TYPE("superCtor", "Function", superCtor);
    }
    if (superCtor.prototype === undefined) {
        throw new ERR_INVALID_ARG_TYPE("superCtor.prototype", "Object", superCtor.prototype);
    }
    Object.defineProperty(ctor, "super_", {
        value: superCtor,
        writable: true,
        configurable: true,
    });
    Object.setPrototypeOf(ctor.prototype, superCtor.prototype);
}
import { _TextDecoder, _TextEncoder } from "./_utils.ts";
export const TextDecoder = _TextDecoder;
export const TextEncoder = _TextEncoder;
export default {
    format,
    inspect,
    isArray,
    isBoolean,
    isNull,
    isNullOrUndefined,
    isNumber,
    isString,
    isSymbol,
    isUndefined,
    isObject,
    isError,
    isFunction,
    isRegExp,
    isPrimitive,
    getSystemErrorName,
    deprecate,
    callbackify,
    promisify,
    inherits,
    types,
    TextDecoder,
    TextEncoder,
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInV0aWwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBQ3ZELE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUMzRCxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsZ0JBQWdCLEVBQUUsUUFBUSxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBQ2hGLE9BQU8sS0FBSyxLQUFLLE1BQU0sd0JBQXdCLENBQUM7QUFDaEQsT0FBTyxFQUFFLFdBQVcsRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLENBQUM7QUFFekMsTUFBTSxtQkFBbUIsR0FBRyxNQUFNLENBQUMsYUFBYSxDQUFDO0FBRWpELE1BQU0sdUJBQXVCLEdBQUc7SUFDOUIsVUFBVSxFQUFFLEtBQUs7SUFDakIsS0FBSyxFQUFFLENBQUM7SUFDUixNQUFNLEVBQUUsS0FBSztJQUNiLGFBQWEsRUFBRSxJQUFJO0lBQ25CLFNBQVMsRUFBRSxLQUFLO0lBQ2hCLGNBQWMsRUFBRSxHQUFHO0lBQ25CLGVBQWUsRUFBRSxRQUFRO0lBQ3pCLFdBQVcsRUFBRSxFQUFFO0lBQ2YsT0FBTyxFQUFFLENBQUM7SUFDVixNQUFNLEVBQUUsS0FBSztJQUNiLE9BQU8sRUFBRSxLQUFLO0NBQ2YsQ0FBQztBQUVGLE9BQU8sQ0FBQyxjQUFjLEdBQUcsdUJBQXVCLENBQUM7QUFDakQsT0FBTyxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLDRCQUE0QixDQUFDLENBQUM7QUFLMUQsTUFBTSxVQUFVLE9BQU8sQ0FBQyxNQUFlLEVBQUUsR0FBRyxJQUFTO0lBR25ELElBQUksT0FBTyxNQUFNLEtBQUssUUFBUSxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsRUFBRTtRQUN2RCxPQUFPLElBQUksTUFBTSxHQUFHLENBQUM7S0FDdEI7SUFDRCxJQUFJ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Q2QsWUFBWSxFQUFFLElBQUk7S0FDbkIsQ0FBQyxDQUFDO0lBQ0gsTUFBTSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUM3RCxDQUFDO0FBRUQsT0FBTyxFQUFFLFlBQVksRUFBRSxZQUFZLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFJekQsTUFBTSxDQUFDLE1BQU0sV0FBVyxHQUFHLFlBQVksQ0FBQztBQUl4QyxNQUFNLENBQUMsTUFBTSxXQUFXLEdBQUcsWUFBWSxDQUFDO0FBRXhDLGVBQWU7SUFDYixNQUFNO0lBQ04sT0FBTztJQUNQLE9BQU87SUFDUCxTQUFTO0lBQ1QsTUFBTTtJQUNOLGlCQUFpQjtJQUNqQixRQUFRO0lBQ1IsUUFBUTtJQUNSLFFBQVE7SUFDUixXQUFXO0lBQ1gsUUFBUTtJQUNSLE9BQU87SUFDUCxVQUFVO0lBQ1YsUUFBUTtJQUNSLFdBQVc7SUFDWCxrQkFBa0I7SUFDbEIsU0FBUztJQUNULFdBQVc7SUFDWCxTQUFTO0lBQ1QsUUFBUTtJQUNSLEtBQUs7SUFDTCxXQUFXO0lBQ1gsV0FBVztDQUNaLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxOC0yMDIxIHRoZSBEZW5vIGF1dGhvcnMuIEFsbCByaWdodHMgcmVzZXJ2ZWQuIE1JVCBsaWNlbnNlLlxuaW1wb3J0IHsgcHJvbWlzaWZ5IH0gZnJvbSBcIi4vX3V0aWwvX3V0aWxfcHJvbWlzaWZ5LnRzXCI7XG5pbXBvcnQgeyBjYWxsYmFja2lmeSB9IGZyb20gXCIuL191dGlsL191dGlsX2NhbGxiYWNraWZ5LnRzXCI7XG5pbXBvcnQgeyBFUlJfSU5WQUxJRF9BUkdfVFlQRSwgRVJSX09VVF9PRl9SQU5HRSwgZXJyb3JNYXAgfSBmcm9tIFwiLi9fZXJyb3JzLnRzXCI7XG5pbXBvcnQgKiBhcyB0eXBlcyBmcm9tIFwiLi9fdXRpbC9fdXRpbF90eXBlcy50c1wiO1xuZXhwb3J0IHsgY2FsbGJhY2tpZnksIHByb21pc2lmeSwgdHlwZXMgfTtcblxuY29uc3QgTnVtYmVySXNTYWZlSW50ZWdlciA9IE51bWJlci5pc1NhZmVJbnRlZ2VyO1xuXG5jb25zdCBERUZBVUxUX0lOU1BFQ1RfT1BUSU9OUyA9IHtcbiAgc2hvd0hpZGRlbjogZmFsc2UsXG4gIGRlcHRoOiAyLFxuICBjb2xvcnM6IGZhbHNlLFxuICBjdXN0b21JbnNwZWN0OiB0cnVlLFxuICBzaG93UHJveHk6IGZhbHNlLFxuICBtYXhBcnJheUxlbmd0aDogMTAwLFxuICBtYXhTdHJpbmdMZW5ndGg6IEluZmluaXR5LFxuICBicmVha0xlbmd0aDogODAsXG4gIGNvbXBhY3Q6IDMsXG4gIHNvcnRlZDogZmFsc2UsXG4gIGdldHRlcnM6IGZhbHNlLFxufTtcblxuaW5zcGVjdC5kZWZhdWx0T3B0aW9ucyA9IERFRkFVTFRfSU5TUEVDVF9PUFRJT05TO1xuaW5zcGVjdC5jdXN0b20gPSBTeW1ib2wuZm9yKFwibm9kZWpzLnV0aWwuaW5zcGVjdC5jdXN0b21cIik7XG5cbi8vIFRPRE8oc2Nod2FyemtvcGZiKTogbWFrZSBpdCBpbi1saW5lIHdpdGggTm9kZSdzIGltcGxlbWVudGF0aW9uXG4vLyBSZWY6IGh0dHBzOi8vbm9kZWpzLm9yZy9kaXN0L2xhdGVzdC12MTQueC9kb2NzL2FwaS91dGlsLmh0bWwjdXRpbF91dGlsX2luc3BlY3Rfb2JqZWN0X29wdGlvbnNcbi8vIGRlbm8tbGludC1pZ25vcmUgbm8tZXhwbGljaXQtYW55XG5leHBvcnQgZnVuY3Rpb24gaW5zcGVjdChvYmplY3Q6IHVua25vd24sIC4uLm9wdHM6IGFueSk6IHN0cmluZyB7XG4gIC8vIEluIE5vZGUuanMsIHN0cmluZ3Mgc2hvdWxkIGJlIGVuY2xvc2VkIGluIHNpbmdsZSBxdW90ZXMuXG4gIC8vIFRPRE8odWtpMDBhKTogU3RyaW5ncyBpbiBvYmplY3RzIGFuZCBhcnJheXMgc2hvdWxkIGFsc28gYmUgZW5jbG9zZWQgaW4gc2luZ2xlIHF1b3Rlcy5cbiAgaWYgKHR5cGVvZiBvYmplY3QgPT09IFwic3RyaW5nXCIgJiYgIW9iamVjdC5pbmNsdWRlcyhcIidcIikpIHtcbiAgICByZXR1cm4gYCcke29iamVjdH0nYDtcbiAgfVxuICBvcHRzID0geyAuLi5ERUZBVUxUX0lOU1BFQ1RfT1BUSU9OUywgLi4ub3B0cyB9O1xuICByZXR1cm4gRGVuby5pbnNwZWN0KG9iamVjdCwge1xuICAgIGRlcHRoOiBvcHRzLmRlcHRoLFxuICAgIGl0ZXJhYmxlTGltaXQ6IG9wdHMubWF4QXJyYXlMZW5ndGgsXG4gICAgY29tcGFjdDogISFvcHRzLmNvbXBhY3QsXG4gICAgc29ydGVkOiAhIW9wdHMuc29ydGVkLFxuICAgIHNob3dQcm94eTogISFvcHRzLnNob3dQcm94eSxcbiAgfSk7XG59XG5cbi8qKiBAZGVwcmVjYXRlZCAtIHVzZSBgQXJyYXkuaXNBcnJheSgpYCBpbnN0ZWFkLiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzQXJyYXkodmFsdWU6IHVua25vd24pOiBib29sZWFuIHtcbiAgcmV0dXJuIEFycmF5LmlzQXJyYXkodmFsdWUpO1xufVxuXG4vKiogQGRlcHJlY2F0ZWQgLSB1c2UgYHR5cGVvZiB2YWx1ZSA9PT0gXCJib29sZWFuXCIgfHwgdmFsdWUgaW5zdGFuY2VvZiBCb29sZWFuYCBpbnN0ZWFkLiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzQm9vbGVhbih2YWx1ZTogdW5rbm93bik6IGJvb2xlYW4ge1xuICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSBcImJvb2xlYW5cIiB8fCB2YWx1ZSBpbnN0YW5jZW9mIEJvb2xlYW47XG59XG5cbi8qKiBAZGVwcmVjYXRlZCAtIHVzZSBgdmFsdWUgPT09IG51bGxgIGluc3RlYWQuICovXG5leHBvcnQgZnVuY3Rpb24gaXNOdWxsKHZhbHVlOiB1bmtub3duKTogYm9vbGVhbiB7XG4gIHJldHVybiB2YWx1ZSA9PT0gbnVsbDtcbn1cblxuLyoqIEBkZXByZWNhdGVkIC0gdXNlIGB2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkYCBpbnN0ZWFkLiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzTnVsbE9yVW5kZWZpbmVkKHZhbHVlOiB1bmtub3duKTogYm9vbGVhbiB7XG4gIHJldHVybiB2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkO1xufVxuXG4vKiogQGRlcHJlY2F0ZWQgLSB1c2UgYHR5cGVvZiB2YWx1ZSA9PT0gXCJudW1iZXJcIiB8fCB2YWx1ZSBpbnN0YW5jZW9mIE51bWJlcmAgaW5zdGVhZC4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc051bWJlcih2YWx1ZTogdW5rbm93bik6IGJvb2xlYW4ge1xuICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSBcIm51bWJlclwiIHx8IHZhbHVlIGluc3RhbmNlb2YgTnVtYmVyO1xufVxuXG4vKiogQGRlcHJlY2F0ZWQgLSB1c2UgYHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIiB8fCB2YWx1ZSBpbnN0YW5jZW9mIFN0cmluZ2AgaW5zdGVhZC4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc1N0cmluZyh2YWx1ZTogdW5rbm93bik6IGJvb2xlYW4ge1xuICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSBcInN0cmluZ1wiIHx8IHZhbHVlIGluc3RhbmNlb2YgU3RyaW5nO1xufVxuXG4vKiogQGRlcHJlY2F0ZWQgLSB1c2UgYHR5cGVvZiB2YWx1ZSA9PT0gXCJzeW1ib2xcImAgaW5zdGVhZC4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc1N5bWJvbCh2YWx1ZTogdW5rbm93bik6IGJvb2xlYW4ge1xuICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSBcInN5bWJvbFwiO1xufVxuXG4vKiogQGRlcHJlY2F0ZWQgLSB1c2UgYHZhbHVlID09PSB1bmRlZmluZWRgIGluc3RlYWQuICovXG5leHBvcnQgZnVuY3Rpb24gaXNVbmRlZmluZWQodmFsdWU6IHVua25vd24pOiBib29sZWFuIHtcbiAgcmV0dXJuIHZhbHVlID09PSB1bmRlZmluZWQ7XG59XG5cbi8qKiBAZGVwcmVjYXRlZCAtIHVzZSBgdmFsdWUgIT09IG51bGwgJiYgdHlwZW9mIHZhbHVlID09PSBcIm9iamVjdFwiYCBpbnN0ZWFkLiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzT2JqZWN0KHZhbHVlOiB1bmtub3duKTogYm9vbGVhbiB7XG4gIHJldHVybiB2YWx1ZSAhPT0gbnVsbCAmJiB0eXBlb2YgdmFsdWUgPT09IFwib2JqZWN0XCI7XG59XG5cbi8qKiBAZGVwcmVjYXRlZCAtIHVzZSBgZSBpbnN0YW5jZW9mIEVycm9yYCBpbnN0ZWFkLiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzRXJyb3IoZTogdW5rbm93bik6IGJvb2xlYW4ge1xuICByZXR1cm4gZSBpbnN0YW5jZW9mIEVycm9yO1xufVxuXG4vKiogQGRlcHJlY2F0ZWQgLSB1c2UgYHR5cGVvZiB2YWx1ZSA9PT0gXCJmdW5jdGlvblwiYCBpbnN0ZWFkLiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzRnVuY3Rpb24odmFsdWU6IHVua25vd24pOiBib29sZWFuIHtcbiAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gXCJmdW5jdGlvblwiO1xufVxuXG4vKiogQGRlcHJlY2F0ZWQgLSB1c2UgYHZhbHVlIGluc3RhbmNlb2YgUmVnRXhwYCBpbnN0ZWFkLiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzUmVnRXhwKHZhbHVlOiB1bmtub3duKTogYm9vbGVhbiB7XG4gIHJldHVybiB2YWx1ZSBpbnN0YW5jZW9mIFJlZ0V4cDtcbn1cblxuLyoqIEBkZXByZWNhdGVkIC0gdXNlIGB2YWx1ZSA9PT0gbnVsbCB8fCAodHlwZW9mIHZhbHVlICE9PSBcIm9iamVjdFwiICYmIHR5cGVvZiB2YWx1ZSAhPT0gXCJmdW5jdGlvblwiKWAgaW5zdGVhZC4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc1ByaW1pdGl2ZSh2YWx1ZTogdW5rbm93bik6IGJvb2xlYW4ge1xuICByZXR1cm4gKFxuICAgIHZhbHVlID09PSBudWxsIHx8ICh0eXBlb2YgdmFsdWUgIT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIHZhbHVlICE9PSBcImZ1bmN0aW9uXCIpXG4gICk7XG59XG5cbi8qKlxuICogUmV0dXJucyBhIHN5c3RlbSBlcnJvciBuYW1lIGZyb20gYW4gZXJyb3IgY29kZSBudW1iZXIuXG4gKiBAcGFyYW0gY29kZSBlcnJvciBjb2RlIG51bWJlclxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0U3lzdGVtRXJyb3JOYW1lKGNvZGU6IG51bWJlcik6IHN0cmluZyB8IHVuZGVmaW5lZCB7XG4gIGlmICh0eXBlb2YgY29kZSAhPT0gXCJudW1iZXJcIikge1xuICAgIHRocm93IG5ldyBFUlJfSU5WQUxJRF9BUkdfVFlQRShcImVyclwiLCBcIm51bWJlclwiLCBjb2RlKTtcbiAgfVxuICBpZiAoY29kZSA+PSAwIHx8ICFOdW1iZXJJc1NhZmVJbnRlZ2VyKGNvZGUpKSB7XG4gICAgdGhyb3cgbmV3IEVSUl9PVVRfT0ZfUkFOR0UoXCJlcnJcIiwgXCJhIG5lZ2F0aXZlIGludGVnZXJcIiwgY29kZSk7XG4gIH1cbiAgcmV0dXJuIGVycm9yTWFwLmdldChjb2RlKT8uWzBdO1xufVxuXG4vKipcbiAqIGh0dHBzOi8vbm9kZWpzLm9yZy9hcGkvdXRpbC5odG1sI3V0aWxfdXRpbF9kZXByZWNhdGVfZm5fbXNnX2NvZGVcbiAqIEBwYXJhbSBfY29kZSBUaGlzIGltcGxlbWVudGF0aW9uIG9mIGRlcHJlY2F0ZSB3b24ndCBhcHBseSB0aGUgZGVwcmVjYXRpb24gY29kZVxuICovXG4vLyBkZW5vLWxpbnQtaWdub3JlIG5vLWV4cGxpY2l0LWFueVxuZXhwb3J0IGZ1bmN0aW9uIGRlcHJlY2F0ZTxUIGV4dGVuZHMgKC4uLmFyZ3M6IGFueSkgPT4gYW55PihcbiAgZm46IFQsXG4gIG1zZzogc3RyaW5nLFxuICBfY29kZT86IHN0cmluZyxcbik6ICguLi5hcmdzOiBQYXJhbWV0ZXJzPFQ+KSA9PiBSZXR1cm5UeXBlPFQ+IHtcbiAgcmV0dXJuIGZ1bmN0aW9uICguLi5hcmdzKSB7XG4gICAgY29uc29sZS53YXJuKG1zZyk7XG4gICAgcmV0dXJuIGZuLmFwcGx5KHVuZGVmaW5lZCwgYXJncyk7XG4gIH07XG59XG5cbmZ1bmN0aW9uIHRvUmVwbGFjZShzcGVjaWZpZXI6IHN0cmluZywgdmFsdWU6IHVua25vd24pOiBzdHJpbmcge1xuICBpZiAoc3BlY2lmaWVyID09PSBcIiVzXCIpIHtcbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSBcInN0cmluZ1wiIHx8IHZhbHVlIGluc3RhbmNlb2YgU3RyaW5nKSB7XG4gICAgICByZXR1cm4gdmFsdWUgYXMgc3RyaW5nO1xuICAgIH0gZWxzZSByZXR1cm4gRGVuby5pbnNwZWN0KHZhbHVlLCB7IGRlcHRoOiAxIH0pO1xuICB9XG4gIGlmIChzcGVjaWZpZXIgPT09IFwiJWRcIikge1xuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09IFwiYmlnaW50XCIpIHtcbiAgICAgIHJldHVybiB2YWx1ZSArIFwiblwiO1xuICAgIH1cbiAgICByZXR1cm4gTnVtYmVyKHZhbHVlKS50b1N0cmluZygpO1xuICB9XG4gIGlmIChzcGVjaWZpZXIgPT09IFwiJWlcIikge1xuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09IFwiYmlnaW50XCIpIHtcbiAgICAgIHJldHVybiB2YWx1ZSArIFwiblwiO1xuICAgIH1cbiAgICByZXR1cm4gcGFyc2VJbnQodmFsdWUgYXMgc3RyaW5nKS50b1N0cmluZygpO1xuICB9XG4gIGlmIChzcGVjaWZpZXIgPT09IFwiJWZcIikge1xuICAgIHJldHVybiBwYXJzZUZsb2F0KHZhbHVlIGFzIHN0cmluZykudG9TdHJpbmcoKTtcbiAgfVxuICBpZiAoc3BlY2lmaWVyID09PSBcIiVqXCIpIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHZhbHVlKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAvLyBub2RlSlMgPT4gJ2N5Y2xpYyBvYmplY3QgdmFsdWUnICwgZGVubyA9PiAnQ29udmVydGluZyBjaXJjdWxhciBzdHJ1Y3R1cmUgdG8gSlNPTiAuLi4nXG4gICAgICAvLyByZWY6IDxodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9KU09OL3N0cmluZ2lmeT5cbiAgICAgIGlmIChlIGluc3RhbmNlb2YgVHlwZUVycm9yICYmIGUubWVzc2FnZS5tYXRjaCgvY3ljbGljfGNpcmN1bGFyLykpIHtcbiAgICAgICAgcmV0dXJuIFwiW0NpcmN1bGFyXVwiO1xuICAgICAgfSBlbHNlIHRocm93IGU7XG4gICAgfVxuICB9XG4gIGlmIChzcGVjaWZpZXIgPT09IFwiJW9cIikge1xuICAgIHJldHVybiBEZW5vLmluc3BlY3QodmFsdWUsIHsgc2hvd0hpZGRlbjogdHJ1ZSwgc2hvd1Byb3h5OiB0cnVlIH0pO1xuICB9XG4gIGlmIChzcGVjaWZpZXIgPT09IFwiJU9cIikge1xuICAgIHJldHVybiBEZW5vLmluc3BlY3QodmFsdWUpO1xuICB9XG4gIGlmIChzcGVjaWZpZXIgPT09IFwiJWNcIikge1xuICAgIHJldHVybiBcIlwiO1xuICB9XG4gIHJldHVybiBcIlwiO1xufVxuXG4vLyByZWY6IDxodHRwczovL25vZGVqcy5vcmcvZG9jcy9sYXRlc3QtdjE2LngvYXBpL2NvbnNvbGUuaHRtbCNjb25zb2xlX2NvbnNvbGVfbG9nX2RhdGFfYXJncz5cbi8vIHJlZjogPGh0dHBzOi8vbm9kZWpzLm9yZy9kb2NzL2xhdGVzdC12MTYueC9hcGkvdXRpbC5odG1sI3V0aWxfdXRpbF9mb3JtYXRfZm9ybWF0X2FyZ3M+XG4vLyBtb2RpZmllZCBmcm9tIDxodHRwczovL2Rlbm8ubGFuZC9zdGRAMC4xMDUuMC9ub2RlL3V0aWwudHMjTDI0Ny1MMjY2PlxuZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdCguLi5hcmdzOiB1bmtub3duW10pIHtcbiAgY29uc3QgcmVwbGFjZW1lbnQ6IFtudW1iZXIsIHN0cmluZ11bXSA9IFtdO1xuICBjb25zdCBmb3JtYXRTcGVjaWZpZXJSeCA9IC8lKHN8ZHxpfGZ8anxvfE98Y3wlKS9nO1xuICBjb25zdCBoYXNGb3JtYXRUZW1wbGF0ZSA9IGFyZ3MubGVuZ3RoID4gMCAmJlxuICAgICh0eXBlb2YgYXJnc1swXSA9PT0gXCJzdHJpbmdcIiB8fCBhcmdzWzBdIGluc3RhbmNlb2YgU3RyaW5nKTtcbiAgY29uc3QgZm9ybWF0VGVtcGxhdGUgPSBoYXNGb3JtYXRUZW1wbGF0ZSA/IChhcmdzWzBdIGFzIHN0cmluZykgOiBcIlwiO1xuICBsZXQgaSA9IGhhc0Zvcm1hdFRlbXBsYXRlID8gMSA6IDA7XG4gIGxldCBhcnI6IFJlZ0V4cEV4ZWNBcnJheSB8IG51bGwgPSBudWxsO1xuICBsZXQgZG9uZSA9IGZhbHNlO1xuICB3aGlsZSAoKGFyciA9IGZvcm1hdFNwZWNpZmllclJ4LmV4ZWMoZm9ybWF0VGVtcGxhdGUpKSAhPT0gbnVsbCAmJiAhZG9uZSkge1xuICAgIGlmIChhcnJbMF0gPT09IFwiJSVcIikge1xuICAgICAgcmVwbGFjZW1lbnQucHVzaChbYXJyW1wiaW5kZXhcIl0sIFwiJVwiXSk7XG4gICAgfSBlbHNlIGlmIChpIDwgYXJncy5sZW5ndGgpIHtcbiAgICAgIHJlcGxhY2VtZW50LnB1c2goW2FycltcImluZGV4XCJdLCB0b1JlcGxhY2UoYXJyWzBdLCBhcmdzW2ldKV0pO1xuICAgICAgaSsrO1xuICAgIH0gZWxzZSBkb25lID0gdHJ1ZTtcbiAgfVxuICBjb25zdCBsYXN0QXJnVXNlZCA9IGk7XG4gIGxldCByZXN1bHQgPSBcIlwiO1xuICBsZXQgbGFzdCA9IDA7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgcmVwbGFjZW1lbnQubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBpdGVtID0gcmVwbGFjZW1lbnRbaV07XG4gICAgcmVzdWx0ICs9IGZvcm1hdFRlbXBsYXRlLnNsaWNlKGxhc3QsIGl0ZW1bMF0pO1xuICAgIHJlc3VsdCArPSBpdGVtWzFdO1xuICAgIGxhc3QgPSBpdGVtWzBdICsgMjtcbiAgfVxuICByZXN1bHQgKz0gZm9ybWF0VGVtcGxhdGUuc2xpY2UobGFzdCk7XG4gIGZvciAobGV0IGkgPSBsYXN0QXJnVXNlZDsgaSA8IGFyZ3MubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAoaSA+IDApIHJlc3VsdCArPSBcIiBcIjtcbiAgICBpZiAodHlwZW9mIGFyZ3NbaV0gPT09IFwic3RyaW5nXCIpIHtcbiAgICAgIHJlc3VsdCArPSBhcmdzW2ldO1xuICAgIH0gZWxzZSByZXN1bHQgKz0gRGVuby5pbnNwZWN0KGFyZ3NbaV0sIHsgY29sb3JzOiB0cnVlIH0pO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59XG4vKipcbiAqIGh0dHBzOi8vbm9kZWpzLm9yZy9hcGkvdXRpbC5odG1sI3V0aWxfdXRpbF9pbmhlcml0c19jb25zdHJ1Y3Rvcl9zdXBlcmNvbnN0cnVjdG9yXG4gKiBAcGFyYW0gY3RvciBDb25zdHJ1Y3RvciBmdW5jdGlvbiB3aGljaCBuZWVkcyB0byBpbmhlcml0IHRoZSBwcm90b3R5cGUuXG4gKiBAcGFyYW0gc3VwZXJDdG9yIENvbnN0cnVjdG9yIGZ1bmN0aW9uIHRvIGluaGVyaXQgcHJvdG90eXBlIGZyb20uXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpbmhlcml0czxULCBVPihcbiAgY3RvcjogbmV3ICguLi5hcmdzOiB1bmtub3duW10pID0+IFQsXG4gIHN1cGVyQ3RvcjogbmV3ICguLi5hcmdzOiB1bmtub3duW10pID0+IFUsXG4pIHtcbiAgaWYgKGN0b3IgPT09IHVuZGVmaW5lZCB8fCBjdG9yID09PSBudWxsKSB7XG4gICAgdGhyb3cgbmV3IEVSUl9JTlZBTElEX0FSR19UWVBFKFwiY3RvclwiLCBcIkZ1bmN0aW9uXCIsIGN0b3IpO1xuICB9XG5cbiAgaWYgKHN1cGVyQ3RvciA9PT0gdW5kZWZpbmVkIHx8IHN1cGVyQ3RvciA9PT0gbnVsbCkge1xuICAgIHRocm93IG5ldyBFUlJfSU5WQUxJRF9BUkdfVFlQRShcInN1cGVyQ3RvclwiLCBcIkZ1bmN0aW9uXCIsIHN1cGVyQ3Rvcik7XG4gIH1cblxuICBpZiAoc3VwZXJDdG9yLnByb3RvdHlwZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgdGhyb3cgbmV3IEVSUl9JTlZBTElEX0FSR19UWVBFKFxuICAgICAgXCJzdXBlckN0b3IucHJvdG90eXBlXCIsXG4gICAgICBcIk9iamVjdFwiLFxuICAgICAgc3VwZXJDdG9yLnByb3RvdHlwZSxcbiAgICApO1xuICB9XG4gIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjdG9yLCBcInN1cGVyX1wiLCB7XG4gICAgdmFsdWU6IHN1cGVyQ3RvcixcbiAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICBjb25maWd1cmFibGU6IHRydWUsXG4gIH0pO1xuICBPYmplY3Quc2V0UHJvdG90eXBlT2YoY3Rvci5wcm90b3R5cGUsIHN1cGVyQ3Rvci5wcm90b3R5cGUpO1xufVxuXG5pbXBvcnQgeyBfVGV4dERlY29kZXIsIF9UZXh0RW5jb2RlciB9IGZyb20gXCIuL191dGlscy50c1wiO1xuXG4vKiogVGhlIGdsb2JhbCBUZXh0RGVjb2RlciAqL1xuZXhwb3J0IHR5cGUgVGV4dERlY29kZXIgPSBpbXBvcnQoXCIuL191dGlscy50c1wiKS5fVGV4dERlY29kZXI7XG5leHBvcnQgY29uc3QgVGV4dERlY29kZXIgPSBfVGV4dERlY29kZXI7XG5cbi8qKiBUaGUgZ2xvYmFsIFRleHRFbmNvZGVyICovXG5leHBvcnQgdHlwZSBUZXh0RW5jb2RlciA9IGltcG9ydChcIi4vX3V0aWxzLnRzXCIpLl9UZXh0RW5jb2RlcjtcbmV4cG9ydCBjb25zdCBUZXh0RW5jb2RlciA9IF9UZXh0RW5jb2RlcjtcblxuZXhwb3J0IGRlZmF1bHQge1xuICBmb3JtYXQsXG4gIGluc3BlY3QsXG4gIGlzQXJyYXksXG4gIGlzQm9vbGVhbixcbiAgaXNOdWxsLFxuICBpc051bGxPclVuZGVmaW5lZCxcbiAgaXNOdW1iZXIsXG4gIGlzU3RyaW5nLFxuICBpc1N5bWJvbCxcbiAgaXNVbmRlZmluZWQsXG4gIGlzT2JqZWN0LFxuICBpc0Vycm9yLFxuICBpc0Z1bmN0aW9uLFxuICBpc1JlZ0V4cCxcbiAgaXNQcmltaXRpdmUsXG4gIGdldFN5c3RlbUVycm9yTmFtZSxcbiAgZGVwcmVjYXRlLFxuICBjYWxsYmFja2lmeSxcbiAgcHJvbWlzaWZ5LFxuICBpbmhlcml0cyxcbiAgdHlwZXMsXG4gIFRleHREZWNvZGVyLFxuICBUZXh0RW5jb2Rlcixcbn07XG4iXX0=