class NodeFalsyValueRejectionError extends Error {
    reason;
    code = "ERR_FALSY_VALUE_REJECTION";
    constructor(reason) {
        super("Promise was rejected with falsy value");
        this.reason = reason;
    }
}
class NodeInvalidArgTypeError extends TypeError {
    code = "ERR_INVALID_ARG_TYPE";
    constructor(argumentName) {
        super(`The ${argumentName} argument must be of type function.`);
    }
}
function callbackify(original) {
    if (typeof original !== "function") {
        throw new NodeInvalidArgTypeError('"original"');
    }
    const callbackified = function (...args) {
        const maybeCb = args.pop();
        if (typeof maybeCb !== "function") {
            throw new NodeInvalidArgTypeError("last");
        }
        const cb = (...args) => {
            maybeCb.apply(this, args);
        };
        original.apply(this, args).then((ret) => {
            queueMicrotask(cb.bind(this, null, ret));
        }, (rej) => {
            rej = rej || new NodeFalsyValueRejectionError(rej);
            queueMicrotask(cb.bind(this, rej));
        });
    };
    const descriptors = Object.getOwnPropertyDescriptors(original);
    if (typeof descriptors.length.value === "number") {
        descriptors.length.value++;
    }
    if (typeof descriptors.name.value === "string") {
        descriptors.name.value += "Callbackified";
    }
    Object.defineProperties(callbackified, descriptors);
    return callbackified;
}
export { callbackify };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiX3V0aWxfY2FsbGJhY2tpZnkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJfdXRpbF9jYWxsYmFja2lmeS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUF3QkEsTUFBTSw0QkFBNkIsU0FBUSxLQUFLO0lBQ3ZDLE1BQU0sQ0FBVTtJQUNoQixJQUFJLEdBQUcsMkJBQTJCLENBQUM7SUFDMUMsWUFBWSxNQUFlO1FBQ3pCLEtBQUssQ0FBQyx1Q0FBdUMsQ0FBQyxDQUFDO1FBQy9DLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO0lBQ3ZCLENBQUM7Q0FDRjtBQUNELE1BQU0sdUJBQXdCLFNBQVEsU0FBUztJQUN0QyxJQUFJLEdBQUcsc0JBQXNCLENBQUM7SUFDckMsWUFBWSxZQUFvQjtRQUM5QixLQUFLLENBQUMsT0FBTyxZQUFZLHFDQUFxQyxDQUFDLENBQUM7SUFDbEUsQ0FBQztDQUNGO0FBaURELFNBQVMsV0FBVyxDQUNsQixRQUFzRDtJQUV0RCxJQUFJLE9BQU8sUUFBUSxLQUFLLFVBQVUsRUFBRTtRQUNsQyxNQUFNLElBQUksdUJBQXVCLENBQUMsWUFBWSxDQUFDLENBQUM7S0FDakQ7SUFFRCxNQUFNLGFBQWEsR0FBRyxVQUF5QixHQUFHLElBQWU7UUFDL0QsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBQzNCLElBQUksT0FBTyxPQUFPLEtBQUssVUFBVSxFQUFFO1lBQ2pDLE1BQU0sSUFBSSx1QkFBdUIsQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUMzQztRQUNELE1BQU0sRUFBRSxHQUFHLENBQUMsR0FBRyxJQUFlLEVBQVEsRUFBRTtZQUN0QyxPQUFPLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztRQUM1QixDQUFDLENBQUM7UUFDRixRQUFRLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQzdCLENBQUMsR0FBWSxFQUFFLEVBQUU7WUFDZixjQUFjLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDM0MsQ0FBQyxFQUNELENBQUMsR0FBWSxFQUFFLEVBQUU7WUFDZixHQUFHLEdBQUcsR0FBRyxJQUFJLElBQUksNEJBQTRCLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDbkQsY0FBYyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDckMsQ0FBQyxDQUNGLENBQUM7SUFDSixDQUFDLENBQUM7SUFFRixNQUFNLFdBQVcsR0FBRyxNQUFNLENBQUMseUJBQXlCLENBQUMsUUFBUSxDQUFDLENBQUM7SUFHL0QsSUFBSSxPQUFPLFdBQVcsQ0FBQyxNQUFNLENBQUMsS0FBSyxLQUFLLFFBQVEsRUFBRTtRQUNoRCxXQUFXLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDO0tBQzVCO0lBQ0QsSUFBSSxPQUFPLFdBQVcsQ0FBQyxJQUFJLENBQUMsS0FBSyxLQUFLLFFBQVEsRUFBRTtRQUM5QyxXQUFXLENBQUMsSUFBSSxDQUFDLEtBQUssSUFBSSxlQUFlLENBQUM7S0FDM0M7SUFDRCxNQUFNLENBQUMsZ0JBQWdCLENBQUMsYUFBYSxFQUFFLFdBQVcsQ0FBQyxDQUFDO0lBQ3BELE9BQU8sYUFBYSxDQUFDO0FBQ3ZCLENBQUM7QUFFRCxPQUFPLEVBQUUsV0FBVyxFQUFFLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxOC0yMDIxIHRoZSBEZW5vIGF1dGhvcnMuIEFsbCByaWdodHMgcmVzZXJ2ZWQuIE1JVCBsaWNlbnNlLlxuLy9cbi8vIEFkYXB0ZWQgZnJvbSBOb2RlLmpzLiBDb3B5cmlnaHQgSm95ZW50LCBJbmMuIGFuZCBvdGhlciBOb2RlIGNvbnRyaWJ1dG9ycy5cbi8vXG4vLyBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYVxuLy8gY29weSBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZVxuLy8gXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nXG4vLyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsXG4vLyBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbCBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0XG4vLyBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGVcbi8vIGZvbGxvd2luZyBjb25kaXRpb25zOlxuLy9cbi8vIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkXG4vLyBpbiBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cbi8vXG4vLyBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTXG4vLyBPUiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GXG4vLyBNRVJDSEFOVEFCSUxJVFksIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOXG4vLyBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSxcbi8vIERBTUFHRVMgT1IgT1RIRVIgTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUlxuLy8gT1RIRVJXSVNFLCBBUklTSU5HIEZST00sIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRVxuLy8gVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS5cblxuLy8gVGhlc2UgYXJlIHNpbXBsaWZpZWQgdmVyc2lvbnMgb2YgdGhlIFwicmVhbFwiIGVycm9ycyBpbiBOb2RlLlxuY2xhc3MgTm9kZUZhbHN5VmFsdWVSZWplY3Rpb25FcnJvciBleHRlbmRzIEVycm9yIHtcbiAgcHVibGljIHJlYXNvbjogdW5rbm93bjtcbiAgcHVibGljIGNvZGUgPSBcIkVSUl9GQUxTWV9WQUxVRV9SRUpFQ1RJT05cIjtcbiAgY29uc3RydWN0b3IocmVhc29uOiB1bmtub3duKSB7XG4gICAgc3VwZXIoXCJQcm9taXNlIHdhcyByZWplY3RlZCB3aXRoIGZhbHN5IHZhbHVlXCIpO1xuICAgIHRoaXMucmVhc29uID0gcmVhc29uO1xuICB9XG59XG5jbGFzcyBOb2RlSW52YWxpZEFyZ1R5cGVFcnJvciBleHRlbmRzIFR5cGVFcnJvciB7XG4gIHB1YmxpYyBjb2RlID0gXCJFUlJfSU5WQUxJRF9BUkdfVFlQRVwiO1xuICBjb25zdHJ1Y3Rvcihhcmd1bWVudE5hbWU6IHN0cmluZykge1xuICAgIHN1cGVyKGBUaGUgJHthcmd1bWVudE5hbWV9IGFyZ3VtZW50IG11c3QgYmUgb2YgdHlwZSBmdW5jdGlvbi5gKTtcbiAgfVxufVxuXG50eXBlIENhbGxiYWNrPFJlc3VsdFQ+ID1cbiAgfCAoKGVycjogRXJyb3IpID0+IHZvaWQpXG4gIHwgKChlcnI6IG51bGwsIHJlc3VsdDogUmVzdWx0VCkgPT4gdm9pZCk7XG5cbmZ1bmN0aW9uIGNhbGxiYWNraWZ5PFJlc3VsdFQ+KFxuICBmbjogKCkgPT4gUHJvbWlzZUxpa2U8UmVzdWx0VD4sXG4pOiAoY2FsbGJhY2s6IENhbGxiYWNrPFJlc3VsdFQ+KSA9PiB2b2lkO1xuZnVuY3Rpb24gY2FsbGJhY2tpZnk8QXJnVCwgUmVzdWx0VD4oXG4gIGZuOiAoYXJnOiBBcmdUKSA9PiBQcm9taXNlTGlrZTxSZXN1bHRUPixcbik6IChhcmc6IEFyZ1QsIGNhbGxiYWNrOiBDYWxsYmFjazxSZXN1bHRUPikgPT4gdm9pZDtcbmZ1bmN0aW9uIGNhbGxiYWNraWZ5PEFyZzFULCBBcmcyVCwgUmVzdWx0VD4oXG4gIGZuOiAoYXJnMTogQXJnMVQsIGFyZzI6IEFyZzJUKSA9PiBQcm9taXNlTGlrZTxSZXN1bHRUPixcbik6IChhcmcxOiBBcmcxVCwgYXJnMjogQXJnMlQsIGNhbGxiYWNrOiBDYWxsYmFjazxSZXN1bHRUPikgPT4gdm9pZDtcbmZ1bmN0aW9uIGNhbGxiYWNraWZ5PEFyZzFULCBBcmcyVCwgQXJnM1QsIFJlc3VsdFQ+KFxuICBmbjogKGFyZzE6IEFyZzFULCBhcmcyOiBBcmcyVCwgYXJnMzogQXJnM1QpID0+IFByb21pc2VMaWtlPFJlc3VsdFQ+LFxuKTogKGFyZzE6IEFyZzFULCBhcmcyOiBBcmcyVCwgYXJnMzogQXJnM1QsIGNhbGxiYWNrOiBDYWxsYmFjazxSZXN1bHRUPikgPT4gdm9pZDtcbmZ1bmN0aW9uIGNhbGxiYWNraWZ5PEFyZzFULCBBcmcyVCwgQXJnM1QsIEFyZzRULCBSZXN1bHRUPihcbiAgZm46IChcbiAgICBhcmcxOiBBcmcxVCxcbiAgICBhcmcyOiBBcmcyVCxcbiAgICBhcmczOiBBcmczVCxcbiAgICBhcmc0OiBBcmc0VCxcbiAgKSA9PiBQcm9taXNlTGlrZTxSZXN1bHRUPixcbik6IChcbiAgYXJnMTogQXJnMVQsXG4gIGFyZzI6IEFyZzJULFxuICBhcmczOiBBcmczVCxcbiAgYXJnNDogQXJnNFQsXG4gIGNhbGxiYWNrOiBDYWxsYmFjazxSZXN1bHRUPixcbikgPT4gdm9pZDtcbmZ1bmN0aW9uIGNhbGxiYWNraWZ5PEFyZzFULCBBcmcyVCwgQXJnM1QsIEFyZzRULCBBcmc1VCwgUmVzdWx0VD4oXG4gIGZuOiAoXG4gICAgYXJnMTogQXJnMVQsXG4gICAgYXJnMjogQXJnMlQsXG4gICAgYXJnMzogQXJnM1QsXG4gICAgYXJnNDogQXJnNFQsXG4gICAgYXJnNTogQXJnNVQsXG4gICkgPT4gUHJvbWlzZUxpa2U8UmVzdWx0VD4sXG4pOiAoXG4gIGFyZzE6IEFyZzFULFxuICBhcmcyOiBBcmcyVCxcbiAgYXJnMzogQXJnM1QsXG4gIGFyZzQ6IEFyZzRULFxuICBhcmc1OiBBcmc1VCxcbiAgY2FsbGJhY2s6IENhbGxiYWNrPFJlc3VsdFQ+LFxuKSA9PiB2b2lkO1xuXG5mdW5jdGlvbiBjYWxsYmFja2lmeTxSZXN1bHRUPihcbiAgb3JpZ2luYWw6ICguLi5hcmdzOiB1bmtub3duW10pID0+IFByb21pc2VMaWtlPFJlc3VsdFQ+LFxuKTogKC4uLmFyZ3M6IHVua25vd25bXSkgPT4gdm9pZCB7XG4gIGlmICh0eXBlb2Ygb3JpZ2luYWwgIT09IFwiZnVuY3Rpb25cIikge1xuICAgIHRocm93IG5ldyBOb2RlSW52YWxpZEFyZ1R5cGVFcnJvcignXCJvcmlnaW5hbFwiJyk7XG4gIH1cblxuICBjb25zdCBjYWxsYmFja2lmaWVkID0gZnVuY3Rpb24gKHRoaXM6IHVua25vd24sIC4uLmFyZ3M6IHVua25vd25bXSk6IHZvaWQge1xuICAgIGNvbnN0IG1heWJlQ2IgPSBhcmdzLnBvcCgpO1xuICAgIGlmICh0eXBlb2YgbWF5YmVDYiAhPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICB0aHJvdyBuZXcgTm9kZUludmFsaWRBcmdUeXBlRXJyb3IoXCJsYXN0XCIpO1xuICAgIH1cbiAgICBjb25zdCBjYiA9ICguLi5hcmdzOiB1bmtub3duW10pOiB2b2lkID0+IHtcbiAgICAgIG1heWJlQ2IuYXBwbHkodGhpcywgYXJncyk7XG4gICAgfTtcbiAgICBvcmlnaW5hbC5hcHBseSh0aGlzLCBhcmdzKS50aGVuKFxuICAgICAgKHJldDogdW5rbm93bikgPT4ge1xuICAgICAgICBxdWV1ZU1pY3JvdGFzayhjYi5iaW5kKHRoaXMsIG51bGwsIHJldCkpO1xuICAgICAgfSxcbiAgICAgIChyZWo6IHVua25vd24pID0+IHtcbiAgICAgICAgcmVqID0gcmVqIHx8IG5ldyBOb2RlRmFsc3lWYWx1ZVJlamVjdGlvbkVycm9yKHJlaik7XG4gICAgICAgIHF1ZXVlTWljcm90YXNrKGNiLmJpbmQodGhpcywgcmVqKSk7XG4gICAgICB9LFxuICAgICk7XG4gIH07XG5cbiAgY29uc3QgZGVzY3JpcHRvcnMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhvcmlnaW5hbCk7XG4gIC8vIEl0IGlzIHBvc3NpYmxlIHRvIG1hbmlwdWxhdGUgYSBmdW5jdGlvbnMgYGxlbmd0aGAgb3IgYG5hbWVgIHByb3BlcnR5LiBUaGlzXG4gIC8vIGd1YXJkcyBhZ2FpbnN0IHRoZSBtYW5pcHVsYXRpb24uXG4gIGlmICh0eXBlb2YgZGVzY3JpcHRvcnMubGVuZ3RoLnZhbHVlID09PSBcIm51bWJlclwiKSB7XG4gICAgZGVzY3JpcHRvcnMubGVuZ3RoLnZhbHVlKys7XG4gIH1cbiAgaWYgKHR5cGVvZiBkZXNjcmlwdG9ycy5uYW1lLnZhbHVlID09PSBcInN0cmluZ1wiKSB7XG4gICAgZGVzY3JpcHRvcnMubmFtZS52YWx1ZSArPSBcIkNhbGxiYWNraWZpZWRcIjtcbiAgfVxuICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhjYWxsYmFja2lmaWVkLCBkZXNjcmlwdG9ycyk7XG4gIHJldHVybiBjYWxsYmFja2lmaWVkO1xufVxuXG5leHBvcnQgeyBjYWxsYmFja2lmeSB9O1xuIl19