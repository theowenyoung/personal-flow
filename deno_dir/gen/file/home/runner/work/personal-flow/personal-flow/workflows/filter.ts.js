import puppeteer from "https://deno.land/x/puppeteer@9.0.2/mod.ts";
export default async function (ctx) {
    let browser = null;
    let page = null;
    const getBrowser = async () => {
        if (browser)
            return browser;
        browser = await puppeteer.launch({
            devtools: false,
            defaultViewport: { width: 768, height: 1024 },
            args: ["--lang=zh-Hans,zh", "--disable-gpu"],
        });
        browser.on("disconnected", () => (browser = null));
        return browser;
    };
    const getNewPage = async (url, force) => {
        if (page)
            return page;
        browser = await getBrowser();
        const pages = await browser.pages();
        if (pages[0] && !force) {
            page = pages[0];
        }
        else {
            page = await browser.newPage();
        }
        await page.setUserAgent("Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36");
        await page.goto(url, { waitUntil: "domcontentloaded" });
        await page.waitForTimeout(4000);
        return page;
    };
    let filterResults = [];
    for (const item of ctx.items) {
        const link = item.links[0].href;
        page = await getNewPage(link, false);
        let isLessThan15 = false;
        if (page) {
            await autoScroll(page);
            await removeAllLinks(page);
            let scale = 1.6;
            if (link.startsWith("https://news.ycombinator.com")) {
                scale = 2.0;
            }
            const result = await page.pdf({ scale: scale, format: 'a4', omitBackground: true });
            isLessThan15 = result.byteLength < 15000000;
            console.log("isLessThan15", isLessThan15);
        }
        if (page) {
            await page.close();
            page = null;
        }
        if (browser) {
            await browser.close();
            browser = null;
        }
        filterResults.push(isLessThan15);
        if (isLessThan15) {
            break;
        }
    }
    if (filterResults.length < ctx.items.length) {
        filterResults = filterResults.concat(Array(ctx.items.length - filterResults.length).fill(false));
    }
    return filterResults;
}
async function removeAllLinks(page) {
    await page.evaluate(async () => {
        await new Promise((resolve) => {
            const all_links = document.body.getElementsByTagName("a");
            for (let i = 0; i < all_links.length; i++) {
                all_links[i].removeAttribute("href");
            }
            resolve(true);
        });
    });
}
async function autoScroll(page) {
    await page.evaluate(async () => {
        await new Promise((resolve) => {
            let totalHeight = 0;
            const distance = 100;
            const timeout = 8000;
            const now = Date.now();
            const timer = setInterval(() => {
                const scrollHeight = document.body.scrollHeight;
                window.scrollBy(0, distance);
                totalHeight += distance;
                const newNow = Date.now();
                if (newNow - now > timeout) {
                    clearInterval(timer);
                    resolve(true);
                    return;
                }
                if (totalHeight >= scrollHeight) {
                    clearInterval(timer);
                    resolve(true);
                }
            }, 100);
        });
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZmlsdGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sU0FHTixNQUFNLDRDQUE0QyxDQUFDO0FBRXBELE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FBSyxXQUFXLEdBQWlCO0lBRTlDLElBQUksT0FBTyxHQUFtQixJQUFJLENBQUM7SUFDbkMsSUFBSSxJQUFJLEdBQWdCLElBQUksQ0FBQztJQUM3QixNQUFNLFVBQVUsR0FBRyxLQUFLLElBQUksRUFBRTtRQUM1QixJQUFJLE9BQU87WUFBRSxPQUFPLE9BQU8sQ0FBQztRQUM1QixPQUFPLEdBQUcsTUFBTSxTQUFTLENBQUMsTUFBTSxDQUFDO1lBQy9CLFFBQVEsRUFBRSxLQUFLO1lBRWYsZUFBZSxFQUFFLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFO1lBQzdDLElBQUksRUFBRSxDQUFDLG1CQUFtQixFQUFFLGVBQWUsQ0FBQztTQUM3QyxDQUFDLENBQUM7UUFDSCxPQUFPLENBQUMsRUFBRSxDQUFDLGNBQWMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ25ELE9BQU8sT0FBTyxDQUFDO0lBQ2pCLENBQUMsQ0FBQztJQUVGLE1BQU0sVUFBVSxHQUFHLEtBQUssRUFBRSxHQUFVLEVBQUMsS0FBYyxFQUFpQixFQUFFO1FBQ3BFLElBQUksSUFBSTtZQUFFLE9BQU8sSUFBSSxDQUFDO1FBQ3RCLE9BQU8sR0FBRyxNQUFNLFVBQVUsRUFBRSxDQUFDO1FBQzdCLE1BQU0sS0FBSyxHQUFHLE1BQU0sT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ3BDLElBQUksS0FBSyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFO1lBQ3RCLElBQUksR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDakI7YUFBTTtZQUNMLElBQUksR0FBRyxNQUFNLE9BQU8sQ0FBQyxPQUFPLEVBQUUsQ0FBQztTQUNoQztRQUNELE1BQU0sSUFBSSxDQUFDLFlBQVksQ0FDckIsMkdBQTJHLENBQzVHLENBQUM7UUFFRixNQUFNLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLEVBQUUsU0FBUyxFQUFFLGtCQUFrQixFQUFFLENBQUMsQ0FBQztRQUV4RCxNQUFNLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUM7UUFHaEMsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDLENBQUM7SUFDRixJQUFJLGFBQWEsR0FBRyxFQUFFLENBQUM7SUFDdkIsS0FBSyxNQUFNLElBQUksSUFBSyxHQUFHLENBQUMsS0FBaUQsRUFBRTtRQUN6RSxNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQWMsQ0FBQztRQUN4QyxJQUFJLEdBQUcsTUFBTSxVQUFVLENBQUMsSUFBSSxFQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3RDLElBQUksWUFBWSxHQUFHLEtBQUssQ0FBQztRQUN6QixJQUFHLElBQUksRUFBQztZQUVQLE1BQU0sVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBRXZCLE1BQU0sY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzNCLElBQUksS0FBSyxHQUFHLEdBQUcsQ0FBQztZQUVoQixJQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsOEJBQThCLENBQUMsRUFBQztnQkFDakQsS0FBSyxHQUFHLEdBQUcsQ0FBQzthQUNiO1lBSUQsTUFBTSxNQUFNLEdBQUksTUFBTSxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUMsS0FBSyxFQUFDLEtBQUssRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFDLGNBQWMsRUFBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO1lBS2hGLFlBQVksR0FBRyxNQUFNLENBQUMsVUFBVSxHQUFDLFFBQVEsQ0FBQztZQUMxQyxPQUFPLENBQUMsR0FBRyxDQUFDLGNBQWMsRUFBQyxZQUFZLENBQUMsQ0FBQTtTQUN6QztRQUVELElBQUksSUFBSSxFQUFFO1lBQ1IsTUFBTSxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDbkIsSUFBSSxHQUFDLElBQUksQ0FBQztTQUNYO1FBRUQsSUFBSSxPQUFPLEVBQUU7WUFDWCxNQUFPLE9BQW9CLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDcEMsT0FBTyxHQUFHLElBQUksQ0FBQztTQUNoQjtRQUVELGFBQWEsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDakMsSUFBRyxZQUFZLEVBQUM7WUFDZCxNQUFNO1NBQ1A7S0FDRjtJQUVELElBQUcsYUFBYSxDQUFDLE1BQU0sR0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBQztRQUN2QyxhQUFhLEdBQUcsYUFBYSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUUsR0FBRyxDQUFDLEtBQW1CLENBQUMsTUFBTSxHQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztLQUMvRztJQUNELE9BQU8sYUFBYSxDQUFDO0FBR3ZCLENBQUM7QUFDRCxLQUFLLFVBQVUsY0FBYyxDQUFDLElBQVM7SUFDckMsTUFBTSxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQzdCLE1BQU0sSUFBSSxPQUFPLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRTtZQUVoQyxNQUFNLFNBQVMsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLG9CQUFvQixDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBRTFELEtBQUksSUFBSSxDQUFDLEdBQUMsQ0FBQyxFQUFFLENBQUMsR0FBQyxTQUFTLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFDO2dCQUNqQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQyxDQUFDO2FBQ3hDO1lBQ0QsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ1osQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztBQUdILENBQUM7QUFDRCxLQUFLLFVBQVUsVUFBVSxDQUFDLElBQVM7SUFDakMsTUFBTSxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQzNCLE1BQU0sSUFBSSxPQUFPLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRTtZQUMxQixJQUFJLFdBQVcsR0FBRyxDQUFDLENBQUM7WUFDcEIsTUFBTSxRQUFRLEdBQUcsR0FBRyxDQUFDO1lBQ3JCLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQztZQUNyQixNQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7WUFDdkIsTUFBTSxLQUFLLEdBQUcsV0FBVyxDQUFDLEdBQUcsRUFBRTtnQkFFM0IsTUFBTSxZQUFZLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUM7Z0JBRWhELE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLFFBQVEsQ0FBQyxDQUFDO2dCQUM3QixXQUFXLElBQUksUUFBUSxDQUFDO2dCQUV4QixNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7Z0JBRTFCLElBQUcsTUFBTSxHQUFDLEdBQUcsR0FBRyxPQUFPLEVBQUM7b0JBQ3RCLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztvQkFDckIsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO29CQUNkLE9BQU87aUJBQ1I7Z0JBRUQsSUFBRyxXQUFXLElBQUksWUFBWSxFQUFDO29CQUMzQixhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7b0JBQ3JCLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztpQkFDakI7WUFDTCxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDWixDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBwdXBwZXRlZXIsIHtcbiAgQnJvd3NlcixcbiAgUGFnZSxcbn0gZnJvbSBcImh0dHBzOi8vZGVuby5sYW5kL3gvcHVwcGV0ZWVyQDkuMC4yL21vZC50c1wiO1xuaW1wb3J0IHR5cGUge1B1YmxpY0NvbnRleHR9IGZyb20gJ2h0dHBzOi8vZGVuby5sYW5kL3gvZGVub2Zsb3dAMC4wLjI4L21vZC50cyc7XG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiAoY3R4OlB1YmxpY0NvbnRleHQpIHsgIFxuXG4gIGxldCBicm93c2VyOiBCcm93c2VyIHwgbnVsbCA9IG51bGw7XG4gIGxldCBwYWdlOiBQYWdlIHwgbnVsbCA9IG51bGw7XG4gIGNvbnN0IGdldEJyb3dzZXIgPSBhc3luYyAoKSA9PiB7XG4gICAgaWYgKGJyb3dzZXIpIHJldHVybiBicm93c2VyO1xuICAgIGJyb3dzZXIgPSBhd2FpdCBwdXBwZXRlZXIubGF1bmNoKHtcbiAgICAgIGRldnRvb2xzOiBmYWxzZSxcbiAgICAgIC8vIGhlYWRsZXNzOiAhaXNEZXYsXG4gICAgICBkZWZhdWx0Vmlld3BvcnQ6IHsgd2lkdGg6IDc2OCwgaGVpZ2h0OiAxMDI0IH0sXG4gICAgICBhcmdzOiBbXCItLWxhbmc9emgtSGFucyx6aFwiLCBcIi0tZGlzYWJsZS1ncHVcIl0sXG4gICAgfSk7XG4gICAgYnJvd3Nlci5vbihcImRpc2Nvbm5lY3RlZFwiLCAoKSA9PiAoYnJvd3NlciA9IG51bGwpKTtcbiAgICByZXR1cm4gYnJvd3NlcjtcbiAgfTtcblxuICBjb25zdCBnZXROZXdQYWdlID0gYXN5bmMgKHVybDpzdHJpbmcsZm9yY2U6IGJvb2xlYW4pOiBQcm9taXNlPFBhZ2U+ID0+IHtcbiAgICBpZiAocGFnZSkgcmV0dXJuIHBhZ2U7XG4gICAgYnJvd3NlciA9IGF3YWl0IGdldEJyb3dzZXIoKTtcbiAgICBjb25zdCBwYWdlcyA9IGF3YWl0IGJyb3dzZXIucGFnZXMoKTtcbiAgICBpZiAocGFnZXNbMF0gJiYgIWZvcmNlKSB7XG4gICAgICBwYWdlID0gcGFnZXNbMF07XG4gICAgfSBlbHNlIHtcbiAgICAgIHBhZ2UgPSBhd2FpdCBicm93c2VyLm5ld1BhZ2UoKTtcbiAgICB9XG4gICAgYXdhaXQgcGFnZS5zZXRVc2VyQWdlbnQoXG4gICAgICBcIk1vemlsbGEvNS4wIChYMTE7IExpbnV4IHg4Nl82NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzc4LjAuMzkwNC4xMDggU2FmYXJpLzUzNy4zNlwiXG4gICAgKTtcbiAgICAvLyBhd2FpdCBwYWdlLnNldFZpZXdwb3J0KHsgd2lkdGg6IDEzNzAsIGhlaWdodDogMTIwMCB9KTtcbiAgICBhd2FpdCBwYWdlLmdvdG8odXJsLCB7IHdhaXRVbnRpbDogXCJkb21jb250ZW50bG9hZGVkXCIgfSk7XG5cbiAgICBhd2FpdCBwYWdlLndhaXRGb3JUaW1lb3V0KDQwMDApO1xuICAgIC8vIGF3YWl0IHBhZ2Uuc2NyZWVuc2hvdCh7IHBhdGg6IFwiZXhhbXBsZS5wbmdcIiB9KTtcblxuICAgIHJldHVybiBwYWdlO1xuICB9O1xuICBsZXQgZmlsdGVyUmVzdWx0cyA9IFtdO1xuICBmb3IgKGNvbnN0IGl0ZW0gIG9mIGN0eC5pdGVtcyBhcyBSZWNvcmQ8c3RyaW5nLFJlY29yZDxzdHJpbmcsc3RyaW5nPltdPltdKSB7XG4gICAgY29uc3QgbGluayA9IGl0ZW0ubGlua3NbMF0uaHJlZiBhcyBzdHJpbmc7ICBcbiAgICAgIHBhZ2UgPSBhd2FpdCBnZXROZXdQYWdlKGxpbmssZmFsc2UpO1xuICAgIGxldCBpc0xlc3NUaGFuMTUgPSBmYWxzZTtcbiAgICBpZihwYWdlKXtcbiAgXG4gICAgIGF3YWl0IGF1dG9TY3JvbGwocGFnZSk7XG4gIFxuICAgICBhd2FpdCByZW1vdmVBbGxMaW5rcyhwYWdlKTtcbiAgICAgbGV0IHNjYWxlID0gMS42O1xuICBcbiAgICAgaWYobGluay5zdGFydHNXaXRoKFwiaHR0cHM6Ly9uZXdzLnljb21iaW5hdG9yLmNvbVwiKSl7XG4gICAgICAgc2NhbGUgPSAyLjA7XG4gICAgIH1cbiAgXG4gICAgICAvLyBzYXZlIFxuICAgICAgLy8gcGF0aDogJy4vY2hhbmdlZC90ZXN0LnBkZidcbiAgICAgY29uc3QgcmVzdWx0ID0gIGF3YWl0IHBhZ2UucGRmKHtzY2FsZTpzY2FsZSwgZm9ybWF0OiAnYTQnLG9taXRCYWNrZ3JvdW5kOnRydWUgfSk7XG4gICAgIFxuICAgICAgLy8gZ2V0IGJhc2U2NFxuICAgICAgLy8gY29uc3QgZGVjb2RlciA9IG5ldyBUZXh0RGVjb2RlcigndXRmLTgnKTtcbiAgXG4gICAgICBpc0xlc3NUaGFuMTUgPSByZXN1bHQuYnl0ZUxlbmd0aDwxNTAwMDAwMDtcbiAgICAgIGNvbnNvbGUubG9nKFwiaXNMZXNzVGhhbjE1XCIsaXNMZXNzVGhhbjE1KVxuICAgIH1cbiAgXG4gICAgaWYgKHBhZ2UpIHtcbiAgICAgIGF3YWl0IHBhZ2UuY2xvc2UoKTtcbiAgICAgIHBhZ2U9bnVsbDtcbiAgICB9XG4gICAgLy8gcXVpdCBwdXBwZXRlZXJcbiAgICBpZiAoYnJvd3Nlcikge1xuICAgICAgYXdhaXQgKGJyb3dzZXIgYXMgQnJvd3NlcikhLmNsb3NlKCk7XG4gICAgICBicm93c2VyID0gbnVsbDtcbiAgICB9XG4gICAgXG4gICAgZmlsdGVyUmVzdWx0cy5wdXNoKGlzTGVzc1RoYW4xNSk7XG4gICAgaWYoaXNMZXNzVGhhbjE1KXtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuICBcbiAgaWYoZmlsdGVyUmVzdWx0cy5sZW5ndGg8Y3R4Lml0ZW1zLmxlbmd0aCl7XG4gICAgZmlsdGVyUmVzdWx0cyA9IGZpbHRlclJlc3VsdHMuY29uY2F0KEFycmF5KChjdHguaXRlbXMgYXMgdW5rbm93bltdKS5sZW5ndGgtZmlsdGVyUmVzdWx0cy5sZW5ndGgpLmZpbGwoZmFsc2UpKTtcbiAgfSAgXG4gIHJldHVybiBmaWx0ZXJSZXN1bHRzO1xuICBcblxufVxuYXN5bmMgZnVuY3Rpb24gcmVtb3ZlQWxsTGlua3MocGFnZTpQYWdlKXtcbiAgYXdhaXQgcGFnZS5ldmFsdWF0ZShhc3luYyAoKSA9PiB7XG4gICAgYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgLy8gQHRzLWlnbm9yZTogc2Nyb2xsVG8gaXMgbm90IGEgZnVuY3Rpb25cbiAgY29uc3QgYWxsX2xpbmtzID0gZG9jdW1lbnQuYm9keS5nZXRFbGVtZW50c0J5VGFnTmFtZShcImFcIik7XG5cbiAgZm9yKGxldCBpPTA7IGk8YWxsX2xpbmtzLmxlbmd0aDsgaSsrKXtcbiAgICAgIGFsbF9saW5rc1tpXS5yZW1vdmVBdHRyaWJ1dGUoXCJocmVmXCIpO1xuICB9XG4gIHJlc29sdmUodHJ1ZSk7XG4gICAgfSk7XG59KTtcblxuXG59XG5hc3luYyBmdW5jdGlvbiBhdXRvU2Nyb2xsKHBhZ2U6UGFnZSl7XG4gIGF3YWl0IHBhZ2UuZXZhbHVhdGUoYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgICAgICBsZXQgdG90YWxIZWlnaHQgPSAwO1xuICAgICAgICAgIGNvbnN0IGRpc3RhbmNlID0gMTAwO1xuICAgICAgICAgIGNvbnN0IHRpbWVvdXQgPSA4MDAwO1xuICAgICAgICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG4gICAgICAgICAgY29uc3QgdGltZXIgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICAgICAgICAgLy8gQHRzLWlnbm9yZTogUHJvcGVydHkgJ3Njcm9sbEJ5JyBkb2VzIG5vdCBleGlzdCBvbiB0eXBlICdXaW5kb3cnXG4gICAgICAgICAgICAgIGNvbnN0IHNjcm9sbEhlaWdodCA9IGRvY3VtZW50LmJvZHkuc2Nyb2xsSGVpZ2h0O1xuICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlOiBzY3JvbGxUbyBpcyBub3QgYSBmdW5jdGlvblxuICAgICAgICAgICAgICB3aW5kb3cuc2Nyb2xsQnkoMCwgZGlzdGFuY2UpO1xuICAgICAgICAgICAgICB0b3RhbEhlaWdodCArPSBkaXN0YW5jZTtcblxuICAgICAgICAgICAgICBjb25zdCBuZXdOb3cgPSBEYXRlLm5vdygpO1xuXG4gICAgICAgICAgICAgIGlmKG5ld05vdy1ub3cgPiB0aW1lb3V0KXtcbiAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHRpbWVyKTtcbiAgICAgICAgICAgICAgICByZXNvbHZlKHRydWUpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGlmKHRvdGFsSGVpZ2h0ID49IHNjcm9sbEhlaWdodCl7XG4gICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHRpbWVyKTtcbiAgICAgICAgICAgICAgICAgIHJlc29sdmUodHJ1ZSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICB9LCAxMDApO1xuICAgICAgfSk7XG4gIH0pO1xufSJdfQ==